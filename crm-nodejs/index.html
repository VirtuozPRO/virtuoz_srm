<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–í–ï–†–¢–£–ú CRM - –¢–æ—Ä–≥–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞–º–∏</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://unpkg.com/xlsx/dist/xlsx.full.min.js"></script>
    
    <!-- PWA –º–µ—Ç–∞-—Ç–µ–≥–∏ -->
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="manifest" href="/manifest.json">
    
    <style>
    /* ========== –û–°–ù–û–í–ù–´–ï –°–¢–ò–õ–ò ========== */
    :root {
        --primary-color: #667eea;
        --secondary-color: #764ba2;
        --success-color: #4CAF50;
        --warning-color: #FF9800;
        --danger-color: #f44336;
        --info-color: #2196F3;
        --light-bg: #f8f9fa;
        --dark-text: #2d3748;
        --border-radius: 8px;
        --box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        --transition: all 0.3s ease;
    }
    
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        -webkit-tap-highlight-color: transparent;
    }
    
    body {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
        color: var(--dark-text);
        line-height: 1.6;
        overflow-x: hidden;
    }
    
    /* ========== –®–ê–ü–ö–ê ========== */
    .crm-header {
        background: white;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        position: sticky;
        top: 0;
        z-index: 1000;
        padding: 12px 0;
        -webkit-backdrop-filter: blur(10px);
        backdrop-filter: blur(10px);
    }
    
    .header-container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 0 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .logo {
        display: flex;
        align-items: center;
        gap: 12px;
        font-size: 20px;
        font-weight: bold;
        color: var(--secondary-color);
    }
    
    .logo i {
        font-size: 24px;
        color: var(--primary-color);
    }
    
    /* ========== –ú–ï–ù–ï–î–ñ–ï–† ========== */
    .manager-selector {
        position: relative;
        min-width: 300px;
    }
    
    .current-manager {
        display: flex;
        align-items: center;
        justify-content: space-between;
        background: linear-gradient(135deg, var(--light-bg) 0%, #e9ecef 100%);
        padding: 10px 16px;
        border-radius: var(--border-radius);
        border: 2px solid var(--primary-color);
        cursor: pointer;
        transition: var(--transition);
        -webkit-touch-callout: none;
        user-select: none;
    }
    
    .current-manager:hover {
        border-color: var(--secondary-color);
        transform: translateY(-1px);
        box-shadow: var(--box-shadow);
    }
    
    .manager-info {
        flex-grow: 1;
    }
    
    .manager-name {
        font-weight: 600;
        font-size: 14px;
        color: var(--dark-text);
        margin-bottom: 3px;
    }
    
    .manager-contacts {
        font-size: 12px;
        color: #666;
    }
    
    .manager-arrow {
        color: var(--primary-color);
        margin-left: 10px;
        transition: var(--transition);
    }
    
    .current-manager.active .manager-arrow {
        transform: rotate(180deg);
    }
    
    .managers-dropdown {
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        background: white;
        border: 2px solid var(--primary-color);
        border-radius: var(--border-radius);
        margin-top: 8px;
        box-shadow: 0 6px 15px rgba(0,0,0,0.1);
        z-index: 1001;
        overflow: hidden;
        display: none;
        animation: slideDown 0.3s ease;
    }
    
    @keyframes slideDown {
        from { opacity: 0; transform: translateY(-10px); }
        to { opacity: 1; transform: translateY(0); }
    }
    
    .manager-option {
        display: flex;
        align-items: center;
        padding: 12px 16px;
        border-bottom: 1px solid #e9ecef;
        cursor: pointer;
        transition: var(--transition);
    }
    
    .manager-option:hover {
        background: var(--light-bg);
    }
    
    .manager-option.active {
        background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
        border-left: 4px solid var(--success-color);
    }
    
    .manager-option i {
        color: var(--primary-color);
        margin-right: 12px;
        font-size: 16px;
    }
    
    /* ========== –ö–ù–û–ü–ö–ò –í –®–ê–ü–ö–ï ========== */
    .header-actions {
        display: flex;
        align-items: center;
        gap: 12px;
    }
    
    .header-btn {
        background: linear-gradient(135deg, var(--light-bg) 0%, #e9ecef 100%);
        border: 2px solid var(--primary-color);
        padding: 8px 16px;
        border-radius: var(--border-radius);
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 13px;
        font-weight: 600;
        color: var(--dark-text);
        transition: var(--transition);
    }
    
    .header-btn:hover {
        background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
        color: white;
        border-color: transparent;
    }
    
    .btn-visit-header {
        background: linear-gradient(135deg, var(--warning-color) 0%, #F57C00 100%);
        color: white !important;
        border: none;
        padding: 10px 20px;
        border-radius: var(--border-radius);
        cursor: pointer;
        font-weight: bold;
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 14px;
        transition: var(--transition);
        min-width: 160px;
        justify-content: center;
        box-shadow: 0 2px 5px rgba(255, 152, 0, 0.3);
    }
    
    .btn-visit-header:hover {
        background: linear-gradient(135deg, #F57C00 0%, #E65100 100%);
        transform: translateY(-2px);
        box-shadow: 0 4px 10px rgba(245, 124, 0, 0.4);
    }
    
    /* ========== –ì–õ–ê–í–ù–û–ï –ú–ï–ù–Æ ========== */
    .crm-main {
        max-width: 1400px;
        margin: 20px auto;
        padding: 0 20px;
        min-height: calc(100vh - 200px);
    }
    
    .menu-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin: 25px 0;
    }
    
    .menu-card {
        background: white;
        border-radius: 12px;
        padding: 25px;
        cursor: pointer;
        border: 2px solid var(--primary-color);
        transition: var(--transition);
        box-shadow: var(--box-shadow);
        position: relative;
        overflow: hidden;
    }
    
    .menu-card:hover {
        transform: translateY(-5px);
        border-color: var(--secondary-color);
        box-shadow: 0 8px 20px rgba(0,0,0,0.15);
    }
    
    .menu-card.active {
        background: linear-gradient(135deg, #f8fff8 0%, #e8f5e9 100%);
        border-color: var(--success-color);
    }
    
    .menu-icon {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 20px;
    }
    
    .menu-icon i {
        font-size: 32px;
        color: var(--primary-color);
    }
    
    .menu-badge {
        background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
        color: white;
        padding: 5px 15px;
        border-radius: 20px;
        font-size: 14px;
        font-weight: bold;
        box-shadow: 0 2px 5px rgba(102, 126, 234, 0.3);
    }
    
    .menu-title {
        font-size: 20px;
        font-weight: bold;
        color: var(--dark-text);
        margin-bottom: 8px;
    }
    
    .menu-subtitle {
        font-size: 13px;
        color: #666;
        margin-bottom: 20px;
        line-height: 1.4;
    }
    
    .menu-action {
        color: var(--primary-color);
        font-weight: bold;
        font-size: 14px;
        display: flex;
        align-items: center;
        gap: 5px;
        margin-top: 10px;
    }
    
    .menu-action::after {
        content: "‚Üí";
        font-size: 16px;
    }
    
    /* ========== –°–¢–ê–¢–ò–°–¢–ò–ö–ê ========== */
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin: 30px 0;
    }
    
    .stat-card {
        background: white;
        border-radius: 10px;
        padding: 20px;
        text-align: center;
        box-shadow: var(--box-shadow);
        border: 2px solid var(--primary-color);
        transition: var(--transition);
        position: relative;
        overflow: hidden;
    }
    
    .stat-card:hover {
        transform: translateY(-3px);
        border-color: var(--secondary-color);
    }
    
    .stat-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
    }
    
    .stat-card i {
        font-size: 28px;
        color: var(--primary-color);
        margin-bottom: 15px;
        display: block;
    }
    
    .stat-value {
        font-size: 24px;
        font-weight: bold;
        color: var(--dark-text);
        margin-bottom: 5px;
    }
    
    .stat-label {
        font-size: 12px;
        color: #666;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    
    /* ========== –†–ê–ó–î–ï–õ–´ ========== */
    .section-container {
        background: white;
        border-radius: 12px;
        padding: 25px;
        margin: 25px 0;
        box-shadow: var(--box-shadow);
        border: 2px solid var(--primary-color);
        display: none;
    }
    
    .section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 25px;
        padding-bottom: 15px;
        border-bottom: 2px solid var(--primary-color);
    }
    
    .section-title {
        font-size: 20px;
        font-weight: bold;
        color: var(--dark-text);
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .section-title i {
        color: var(--primary-color);
        font-size: 24px;
    }
    
    .manager-badge {
        background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
        color: white;
        padding: 5px 12px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: bold;
        margin-left: 10px;
    }
    
    .section-actions {
        display: flex;
        gap: 10px;
        align-items: center;
        flex-wrap: wrap;
    }
    
    .counter-badge {
        background: var(--light-bg);
        padding: 7px 14px;
        border-radius: 20px;
        font-size: 12px;
        color: var(--dark-text);
        border: 1px solid var(--primary-color);
    }
    
    .action-btn {
        padding: 9px 18px;
        border: none;
        border-radius: var(--border-radius);
        cursor: pointer;
        font-size: 13px;
        display: flex;
        align-items: center;
        gap: 8px;
        font-weight: 600;
        transition: var(--transition);
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    
    .action-btn:hover {
        transform: translateY(-1px);
        box-shadow: 0 3px 8px rgba(0,0,0,0.15);
    }
    
    .btn-success {
        background: linear-gradient(135deg, var(--success-color) 0%, #2E7D32 100%);
        color: white;
    }
    
    .btn-primary {
        background: linear-gradient(135deg, var(--info-color) 0%, #0D47A1 100%);
        color: white;
    }
    
    .btn-info {
        background: linear-gradient(135deg, var(--info-color) 0%, #0D47A1 100%);
        color: white;
    }
    
    .btn-green {
        background: linear-gradient(135deg, var(--success-color) 0%, #2E7D32 100%);
        color: white;
    }
    
    .btn-warning {
        background: linear-gradient(135deg, var(--warning-color) 0%, #F57C00 100%);
        color: white;
    }
    
    /* ========== –ü–û–ò–°–ö –ò –§–ò–õ–¨–¢–†–´ ========== */
    .search-box {
        margin: 20px 0;
        position: relative;
    }
    
    .search-input {
        width: 100%;
        padding: 13px 15px 13px 45px;
        border: 2px solid var(--primary-color);
        border-radius: var(--border-radius);
        font-size: 14px;
        background: white;
        color: var(--dark-text);
        box-shadow: 0 1px 3px rgba(102, 126, 234, 0.1);
        transition: var(--transition);
    }
    
    .search-input:focus {
        outline: none;
        border-color: var(--secondary-color);
        box-shadow: 0 3px 10px rgba(118, 75, 162, 0.2);
    }
    
    .search-box::before {
        content: 'üîç';
        position: absolute;
        left: 15px;
        top: 50%;
        transform: translateY(-50%);
        font-size: 16px;
        color: var(--primary-color);
    }
    
    .filters-grid {  
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 15px;
        margin: 25px 0;
        padding: 20px;
        background: linear-gradient(135deg, var(--light-bg) 0%, #e9ecef 100%);
        border-radius: var(--border-radius);
        border: 2px solid var(--primary-color);
    }
    
    .filter-item {
        display: flex;
        flex-direction: column;
    }
    
    .filter-item label {
        font-size: 12px;
        color: var(--primary-color);
        margin-bottom: 6px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    
    .filter-select {
        padding: 11px 13px;
        border: 2px solid var(--primary-color);
        border-radius: var(--border-radius);
        background: white;
        font-size: 13px;
        cursor: pointer;
        color: var(--dark-text);
        font-weight: 500;
        transition: var(--transition);
    }
    
    .filter-select:hover {
        border-color: var(--secondary-color);
    }
    
    .filter-select:focus {
        outline: none;
        border-color: var(--secondary-color);
        box-shadow: 0 2px 5px rgba(118, 75, 162, 0.2);
    }
    
    /* ========== –¢–ê–ë–õ–ò–¶–´ ========== */
    .table-container {
        overflow-x: auto;
        margin: 25px 0;
        border: 2px solid var(--primary-color);
        border-radius: var(--border-radius);
        box-shadow: var(--box-shadow);
        max-height: 500px;
        position: relative;
    }
    
    .data-table {
        width: 100%;
        border-collapse: collapse;
        min-width: 1200px;
    }
    
    .data-table th {
        background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
        color: white;
        padding: 14px 12px;
        text-align: left;
        font-size: 13px;
        font-weight: 600;
        position: sticky;
        top: 0;
        z-index: 10;
    }
    
    .data-table td {
        padding: 12px 12px;
        border-bottom: 1px solid #f1f3f4;
        font-size: 13px;
        color: var(--dark-text);
        vertical-align: middle;
    }
    
    .data-table tr:nth-child(even) {
        background-color: #f8f9fa;
    }
    
    .data-table tr:hover {
        background: linear-gradient(135deg, #f3f0ff 0%, #e9ecef 100%);
        box-shadow: 0 1px 3px rgba(102, 126, 234, 0.1);
    }
    
    .checkbox-cell {
        text-align: center;
        width: 30px;
    }
    
    .action-cell {
        display: flex;
        gap: 5px;
        flex-wrap: wrap;
    }
    
    .btn-small {
        padding: 5px 10px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 11px;
        display: inline-flex;
        align-items: center;
        gap: 4px;
        font-weight: 600;
        transition: var(--transition);
    }
    
    .btn-small:hover {
        transform: translateY(-1px);
    }
    
    /* ========== –ü–ê–ì–ò–ù–ê–¶–ò–Ø ========== */
    .pagination {
        display: flex;
        justify-content: center;
        gap: 8px;
        margin: 25px 0;
        padding: 20px;
        background: var(--light-bg);
        border-radius: var(--border-radius);
        border: 2px solid var(--primary-color);
        flex-wrap: wrap;
    }
    
    .page-btn {
        padding: 7px 14px;
        border: 1px solid var(--primary-color);
        background: white;
        border-radius: var(--border-radius);
        cursor: pointer;
        color: var(--primary-color);
        font-weight: 600;
        transition: var(--transition);
        font-size: 13px;
        min-width: 40px;
        text-align: center;
    }
    
    .page-btn:hover {
        background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
        color: white;
        border-color: transparent;
        transform: translateY(-1px);
    }
    
    .page-btn.active {
        background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
        color: white;
        border-color: transparent;
    }
    
    /* ========== –ö–ù–û–ü–ö–ò –î–ï–ô–°–¢–í–ò–ô ========== */
    .action-btns {
        display: flex;
        gap: 15px;
        justify-content: center;
        margin-top: 25px;
        padding-top: 25px;
        border-top: 2px solid var(--primary-color);
        flex-wrap: wrap;
    }
    
    /* ========== –ö–ê–õ–ï–ù–î–ê–†–¨ ========== */
    .calendar-section {
        background: white;
        border-radius: 12px;
        padding: 25px;
        margin: 25px 0;
        box-shadow: var(--box-shadow);
        border: 2px solid var(--primary-color);
    }
    
    .calendar-grid {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 8px;
        margin: 20px 0;
    }
    
    .calendar-weekday {
        text-align: center;
        padding: 12px 0;
        font-weight: 600;
        color: var(--primary-color);
        background: var(--light-bg);
        border-radius: var(--border-radius);
    }
    
    .calendar-day {
        text-align: center;
        padding: 15px 0;
        border-radius: var(--border-radius);
        cursor: pointer;
        transition: var(--transition);
        font-weight: 600;
        background: white;
        border: 1px solid #e9ecef;
    }
    
    .calendar-day:hover {
        background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
        color: white;
        transform: scale(1.05);
        border-color: transparent;
    }
    
    .calendar-day.today {
        background: linear-gradient(135deg, var(--success-color) 0%, #2E7D32 100%);
        color: white;
        border-color: transparent;
        box-shadow: 0 2px 5px rgba(76, 175, 80, 0.3);
    }
    
    .calendar-day.event {
        background: linear-gradient(135deg, var(--warning-color) 0%, #F57C00 100%);
        color: white;
        border-color: transparent;
        box-shadow: 0 2px 5px rgba(255, 152, 0, 0.3);
    }
    
    /* ========== –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø ========== */
    .notification-container {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 9999;
        display: flex;
        flex-direction: column;
        gap: 10px;
    }
    
    .notification {
        background: white;
        padding: 15px 20px;
        border-radius: var(--border-radius);
        box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        display: flex;
        align-items: center;
        gap: 12px;
        min-width: 300px;
        max-width: 400px;
        transform: translateX(150%);
        transition: transform 0.3s ease;
        border-left: 5px solid var(--success-color);
    }
    
    .notification.show {
        transform: translateX(0);
    }
    
    .notification.error {
        border-left-color: var(--danger-color);
    }
    
    .notification.warning {
        border-left-color: var(--warning-color);
    }
    
    .notification.info {
        border-left-color: var(--info-color);
    }
    
    .notification-icon {
        font-size: 20px;
    }
    
    .notification-content {
        flex-grow: 1;
    }
    
    .notification-title {
        font-weight: 600;
        margin-bottom: 3px;
    }
    
    .notification-message {
        font-size: 13px;
        color: #666;
    }
    
    /* ========== –ú–û–î–ê–õ–¨–ù–´–ï –û–ö–ù–ê ========== */
    .modal-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0,0,0,0.7);
        z-index: 9999;
        align-items: center;
        justify-content: center;
        padding: 20px;
        animation: fadeIn 0.3s ease;
    }
    
    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }
    
    .modal {
        background: white;
        border-radius: 12px;
        padding: 30px;
        min-width: 500px;
        max-width: 800px;
        max-height: 90vh;
        overflow-y: auto;
        box-shadow: 0 15px 35px rgba(0,0,0,0.3);
        border: 2px solid var(--primary-color);
        animation: slideUp 0.3s ease;
    }
    
    @keyframes slideUp {
        from { opacity: 0; transform: translateY(30px); }
        to { opacity: 1; transform: translateY(0); }
    }
    
    .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 25px;
        padding-bottom: 15px;
        border-bottom: 2px solid var(--primary-color);
    }
    
    .modal-title {
        font-size: 20px;
        font-weight: bold;
        color: var(--dark-text);
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .modal-close {
        background: none;
        border: none;
        font-size: 28px;
        cursor: pointer;
        color: #666;
        transition: var(--transition);
        width: 36px;
        height: 36px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .modal-close:hover {
        background: var(--light-bg);
        color: var(--primary-color);
    }
    
    /* ========== –ê–ö–¢–ò–í–ù–´–ô –í–ò–ó–ò–¢ ========== */
    .active-visit-bar {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        background: linear-gradient(135deg, var(--success-color) 0%, #2E7D32 100%);
        color: white;
        padding: 12px 25px;
        display: none;
        z-index: 9998;
        box-shadow: 0 -4px 15px rgba(76, 175, 80, 0.3);
        animation: slideUpBar 0.3s ease;
    }
    
    @keyframes slideUpBar {
        from { transform: translateY(100%); }
        to { transform: translateY(0); }
    }
    
    .active-visit-info {
        display: flex;
        justify-content: space-between;
        align-items: center;
        max-width: 1400px;
        margin: 0 auto;
        font-size: 14px;
    }
    
    .active-visit-info strong {
        margin-right: 8px;
    }
    
    /* ========== –§–£–¢–ï–† ========== */
    .crm-footer {
        background: linear-gradient(135deg, #2d3748 0%, #1a202c 100%);
        color: white;
        padding: 30px 20px 20px;
        margin-top: 40px;
        border-top: 3px solid var(--primary-color);
    }
    
    .footer-container {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 30px;
        max-width: 1400px;
        margin: 0 auto;
    }
    
    .footer-column h3 {
        margin-bottom: 18px;
        font-size: 15px;
        color: var(--primary-color);
        font-weight: bold;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    
    .footer-links {
        list-style: none;
        padding: 0;
    }
    
    .footer-links li {
        margin-bottom: 10px;
    }
    
    .footer-links a {
        color: white;
        text-decoration: none;
        font-size: 13px;
        display: flex;
        align-items: center;
        gap: 10px;
        transition: var(--transition);
        padding: 5px 0;
    }
    
    .footer-links a:hover {
        color: var(--primary-color);
        transform: translateX(5px);
    }
    
    .footer-btn {
        background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
        color: white;
        border: none;
        padding: 10px 18px;
        border-radius: var(--border-radius);
        cursor: pointer;
        font-size: 13px;
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 12px;
        width: 100%;
        justify-content: center;
        transition: var(--transition);
    }
    
    .footer-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 10px rgba(102, 126, 234, 0.3);
    }
    
    .copyright {
        text-align: center;
        margin-top: 30px;
        padding-top: 20px;
        border-top: 1px solid rgba(255,255,255,0.1);
        font-size: 13px;
        color: #aaa;
    }
    
    /* ========== –ê–ö–¢–ò–í–ù–´–ï –§–ò–õ–¨–¢–†–´ ========== */
    .filters-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
    }
    
    .filter-controls {
        display: flex;
        gap: 12px;
        align-items: center;
    }
    
    .filter-reset-btn {
        background: var(--danger-color);
        color: white;
        border: none;
        padding: 7px 14px;
        border-radius: var(--border-radius);
        cursor: pointer;
        font-size: 12px;
        display: flex;
        align-items: center;
        gap: 6px;
        font-weight: 600;
        transition: var(--transition);
    }
    
    .filter-reset-btn:hover {
        background: #d32f2f;
        transform: translateY(-1px);
    }
    
    .active-filters {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        margin: 15px 0;
        padding: 15px;
        background: #f0f7f0;
        border-radius: var(--border-radius);
        border-left: 5px solid var(--success-color);
        min-height: 55px;
        align-items: center;
    }
    
    .filter-tag {
        background: linear-gradient(135deg, var(--success-color) 0%, #2E7D32 100%);
        color: white;
        padding: 5px 12px;
        border-radius: 20px;
        font-size: 12px;
        display: flex;
        align-items: center;
        gap: 6px;
        font-weight: 600;
    }
    
    .filter-tag-remove {
        cursor: pointer;
        font-size: 11px;
        opacity: 0.8;
    }
    
    .filter-tag-remove:hover {
        opacity: 1;
    }
    
    /* ========== –†–ï–ì–ò–°–¢–†–ê–¶–ò–û–ù–ù–ê–Ø –§–û–†–ú–ê ========== */
    .form-group {
        margin-bottom: 20px;
    }
    
    .form-label {
        display: block;
        margin-bottom: 6px;
        font-weight: 600;
        color: var(--dark-text);
        font-size: 13px;
    }
    
    .form-input {
        width: 100%;
        padding: 12px 15px;
        border: 2px solid #e9ecef;
        border-radius: var(--border-radius);
        font-size: 14px;
        transition: var(--transition);
    }
    
    .form-input:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }
    
    .form-textarea {
        width: 100%;
        padding: 12px 15px;
        border: 2px solid #e9ecef;
        border-radius: var(--border-radius);
        font-size: 14px;
        min-height: 120px;
        resize: vertical;
        transition: var(--transition);
    }
    
    .form-textarea:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }
    
    /* ========== –ó–ê–ì–†–£–ó–ö–ê –§–ê–ô–õ–û–í ========== */
    .file-upload-area {
        border: 3px dashed var(--primary-color);
        border-radius: var(--border-radius);
        padding: 40px;
        text-align: center;
        background: var(--light-bg);
        cursor: pointer;
        transition: var(--transition);
        margin-bottom: 20px;
    }
    
    .file-upload-area:hover {
        border-color: var(--secondary-color);
        background: #f3f0ff;
    }
    
    .file-upload-area.active {
        border-color: var(--success-color);
        background: #e8f5e9;
    }
    
    .file-upload-icon {
        font-size: 48px;
        color: var(--primary-color);
        margin-bottom: 15px;
    }
    
    .file-list {
        max-height: 300px;
        overflow-y: auto;
        margin: 20px 0;
        border: 1px solid #e9ecef;
        border-radius: var(--border-radius);
        padding: 15px;
    }
    
    .file-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px;
        border-bottom: 1px solid #e9ecef;
    }
    
    .file-item:last-child {
        border-bottom: none;
    }
    
    .file-info {
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .file-icon {
        color: var(--primary-color);
    }
    
    /* ========== –ü–†–û–ì–†–ï–°–° –ë–ê–† ========== */
    .progress-container {
        background: #e9ecef;
        border-radius: 10px;
        height: 10px;
        overflow: hidden;
        margin: 15px 0;
    }
    
    .progress-bar {
        height: 100%;
        background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
        transition: width 0.3s ease;
    }
    
    /* ========== –ú–û–ë–ò–õ–¨–ù–ê–Ø –ê–î–ê–ü–¢–ê–¶–ò–Ø ========== */
    .mobile-action-fab {
        position: fixed;
        bottom: 80px;
        right: 20px;
        width: 56px;
        height: 56px;
        background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
        color: white;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
        box-shadow: 0 4px 20px rgba(102, 126, 234, 0.5);
        z-index: 9997;
        cursor: pointer;
        transition: var(--transition);
        display: none;
    }
    
    .mobile-action-fab:hover {
        transform: scale(1.1);
    }
    
    .pull-to-refresh {
        position: fixed;
        top: -60px;
        left: 0;
        right: 0;
        height: 60px;
        background: white;
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 9999;
        transition: transform 0.3s ease;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    
    .pull-to-refresh.active {
        transform: translateY(60px);
    }
    
    /* ========== –û–¢–í–ï–¢–°–¢–í–ï–ù–ù–´–ô –î–ò–ó–ê–ô–ù ========== */
    @media (max-width: 1200px) {
        .header-container {
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .manager-selector {
            min-width: 250px;
        }
    }
    
    @media (max-width: 768px) {
        .crm-main {
            padding: 0 15px;
        }
        
        .menu-grid {
            grid-template-columns: 1fr;
        }
        
        .stats-grid {
            grid-template-columns: repeat(2, 1fr);
        }
        
        .section-header {
            flex-direction: column;
            gap: 15px;
            align-items: flex-start;
        }
        
        .section-actions {
            width: 100%;
            justify-content: flex-start;
        }
        
        .filters-grid {
            grid-template-columns: 1fr;
        }
        
        .action-btns {
            flex-direction: column;
        }
        
        .modal {
            min-width: auto;
            width: 95%;
            padding: 20px;
        }
        
        .footer-container {
            grid-template-columns: 1fr;
        }
        
        .mobile-action-fab {
            display: flex;
        }
    }
    
    @media (max-width: 480px) {
        .stats-grid {
            grid-template-columns: 1fr;
        }
        
        .header-actions {
            flex-wrap: wrap;
        }
        
        .btn-visit-header {
            min-width: 140px;
            font-size: 13px;
        }
        
        .menu-card {
            padding: 20px;
        }
        
        .file-upload-area {
            padding: 20px;
        }
    }
    </style>
</head>
<body>
    <!-- –®–ê–ü–ö–ê -->
    <header class="crm-header">
        <div class="header-container">
            <div class="logo">
                <i class="fas fa-chart-line"></i>
                <span>–í–ï–†–¢–£–ú CRM</span>
            </div>

            <div class="manager-selector">
                <div class="current-manager" id="currentManager" onclick="toggleManagerDropdown()">
                    <div class="manager-info">
                        <div class="manager-name" id="currentManagerName">–•–∏—Å–º–∞—Ç—É–ª–ª–∏–Ω –†—É—Å—Ç–∞–º –®–∞—Ñ–∫–∞—Ç–æ–≤–∏—á</div>
                        <div class="manager-contacts" id="currentManagerContacts">
                            hrs@vertum.su ‚Ä¢ +7 (985) 710-21-27
                        </div>
                    </div>
                    <i class="fas fa-chevron-down manager-arrow"></i>
                </div>
                
                <div class="managers-dropdown" id="managersDropdown">
                    <div class="manager-option active" onclick="selectManager('–•–∏—Å–º–∞—Ç—É–ª–ª–∏–Ω')">
                        <i class="fas fa-user-tie"></i>
                        <div>
                            <div class="manager-name">–•–∏—Å–º–∞—Ç—É–ª–ª–∏–Ω –†—É—Å—Ç–∞–º –®–∞—Ñ–∫–∞—Ç–æ–≤–∏—á</div>
                            <div class="manager-contacts">hrs@vertum.su ‚Ä¢ +7 (985) 710-21-27</div>
                        </div>
                    </div>
                    <div class="manager-option" onclick="selectManager('–•–∏—Ç—Ä–æ–≤')">
                        <i class="fas fa-user-tie"></i>
                        <div>
                            <div class="manager-name">–•–∏—Ç—Ä–æ–≤ –ö–∏—Ä–∏–ª–ª –Æ—Ä—å–µ–≤–∏—á</div>
                            <div class="manager-contacts">hky@vertum.su ‚Ä¢ +7 (909) 624-99-00</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="header-actions">
                <button class="header-btn" onclick="syncData()">
                    <i class="fas fa-sync-alt"></i> –°–∏–Ω—Ö—Ä.
                </button>
                <button class="header-btn" onclick="sendReport()">
                    <i class="fas fa-paper-plane"></i> –û—Ç—á–µ—Ç
                </button>
                <button class="btn-visit-header" onclick="startVisit()" id="startVisitBtn">
                    <i class="fas fa-play-circle"></i> –ù–ê–ß–ê–¢–¨ –í–ò–ó–ò–¢
                </button>
            </div>
        </div>
    </header>

    <!-- –ü–£–õ–¢–û–£–û–ë–ù–û–í–õ–ï–ù–ò–ï -->
    <div class="pull-to-refresh" id="pullToRefresh">
        <i class="fas fa-sync-alt fa-spin" style="color: var(--primary-color);"></i>
        <span style="margin-left: 10px;">–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö...</span>
    </div>

    <!-- –ú–û–ë–ò–õ–¨–ù–ê–Ø FAB –ö–ù–û–ü–ö–ê -->
    <div class="mobile-action-fab" id="mobileFab" onclick="openMobileMenu()">
        <i class="fas fa-plus"></i>
    </div>

    <!-- –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø -->
    <div class="notification-container" id="notificationContainer"></div>

    <!-- –ê–ö–¢–ò–í–ù–´–ô –í–ò–ó–ò–¢ -->
    <div class="active-visit-bar" id="activeVisitBar">
        <div class="active-visit-info">
            <div>
                <strong>üöó –ê–ö–¢–ò–í–ù–´–ô –í–ò–ó–ò–¢:</strong> 
                <span id="activeVisitClient"></span> ‚Ä¢ 
                <span id="activeVisitTime"></span>
                <span id="activeVisitDuration" style="margin-left: 15px;"></span>
            </div>
            <button class="btn-visit-header" onclick="openActiveVisit()">
                <i class="fas fa-external-link-alt"></i> –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å
            </button>
        </div>
    </div>

    <!-- –û–°–ù–û–í–ù–û–ô –ö–û–ù–¢–ï–ô–ù–ï–† -->
    <main class="crm-main">
        <!-- –ì–õ–ê–í–ù–û–ï –ú–ï–ù–Æ -->
        <div class="menu-grid" id="mainMenu">
            <div class="menu-card active" onclick="showSection('clients')" data-section="clients">
                <div class="menu-icon">
                    <i class="fas fa-users"></i>
                    <span class="menu-badge" id="clientsCount">0</span>
                </div>
                <div class="menu-title">–í–°–ï –ö–õ–ò–ï–ù–¢–´</div>
                <div class="menu-subtitle">–¢–∞–±–ª–∏—Ü–∞ —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏, –ø–æ–∏—Å–∫–æ–º –∏ —ç–∫—Å–ø–æ—Ä—Ç–æ–º</div>
                <div class="menu-action">–°–º–æ—Ç—Ä–µ—Ç—å ‚Üí</div>
            </div>

            <div class="menu-card" onclick="showSection('excelData')" data-section="excelData">
                <div class="menu-icon">
                    <i class="fas fa-file-excel"></i>
                    <span class="menu-badge" id="excelSheetsCount">4</span>
                </div>
                <div class="menu-title">–î–ê–ù–ù–´–ï EXCEL</div>
                <div class="menu-subtitle">–ò–º–ø–æ—Ä—Ç/—ç–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö Excel</div>
                <div class="menu-action">–û—Ç–∫—Ä—ã—Ç—å ‚Üí</div>
            </div>

            <div class="menu-card" onclick="showCalendar()">
                <div class="menu-icon">
                    <i class="fas fa-calendar-alt"></i>
                    <span class="menu-badge" id="calendarEvents">3</span>
                </div>
                <div class="menu-title">–ö–ê–õ–ï–ù–î–ê–†–¨</div>
                <div class="menu-subtitle">–í—Å—Ç—Ä–µ—á–∏, –≤–∏–∑–∏—Ç—ã, –¥–Ω–∏ —Ä–æ–∂–¥–µ–Ω–∏—è</div>
                <div class="menu-action">–ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å ‚Üí</div>
            </div>

            <div class="menu-card" onclick="showSection('fileUpload')" data-section="fileUpload">
                <div class="menu-icon">
                    <i class="fas fa-file-upload"></i>
                    <span class="menu-badge" id="uploadedFiles">0</span>
                </div>
                <div class="menu-title">–ü–ê–†–°–ò–ù–ì –§–ê–ô–õ–û–í</div>
                <div class="menu-subtitle">Excel, PDF, CSV –æ–±—Ä–∞–±–æ—Ç–∫–∞</div>
                <div class="menu-action">–ó–∞–≥—Ä—É–∑–∏—Ç—å ‚Üí</div>
            </div>

            <div class="menu-card" onclick="showVisitsHistory()">
                <div class="menu-icon">
                    <i class="fas fa-history"></i>
                    <span class="menu-badge" id="visitsHistoryCount">0</span>
                </div>
                <div class="menu-title">–ò–°–¢–û–†–ò–Ø –í–ò–ó–ò–¢–û–í</div>
                <div class="menu-subtitle">–ê—Ä—Ö–∏–≤ –≤—Å–µ—Ö –≤—Å—Ç—Ä–µ—á –∏ –≤–∏–∑–∏—Ç–æ–≤</div>
                <div class="menu-action">–ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å ‚Üí</div>
            </div>

            <div class="menu-card" onclick="showRegistrationForm()">
                <div class="menu-icon">
                    <i class="fas fa-user-plus"></i>
                    <span class="menu-badge">+</span>
                </div>
                <div class="menu-title">–†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø</div>
                <div class="menu-subtitle">–ù–æ–≤—ã–π –∫–ª–∏–µ–Ω—Ç –≤ —Å–∏—Å—Ç–µ–º–µ</div>
                <div class="menu-action">–ó–∞–ø–æ–ª–Ω–∏—Ç—å ‚Üí</div>
            </div>

            <div class="menu-card" onclick="startVisit()">
                <div class="menu-icon">
                    <i class="fas fa-play-circle"></i>
                    <span class="menu-badge" id="visitsToday">0</span>
                </div>
                <div class="menu-title">–ù–ê–ß–ê–¢–¨ –í–ò–ó–ò–¢</div>
                <div class="menu-subtitle">–ê–∫—Ç–∏–≤–Ω—ã–µ –ø–æ—Å–µ—â–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–æ–≤</div>
                <div class="menu-action">–°–¢–ê–†–¢ ‚Üí</div>
            </div>
        </div>

        <!-- –ú–ò–ù–ò-–ö–ê–õ–ï–ù–î–ê–†–¨ -->
        <div class="calendar-section" id="miniCalendar">
            <div class="section-header">
                <div class="section-title">
                    <i class="fas fa-calendar-day"></i>
                    –ë–õ–ò–ñ–ê–ô–®–ò–ï –í–°–¢–†–ï–ß–ò
                </div>
                <button class="action-btn btn-info" onclick="showCalendar()">
                    <i class="fas fa-expand"></i> –í–µ—Å—å –∫–∞–ª–µ–Ω–¥–∞—Ä—å
                </button>
            </div>
            
            <div class="calendar-grid">
                <div class="calendar-weekday">–ü–Ω</div>
                <div class="calendar-weekday">–í—Ç</div>
                <div class="calendar-weekday">–°—Ä</div>
                <div class="calendar-weekday">–ß—Ç</div>
                <div class="calendar-weekday">–ü—Ç</div>
                <div class="calendar-weekday">–°–±</div>
                <div class="calendar-weekday">–í—Å</div>
                
                <!-- –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
            
            <div style="margin-top: 20px;" id="calendarEventsList">
                <!-- –°–æ–±—ã—Ç–∏—è –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
        </div>

        <!-- –°–¢–ê–¢–ò–°–¢–ò–ö–ê -->
        <div class="stats-grid">
            <div class="stat-card">
                <i class="fas fa-users"></i>
                <div class="stat-value" id="statTotalClients">0</div>
                <div class="stat-label">–í—Å–µ–≥–æ –∫–ª–∏–µ–Ω—Ç–æ–≤</div>
            </div>

            <div class="stat-card">
                <i class="fas fa-ruble-sign"></i>
                <div class="stat-value">158.4M ‚ÇΩ</div>
                <div class="stat-label">–ü—Ä–æ–¥–∞–∂–∏ 2025</div>
            </div>

            <div class="stat-card">
                <i class="fas fa-bullseye"></i>
                <div class="stat-value">210M ‚ÇΩ</div>
                <div class="stat-label">–ü–ª–∞–Ω 2026</div>
            </div>

            <div class="stat-card">
                <i class="fas fa-calendar-check"></i>
                <div class="stat-value" id="statVisitsCount">0</div>
                <div class="stat-label">–í–∏–∑–∏—Ç–æ–≤ –≤ 2026</div>
            </div>

            <div class="stat-card">
                <i class="fas fa-percentage"></i>
                <div class="stat-value">24%</div>
                <div class="stat-label">–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–ª–∞–Ω–∞</div>
            </div>

            <div class="stat-card">
                <i class="fas fa-boxes"></i>
                <div class="stat-value">7</div>
                <div class="stat-label">–¢–æ–≤–∞—Ä–Ω—ã—Ö –≥—Ä—É–ø–ø</div>
            </div>
        </div>

        <!-- –†–ê–ó–î–ï–õ "–í–°–ï –ö–õ–ò–ï–ù–¢–´" -->
        <div id="clientsSection" class="section-container">
            <div class="section-header">
                <div class="section-title">
                    <i class="fas fa-users"></i>
                    –í–°–ï –ö–õ–ò–ï–ù–¢–´
                    <span class="manager-badge" id="currentManagerBadge">–•–∏—Å–º–∞—Ç—É–ª–ª–∏–Ω –†.–®.</span>
                </div>
                <div class="section-actions">
                    <span class="counter-badge" id="filteredCount">
                        –ü–æ–∫–∞–∑–∞–Ω–æ: <strong>0</strong> –∏–∑ <strong>0</strong>
                    </span>
                    <button class="action-btn btn-success" onclick="exportCSV()">
                        <i class="fas fa-file-csv"></i> CSV
                    </button>
                    <button class="action-btn btn-primary" onclick="exportToExcel()">
                        <i class="fas fa-file-excel"></i> Excel
                    </button>
                    <button class="action-btn btn-info" onclick="generateReport()">
                        <i class="fas fa-chart-bar"></i> –û—Ç—á–µ—Ç
                    </button>
                    <button class="action-btn btn-green" onclick="showRegistrationForm()">
                        <i class="fas fa-plus"></i> –ù–æ–≤—ã–π –∫–ª–∏–µ–Ω—Ç
                    </button>
                    <button class="btn-visit-header" style="padding: 8px 15px; font-size: 13px;" onclick="startVisitFromTable()">
                        <i class="fas fa-play-circle"></i> –ù–∞—á–∞—Ç—å –≤–∏–∑–∏—Ç
                    </button>
                </div>
            </div>

            <!-- –ü–ê–ù–ï–õ–¨ –£–ü–†–ê–í–õ–ï–ù–ò–Ø –§–ò–õ–¨–¢–†–ê–ú–ò -->
            <div class="filters-header">
                <h4><i class="fas fa-filter"></i> –§–ò–õ–¨–¢–†–´ –ö–õ–ò–ï–ù–¢–û–í</h4>
                <div class="filter-controls">
                    <button class="filter-reset-btn" onclick="resetAllFilters()">
                        <i class="fas fa-times"></i> –°–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ
                    </button>
                    <span class="counter-badge" id="activeFiltersCount">–ê–∫—Ç–∏–≤–Ω—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤: 0</span>
                </div>
            </div>

            <!-- –ê–ö–¢–ò–í–ù–´–ï –§–ò–õ–¨–¢–†–´ -->
            <div class="active-filters" id="activeFiltersContainer" style="display: none;">
                <!-- –ê–∫—Ç–∏–≤–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∑–¥–µ—Å—å -->
            </div>

            <!-- –ü–û–ò–°–ö -->
            <div class="search-box">
                <input type="text" class="search-input" id="searchInput" 
                       placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ –∫–æ–¥—É, –Ω–∞–∑–≤–∞–Ω–∏—é, –∞–¥—Ä–µ—Å—É, —Ç–µ–ª–µ—Ñ–æ–Ω—É..." 
                       oninput="filterTable()">
            </div>

            <!-- –§–ò–õ–¨–¢–†–´ -->
            <div class="filters-grid" id="filtersGrid">
                <!-- –§–∏–ª—å—Ç—Ä—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>

            <!-- –¢–ê–ë–õ–ò–¶–ê –ö–õ–ò–ï–ù–¢–û–í -->
            <div class="table-container">
                <table class="data-table" id="clientsTable">
                    <thead id="clientsTableHead">
                        <!-- –ó–∞–≥–æ–ª–æ–≤–∫–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                    </thead>
                    <tbody id="clientsTableBody">
                        <!-- –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                    </tbody>
                </table>
            </div>

            <!-- –ü–ê–ì–ò–ù–ê–¶–ò–Ø -->
            <div class="pagination" id="pagination">
                <!-- –°—Ç—Ä–∞–Ω–∏—Ü—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>

            <!-- –î–ï–ô–°–¢–í–ò–Ø -->
            <div class="action-btns">
                <button class="action-btn" style="background: #666; color: white;" onclick="showSection('main')">
                    <i class="fas fa-arrow-left"></i> –ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é
                </button>
                <button class="action-btn btn-primary" onclick="showRegistrationForm()">
                    <i class="fas fa-user-plus"></i> –ù–æ–≤—ã–π –∫–ª–∏–µ–Ω—Ç
                </button>
                <button class="action-btn btn-info" onclick="generateReport()">
                    <i class="fas fa-chart-bar"></i> –°–æ–∑–¥–∞—Ç—å –æ—Ç—á–µ—Ç
                </button>
                <button class="btn-visit-header" style="padding: 8px 15px; font-size: 13px;" onclick="startVisitFromTable()">
                    <i class="fas fa-play-circle"></i> –ù–∞—á–∞—Ç—å –≤–∏–∑–∏—Ç
                </button>
            </div>
        </div>

        <!-- –†–ê–ó–î–ï–õ "–î–ê–ù–ù–´–ï EXCEL" -->
        <div id="excelDataSection" class="section-container">
            <div class="section-header">
                <div class="section-title">
                    <i class="fas fa-file-excel"></i>
                    –î–ê–ù–ù–´–ï –ò–ó EXCEL –§–ê–ô–õ–ê
                    <span class="manager-badge">–•–∏—Å–º–∞—Ç—É–ª–ª–∏–Ω –ö–ë —Å—Ä–º.xlsx</span>
                </div>
                <div class="section-actions">
                    <span class="counter-badge" id="excelCount">
                        –ó–∞–≥—Ä—É–∂–µ–Ω–æ: <strong>0</strong> –∑–∞–ø–∏—Å–µ–π
                    </span>
                    <button class="action-btn btn-success" onclick="exportExcelToCSV()">
                        <i class="fas fa-download"></i> –≠–∫—Å–ø–æ—Ä—Ç CSV
                    </button>
                    <button class="action-btn" style="background: #666; color: white;" onclick="refreshExcelData()">
                        <i class="fas fa-sync-alt"></i> –û–±–Ω–æ–≤–∏—Ç—å
                    </button>
                    <button class="action-btn btn-info" onclick="generateExcelReport()">
                        <i class="fas fa-chart-bar"></i> –û—Ç—á–µ—Ç –ø–æ Excel
                    </button>
                </div>
            </div>

            <div class="excel-controls" style="margin: 20px 0;">
                <select id="excelSheetSelect" class="filter-select" onchange="loadExcelSheet()" style="margin-right: 10px;">
                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ª–∏—Å—Ç Excel...</option>
                </select>
                
                <input type="text" class="search-input" id="excelSearchInput" 
                       placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ –≤—Å–µ–º –ª–∏—Å—Ç–∞–º..." 
                       style="flex-grow: 1;"
                       oninput="searchExcelData()">
                
                <button class="action-btn btn-warning" onclick="importExcelFile()" style="margin-left: 10px;">
                    <i class="fas fa-upload"></i> –ò–º–ø–æ—Ä—Ç Excel
                </button>
            </div>

            <div class="table-container">
                <table class="data-table" id="excelDataTable">
                    <thead id="excelTableHead">
                        <!-- –ó–∞–≥–æ–ª–æ–≤–∫–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                    </thead>
                    <tbody id="excelTableBody">
                        <!-- –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                    </tbody>
                </table>
            </div>

            <div class="excel-stats" id="excelStats" style="display: flex; gap: 15px; margin-top: 20px; flex-wrap: wrap;">
                <div style="background: white; padding: 15px; border-radius: 10px; border-left: 4px solid var(--primary-color); min-width: 150px; border: 1px solid #e9ecef;">
                    <div style="font-size: 12px; color: #666; margin-bottom: 5px; font-weight: 600;">–¢–µ–∫—É—â–∏–π –ª–∏—Å—Ç</div>
                    <div style="font-size: 18px; font-weight: bold; color: var(--dark-text);" id="currentSheetName">‚Äî</div>
                </div>
                <div style="background: white; padding: 15px; border-radius: 10px; border-left: 4px solid var(--success-color); min-width: 150px; border: 1px solid #e9ecef;">
                    <div style="font-size: 12px; color: #666; margin-bottom: 5px; font-weight: 600;">–ó–∞–ø–∏—Å–µ–π</div>
                    <div style="font-size: 18px; font-weight: bold; color: var(--dark-text);" id="excelRowCount">0</div>
                </div>
                <div style="background: white; padding: 15px; border-radius: 10px; border-left: 4px solid var(--info-color); min-width: 150px; border: 1px solid #e9ecef;">
                    <div style="font-size: 12px; color: #666; margin-bottom: 5px; font-weight: 600;">–°—Ç–æ–ª–±—Ü–æ–≤</div>
                    <div style="font-size: 18px; font-weight: bold; color: var(--dark-text);" id="excelColCount">0</div>
                </div>
                <div style="background: white; padding: 15px; border-radius: 10px; border-left: 4px solid var(--warning-color); min-width: 150px; border: 1px solid #e9ecef;">
                    <div style="font-size: 12px; color: #666; margin-bottom: 5px; font-weight: 600;">–û–±–Ω–æ–≤–ª–µ–Ω–æ</div>
                    <div style="font-size: 18px; font-weight: bold; color: var(--dark-text);" id="excelUpdateTime">‚Äî</div>
                </div>
            </div>

            <div class="action-btns">
                <button class="action-btn" style="background: #666; color: white;" onclick="showSection('main')">
                    <i class="fas fa-arrow-left"></i> –ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é
                </button>
                <button class="action-btn btn-success" onclick="exportExcelToCSV()">
                    <i class="fas fa-download"></i> –≠–∫—Å–ø–æ—Ä—Ç CSV
                </button>
                <button class="action-btn btn-primary" onclick="exportToExcel()">
                    <i class="fas fa-file-excel"></i> –≠–∫—Å–ø–æ—Ä—Ç Excel
                </button>
            </div>
        </div>

        <!-- –†–ê–ó–î–ï–õ "–ü–ê–†–°–ò–ù–ì –§–ê–ô–õ–û–í" -->
        <div id="fileUploadSection" class="section-container">
            <div class="section-header">
                <div class="section-title">
                    <i class="fas fa-file-upload"></i>
                    –ü–ê–†–°–ò–ù–ì –ò –û–ë–†–ê–ë–û–¢–ö–ê –§–ê–ô–õ–û–í
                    <span class="manager-badge">Excel ‚Ä¢ PDF ‚Ä¢ CSV</span>
                </div>
                <div class="section-actions">
                    <span class="counter-badge" id="parsedFilesCount">
                        –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ: <strong>0</strong> —Ñ–∞–π–ª–æ–≤
                    </span>
                    <button class="action-btn btn-info" onclick="loadParsedFiles()">
                        <i class="fas fa-history"></i> –ò—Å—Ç–æ—Ä–∏—è
                    </button>
                </div>
            </div>

            <div style="padding: 20px;">
                <!-- –û–ë–õ–ê–°–¢–¨ –ó–ê–ì–†–£–ó–ö–ò -->
                <div class="file-upload-area" id="dropZone" 
                     onclick="document.getElementById('fileInput').click()"
                     ondrop="handleDrop(event)"
                     ondragover="handleDragOver(event)"
                     ondragleave="handleDragLeave(event)">
                    <div class="file-upload-icon">
                        <i class="fas fa-cloud-upload-alt"></i>
                    </div>
                    <h3 style="color: var(--primary-color); margin-bottom: 10px;">
                        –ü–ï–†–ï–¢–ê–©–ò–¢–ï –§–ê–ô–õ–´ –°–Æ–î–ê –ò–õ–ò –ù–ê–ñ–ú–ò–¢–ï –î–õ–Ø –í–´–ë–û–†–ê
                    </h3>
                    <p style="color: #666; margin-bottom: 15px;">
                        –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã: Excel (.xlsx, .xls, .csv), PDF (.pdf)
                    </p>
                    <p style="font-size: 12px; color: #999;">
                        –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: 50MB
                    </p>
                </div>

                <!-- –°–ö–†–´–¢–´–ô INPUT -->
                <input type="file" id="fileInput" multiple accept=".xlsx,.xls,.csv,.pdf" 
                       style="display: none;" onchange="handleFileSelect(event)">

                <!-- –ü–†–û–ì–†–ï–°–° –ë–ê–† -->
                <div id="uploadProgress" style="display: none; margin: 20px 0;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                        <span id="progressFileName">–§–∞–π–ª –Ω–µ –≤—ã–±—Ä–∞–Ω</span>
                        <span id="progressPercent">0%</span>
                    </div>
                    <div class="progress-container">
                        <div class="progress-bar" id="progressBar" style="width: 0%"></div>
                    </div>
                    <div id="progressStatus" style="text-align: center; font-size: 12px; color: #666; margin-top: 5px;">
                        –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –∑–∞–≥—Ä—É–∑–∫–µ...
                    </div>
                </div>

                <!-- –í–´–ë–†–ê–ù–ù–´–ï –§–ê–ô–õ–´ -->
                <div id="selectedFiles" style="display: none;">
                    <h4 style="margin-bottom: 15px; color: var(--dark-text);">
                        <i class="fas fa-file-alt"></i> –í—ã–±—Ä–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:
                    </h4>
                    <div class="file-list" id="fileList">
                        <!-- –§–∞–π–ª—ã –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∑–¥–µ—Å—å -->
                    </div>
                    <div style="display: flex; gap: 10px; margin-top: 15px;">
                        <button class="action-btn btn-success" onclick="uploadFiles()">
                            <i class="fas fa-upload"></i> –ó–∞–≥—Ä—É–∑–∏—Ç—å –∏ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å
                        </button>
                        <button class="action-btn btn-warning" onclick="clearFileSelection()">
                            <i class="fas fa-times"></i> –û—á–∏—Å—Ç–∏—Ç—å
                        </button>
                    </div>
                </div>

                <!-- –†–ï–ó–£–õ–¨–¢–ê–¢–´ –ü–ê–†–°–ò–ù–ì–ê -->
                <div id="parseResults" style="display: none; margin-top: 30px;">
                    <div class="section-header" style="margin-bottom: 20px;">
                        <div class="section-title">
                            <i class="fas fa-chart-bar"></i>
                            –†–ï–ó–£–õ–¨–¢–ê–¢–´ –û–ë–†–ê–ë–û–¢–ö–ò
                        </div>
                        <button class="action-btn btn-info" onclick="exportParsedData()">
                            <i class="fas fa-download"></i> –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö
                        </button>
                    </div>
                    
                    <div id="resultsContainer">
                        <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                    </div>
                </div>

                <!-- –ò–°–¢–û–†–ò–Ø –û–ë–†–ê–ë–û–¢–ö–ò -->
                <div id="parsedFilesHistory" style="display: none; margin-top: 30px;">
                    <div class="section-header" style="margin-bottom: 20px;">
                        <div class="section-title">
                            <i class="fas fa-history"></i>
                            –ò–°–¢–û–†–ò–Ø –û–ë–†–ê–ë–û–¢–ê–ù–ù–´–• –§–ê–ô–õ–û–í
                        </div>
                        <button class="action-btn" onclick="hideParsedFiles()" style="background: #666; color: white;">
                            <i class="fas fa-arrow-left"></i> –ù–∞–∑–∞–¥
                        </button>
                    </div>
                    
                    <div id="historyList" style="max-height: 400px; overflow-y: auto;">
                        <!-- –ò—Å—Ç–æ—Ä–∏—è –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                    </div>
                </div>
            </div>

            <div class="action-btns">
                <button class="action-btn" style="background: #666; color: white;" onclick="showSection('main')">
                    <i class="fas fa-arrow-left"></i> –ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é
                </button>
                <button class="action-btn btn-primary" onclick="document.getElementById('fileInput').click()">
                    <i class="fas fa-folder-open"></i> –í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª—ã
                </button>
                <button class="action-btn btn-success" onclick="loadParsedFiles()">
                    <i class="fas fa-history"></i> –ò—Å—Ç–æ—Ä–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏
                </button>
            </div>
        </div>
    </main>

    <!-- –§–£–¢–ï–† -->
    <footer class="crm-footer">
        <div class="footer-container">
            <div class="footer-column">
                <h3>–í–ï–†–¢–£–ú CRM</h3>
                <p style="font-size: 13px; color: #ccc; margin-bottom: 20px; line-height: 1.5;">
                    –¢–æ—Ä–≥–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞–º–∏. –ü–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ –≤–∏–∑–∏—Ç–∞–º–∏, –≤—Å—Ç—Ä–µ—á–∞–º–∏ –∏ –ø—Ä–æ–¥–∞–∂–∞–º–∏.
                </p>
                <div class="footer-contacts" style="font-size: 13px;">
                    <div style="margin-bottom: 8px;"><i class="fas fa-user"></i> <span id="footerManager">–•–∏—Å–º–∞—Ç—É–ª–ª–∏–Ω –†—É—Å—Ç–∞–º –®–∞—Ñ–∫–∞—Ç–æ–≤–∏—á</span></div>
                    <div style="margin-bottom: 8px;"><i class="fas fa-envelope"></i> <span id="footerEmail">hrs@vertum.su</span></div>
                    <div style="margin-bottom: 8px;"><i class="fas fa-phone"></i> <span id="footerPhone">+7 (985) 710-21-27</span></div>
                    <div><i class="fas fa-database"></i> <span id="footerDataInfo">–ö–ª–∏–µ–Ω—Ç–æ–≤: 0 | –í–∏–∑–∏—Ç–æ–≤: 0</span></div>
                </div>
            </div>
            
            <div class="footer-column">
                <h3>–ë—ã—Å—Ç—Ä—ã–µ —Å—Å—ã–ª–∫–∏</h3>
                <ul class="footer-links">
                    <li><a href="#" onclick="showSection('clients')"><i class="fas fa-users"></i> –í—Å–µ –∫–ª–∏–µ–Ω—Ç—ã</a></li>
                    <li><a href="#" onclick="showSection('excelData')"><i class="fas fa-file-excel"></i> –î–∞–Ω–Ω—ã–µ Excel</a></li>
                    <li><a href="#" onclick="showSection('fileUpload')"><i class="fas fa-file-upload"></i> –ü–∞—Ä—Å–∏–Ω–≥ —Ñ–∞–π–ª–æ–≤</a></li>
                    <li><a href="#" onclick="showCalendar()"><i class="fas fa-calendar-alt"></i> –ö–∞–ª–µ–Ω–¥–∞—Ä—å</a></li>
                    <li><a href="#" onclick="showRegistrationForm()"><i class="fas fa-user-plus"></i> –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a></li>
                    <li><a href="#" onclick="startVisit()"><i class="fas fa-play-circle"></i> –ù–∞—á–∞—Ç—å –≤–∏–∑–∏—Ç</a></li>
                    <li><a href="#" onclick="showVisitsHistory()"><i class="fas fa-history"></i> –ò—Å—Ç–æ—Ä–∏—è –≤–∏–∑–∏—Ç–æ–≤</a></li>
                </ul>
            </div>
            
            <div class="footer-column">
                <h3>–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</h3>
                <div style="display: flex; flex-direction: column; gap: 10px;">
                    <button class="footer-btn" onclick="exportCSV()">
                        <i class="fas fa-file-csv"></i> CSV —Ñ–∞–π–ª
                    </button>
                    <button class="footer-btn" onclick="exportToExcel()">
                        <i class="fas fa-file-excel"></i> Excel —Ñ–∞–π–ª
                    </button>
                    <button class="footer-btn" onclick="generateReport()">
                        <i class="fas fa-chart-bar"></i> –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
                    </button>
                </div>
                
                <h3 style="margin-top: 25px;">–°–∏—Å—Ç–µ–º–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏</h3>
                <div style="display: flex; flex-direction: column; gap: 10px;">
                    <button class="footer-btn" onclick="syncData()" style="font-size: 13px;">
                        <i class="fas fa-sync-alt"></i> –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
                    </button>
                    <button class="footer-btn" onclick="sendReport()" style="font-size: 13px;">
                        <i class="fas fa-paper-plane"></i> –û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç—á–µ—Ç
                    </button>
                </div>
            </div>
        </div>
        
        <div class="copyright">
            ¬© 2024 –í–ï–†–¢–£–ú CRM ‚Ä¢ <span id="currentDate"></span> ‚Ä¢ –í–µ—Ä—Å–∏—è 2.0 ‚Ä¢ 
            <span id="currentTime"></span> ‚Ä¢ <span id="systemStatus">üü¢ –°–∏—Å—Ç–µ–º–∞ –∞–∫—Ç–∏–≤–Ω–∞</span>
        </div>
    </footer>

    <!-- –ú–û–î–ê–õ–¨–ù–´–ï –û–ö–ù–ê -->
    <div class="modal-overlay" id="visitModal">
        <div class="modal" id="modalContainer">
            <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
        </div>
    </div>

    <script>
    // ============================================
    // –ü–û–õ–ù–´–ô –§–£–ù–ö–¶–ò–û–ù–ê–õ CRM –í–ï–†–¢–£–ú 2.0
    // –° –ü–ê–†–°–ò–ù–ì–û–ú EXCEL, PDF –ò EMAIL –û–¢–ü–†–ê–í–ö–û–ô
    // ============================================

    // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
    let allClientsData = [];
    let filteredClientsData = [];
    let currentPage = 1;
    const itemsPerPage = 20;
    let activeVisit = null;
    let selectedClientForVisit = null;
    let visitTimer = null;
    let visitStartTime = null;
    let currentCalendarMonth = new Date().getMonth();
    let currentCalendarYear = new Date().getFullYear();
    let excelData = null;
    let selectedFiles = [];
    let isRefreshing = false;

    // –ë–∞–∑–æ–≤—ã–π URL API
    const API_BASE_URL = 'http://localhost:3000/api';

    // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤
    const MANAGERS_CONFIG = {
        '–•–∏—Å–º–∞—Ç—É–ª–ª–∏–Ω': {
            name: '–•–∏—Å–º–∞—Ç—É–ª–ª–∏–Ω –†—É—Å—Ç–∞–º –®–∞—Ñ–∫–∞—Ç–æ–≤–∏—á',
            email: 'hrs@vertum.su',
            phone: '+7 (985) 710-21-27',
            short: '–•–∏—Å–º–∞—Ç—É–ª–ª–∏–Ω –†.–®.',
            reportTo: 'ddn@vertum.su',
            reportBcc: 'hrs@vertum.su'
        },
        '–•–∏—Ç—Ä–æ–≤': {
            name: '–•–∏—Ç—Ä–æ–≤ –ö–∏—Ä–∏–ª–ª –Æ—Ä—å–µ–≤–∏—á',
            email: 'hky@vertum.su',
            phone: '+7 (909) 624-99-00',
            short: '–•–∏—Ç—Ä–æ–≤ –ö.–Æ.',
            reportTo: 'ddn@vertum.su',
            reportBcc: 'hky@vertum.su'
        }
    };

    let currentManager = MANAGERS_CONFIG['–•–∏—Å–º–∞—Ç—É–ª–ª–∏–Ω'];

    // 1. –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –°–ò–°–¢–ï–ú–´
    document.addEventListener('DOMContentLoaded', function() {
        console.log('üöÄ –ó–∞–ø—É—Å–∫ –í–ï–†–¢–£–ú CRM v2.0 —Å –ø–∞—Ä—Å–∏–Ω–≥–æ–º —Ñ–∞–π–ª–æ–≤...');
        
        initializeSystem();
        updateDateTime();
        checkActiveVisit();
        initializeMiniCalendar();
        setupTouchEvents();
        setupServiceWorker();
        setupFileUpload();
        checkServerHealth();
        
        console.log('‚úÖ –í–ï–†–¢–£–ú CRM –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ');
    });

    function initializeSystem() {
        loadClientsData();
        updateManagerUI();
        initializeFilters();
        updateStatistics();
        updateSystemInfo();
        loadCalendarEvents();
        initializeMobileFab();
    }

    // 2. API –í–ó–ê–ò–ú–û–î–ï–ô–°–¢–í–ò–ï
    async function fetchWithCORS(url, options = {}) {
        const defaultOptions = {
            headers: {
                'Content-Type': 'application/json',
                'Accept': 'application/json'
            },
            credentials: 'same-origin',
            mode: 'cors'
        };

        const mergedOptions = { ...defaultOptions, ...options };

        try {
            const response = await fetch(url, mergedOptions);
            
            if (!response.ok) {
                throw new Error(`HTTP ${response.status}: ${response.statusText}`);
            }
            
            const contentType = response.headers.get('content-type');
            if (contentType && contentType.includes('application/json')) {
                return await response.json();
            } else {
                return await response.text();
            }
        } catch (error) {
            console.error('API Error:', error);
            showNotification(`–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${error.message}`, 'error');
            throw error;
        }
    }

    // 3. –ü–ê–†–°–ò–ù–ì –§–ê–ô–õ–û–í - –û–°–ù–û–í–ù–´–ï –§–£–ù–ö–¶–ò–ò
    function setupFileUpload() {
        const dropZone = document.getElementById('dropZone');
        const fileInput = document.getElementById('fileInput');
        
        if (!dropZone || !fileInput) return;
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ drag & drop
        dropZone.addEventListener('dragover', function(e) {
            e.preventDefault();
            dropZone.classList.add('active');
        });
        
        dropZone.addEventListener('dragleave', function() {
            dropZone.classList.remove('active');
        });
    }

    function handleDragOver(e) {
        e.preventDefault();
        e.stopPropagation();
        document.getElementById('dropZone').classList.add('active');
    }

    function handleDragLeave(e) {
        e.preventDefault();
        e.stopPropagation();
        document.getElementById('dropZone').classList.remove('active');
    }

    function handleDrop(e) {
        e.preventDefault();
        e.stopPropagation();
        
        document.getElementById('dropZone').classList.remove('active');
        
        const files = e.dataTransfer.files;
        if (files.length > 0) {
            handleFiles(files);
        }
    }

    function handleFileSelect(e) {
        const files = e.target.files;
        if (files.length > 0) {
            handleFiles(files);
        }
    }

    function handleFiles(files) {
        selectedFiles = Array.from(files);
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤ —Ñ–∞–π–ª–æ–≤
        const allowedTypes = [
            'application/vnd.ms-excel',
            'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',
            'application/pdf',
            'text/csv',
            'application/vnd.oasis.opendocument.spreadsheet'
        ];
        
        const validFiles = selectedFiles.filter(file => {
            return allowedTypes.includes(file.type) || 
                   file.name.match(/\.(xlsx|xls|csv|pdf)$/i);
        });
        
        if (validFiles.length !== selectedFiles.length) {
            showNotification('–ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Ñ–∞–π–ª—ã –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è', 'warning');
        }
        
        selectedFiles = validFiles;
        
        if (selectedFiles.length > 0) {
            displaySelectedFiles();
        }
    }

    function displaySelectedFiles() {
        const fileList = document.getElementById('fileList');
        const selectedFilesDiv = document.getElementById('selectedFiles');
        
        if (!fileList || !selectedFilesDiv) return;
        
        fileList.innerHTML = '';
        
        selectedFiles.forEach((file, index) => {
            const fileSize = (file.size / 1024 / 1024).toFixed(2);
            const fileItem = document.createElement('div');
            fileItem.className = 'file-item';
            fileItem.innerHTML = `
                <div class="file-info">
                    <i class="fas ${getFileIcon(file)} file-icon"></i>
                    <div>
                        <div style="font-weight: 600;">${file.name}</div>
                        <div style="font-size: 12px; color: #666;">
                            ${fileSize} MB ‚Ä¢ ${file.type || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ç–∏–ø'}
                        </div>
                    </div>
                </div>
                <button onclick="removeFile(${index})" class="btn-small" style="background: var(--danger-color); color: white;">
                    <i class="fas fa-times"></i>
                </button>
            `;
            fileList.appendChild(fileItem);
        });
        
        selectedFilesDiv.style.display = 'block';
        document.getElementById('uploadProgress').style.display = 'none';
        document.getElementById('parseResults').style.display = 'none';
    }

    function getFileIcon(file) {
        if (file.type.includes('pdf')) return 'fa-file-pdf';
        if (file.type.includes('excel') || file.type.includes('spreadsheet')) return 'fa-file-excel';
        if (file.type.includes('csv')) return 'fa-file-csv';
        return 'fa-file';
    }

    function removeFile(index) {
        selectedFiles.splice(index, 1);
        if (selectedFiles.length === 0) {
            document.getElementById('selectedFiles').style.display = 'none';
        } else {
            displaySelectedFiles();
        }
    }

    function clearFileSelection() {
        selectedFiles = [];
        document.getElementById('selectedFiles').style.display = 'none';
        document.getElementById('fileInput').value = '';
    }

    async function uploadFiles() {
        if (selectedFiles.length === 0) {
            showNotification('–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª—ã –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏', 'warning');
            return;
        }
        
        const progressDiv = document.getElementById('uploadProgress');
        const progressBar = document.getElementById('progressBar');
        const progressPercent = document.getElementById('progressPercent');
        const progressStatus = document.getElementById('progressStatus');
        const progressFileName = document.getElementById('progressFileName');
        
        progressDiv.style.display = 'block';
        document.getElementById('selectedFiles').style.display = 'none';
        
        let results = [];
        
        for (let i = 0; i < selectedFiles.length; i++) {
            const file = selectedFiles[i];
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å
            progressFileName.textContent = `–û–±—Ä–∞–±–æ—Ç–∫–∞: ${file.name}`;
            progressPercent.textContent = `${Math.round(((i) / selectedFiles.length) * 100)}%`;
            progressBar.style.width = `${((i) / selectedFiles.length) * 100}%`;
            progressStatus.textContent = `–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞ ${i + 1} –∏–∑ ${selectedFiles.length}`;
            
            try {
                const result = await uploadAndParseFile(file);
                results.push(result);
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ñ–∞–π–ª–∞:', error);
                showNotification(`–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ ${file.name}: ${error.message}`, 'error');
            }
        }
        
        // –§–∏–Ω–∞–ª—å–Ω—ã–π –ø—Ä–æ–≥—Ä–µ—Å—Å
        progressPercent.textContent = '100%';
        progressBar.style.width = '100%';
        progressStatus.textContent = '–û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞';
        progressFileName.textContent = '–í—Å–µ —Ñ–∞–π–ª—ã –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã';
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
        setTimeout(() => {
            displayParseResults(results);
            progressDiv.style.display = 'none';
            selectedFiles = [];
            updateParsedFilesCount();
        }, 1000);
    }

    async function uploadAndParseFile(file) {
        const formData = new FormData();
        formData.append('file', file);
        
        try {
            const response = await fetch(`${API_BASE_URL}/parse-file`, {
                method: 'POST',
                body: formData
            });
            
            if (!response.ok) {
                throw new Error(`HTTP ${response.status}`);
            }
            
            const result = await response.json();
            
            if (result.success) {
                showNotification(`–§–∞–π–ª "${file.name}" —É—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω`, 'success');
                return result;
            } else {
                throw new Error(result.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞');
            }
            
        } catch (error) {
            console.error('Upload error:', error);
            throw error;
        }
    }

    function displayParseResults(results) {
        const resultsContainer = document.getElementById('resultsContainer');
        const parseResults = document.getElementById('parseResults');
        
        if (!resultsContainer || !parseResults) return;
        
        if (results.length === 0) {
            resultsContainer.innerHTML = `
                <div style="text-align: center; padding: 40px; color: #666;">
                    <i class="fas fa-exclamation-circle" style="font-size: 48px; margin-bottom: 15px; color: #e9ecef;"></i>
                    <div>–ù–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –æ–±—Ä–∞–±–æ—Ç–∫–∏</div>
                </div>
            `;
            parseResults.style.display = 'block';
            return;
        }
        
        let html = '';
        
        results.forEach((result, index) => {
            const data = result.result?.data || {};
            
            html += `
                <div style="background: white; border: 1px solid #e9ecef; border-radius: var(--border-radius); padding: 20px; margin-bottom: 20px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <div>
                            <div style="font-weight: 600; font-size: 16px; color: var(--dark-text);">
                                <i class="fas ${getFileIconFromName(result.filename)}"></i>
                                ${result.filename}
                            </div>
                            <div style="font-size: 13px; color: #666;">
                                –¢–∏–ø: ${result.fileType} ‚Ä¢ –†–∞–∑–º–µ—Ä: ${(result.fileSize / 1024 / 1024).toFixed(2)} MB
                            </div>
                        </div>
                        <span style="background: var(--success-color); color: white; padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: 600;">
                            –£—Å–ø–µ—à–Ω–æ
                        </span>
                    </div>
                    
                    ${displayResultData(data, result.fileType)}
                    
                    <div style="margin-top: 15px; display: flex; gap: 10px;">
                        <button class="btn-small" style="background: var(--primary-color); color: white;" 
                                onclick="downloadParsedResult('${result.savedAs}')">
                            <i class="fas fa-download"></i> –°–∫–∞—á–∞—Ç—å JSON
                        </button>
                        <button class="btn-small" style="background: var(--success-color); color: white;" 
                                onclick="exportResultToExcel(${index})">
                            <i class="fas fa-file-excel"></i> –≠–∫—Å–ø–æ—Ä—Ç –≤ Excel
                        </button>
                    </div>
                </div>
            `;
        });
        
        resultsContainer.innerHTML = html;
        parseResults.style.display = 'block';
    }

    function displayResultData(data, fileType) {
        if (fileType.includes('excel') || fileType.includes('spreadsheet') || fileType.includes('csv')) {
            // Excel –¥–∞–Ω–Ω—ã–µ
            return `
                <div>
                    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 15px;">
                        <div style="background: var(--light-bg); padding: 10px; border-radius: var(--border-radius); text-align: center;">
                            <div style="font-size: 12px; color: #666;">–õ–∏—Å—Ç–æ–≤</div>
                            <div style="font-size: 18px; font-weight: bold;">${data.summary?.totalSheets || 0}</div>
                        </div>
                        <div style="background: var(--light-bg); padding: 10px; border-radius: var(--border-radius); text-align: center;">
                            <div style="font-size: 12px; color: #666;">–Ø—á–µ–µ–∫</div>
                            <div style="font-size: 18px; font-weight: bold;">${data.summary?.totalCells || 0}</div>
                        </div>
                        <div style="background: var(--light-bg); padding: 10px; border-radius: var(--border-radius); text-align: center;">
                            <div style="font-size: 12px; color: #666;">–°—Ç—Ä–æ–∫</div>
                            <div style="font-size: 18px; font-weight: bold;">${data.sheets?.[0]?.stats?.totalRows || 0}</div>
                        </div>
                        <div style="background: var(--light-bg); padding: 10px; border-radius: var(--border-radius); text-align: center;">
                            <div style="font-size: 12px; color: #666;">–°—Ç–æ–ª–±—Ü–æ–≤</div>
                            <div style="font-size: 18px; font-weight: bold;">${data.sheets?.[0]?.stats?.totalColumns || 0}</div>
                        </div>
                    </div>
                    
                    ${data.sheets && data.sheets.length > 0 ? `
                        <div style="margin-top: 15px;">
                            <h5 style="margin-bottom: 10px; color: var(--dark-text);">–ü–µ—Ä–≤—ã–π –ª–∏—Å—Ç:</h5>
                            <div style="max-height: 200px; overflow-y: auto; border: 1px solid #e9ecef; border-radius: var(--border-radius);">
                                <table style="width: 100%; border-collapse: collapse;">
                                    <thead>
                                        <tr>
                                            ${data.sheets[0].headers.map(header => 
                                                `<th style="padding: 8px; border-bottom: 1px solid #e9ecef; background: #f8f9fa; text-align: left;">${header}</th>`
                                            ).join('')}
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${data.sheets[0].rows.slice(0, 5).map(row => `
                                            <tr>
                                                ${row.map(cell => 
                                                    `<td style="padding: 8px; border-bottom: 1px solid #e9ecef;">${cell || ''}</td>`
                                                ).join('')}
                                            </tr>
                                        `).join('')}
                                        ${data.sheets[0].rows.length > 5 ? `
                                            <tr>
                                                <td colspan="${data.sheets[0].headers.length}" style="padding: 8px; text-align: center; color: #666; font-style: italic;">
                                                    ... –∏ –µ—â–µ ${data.sheets[0].rows.length - 5} —Å—Ç—Ä–æ–∫
                                                </td>
                                            </tr>
                                        ` : ''}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    ` : ''}
                </div>
            `;
        } else if (fileType.includes('pdf')) {
            // PDF –¥–∞–Ω–Ω—ã–µ
            return `
                <div>
                    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 15px;">
                        <div style="background: var(--light-bg); padding: 10px; border-radius: var(--border-radius); text-align: center;">
                            <div style="font-size: 12px; color: #666;">–°—Ç—Ä–∞–Ω–∏—Ü</div>
                            <div style="font-size: 18px; font-weight: bold;">${data.stats?.totalPages || 0}</div>
                        </div>
                        <div style="background: var(--light-bg); padding: 10px; border-radius: var(--border-radius); text-align: center;">
                            <div style="font-size: 12px; color: #666;">–°–ª–æ–≤</div>
                            <div style="font-size: 18px; font-weight: bold;">${data.stats?.totalWords || 0}</div>
                        </div>
                        <div style="background: var(--light-bg); padding: 10px; border-radius: var(--border-radius); text-align: center;">
                            <div style="font-size: 12px; color: #666;">Email</div>
                            <div style="font-size: 18px; font-weight: bold;">${data.extractedData?.emails?.length || 0}</div>
                        </div>
                        <div style="background: var(--light-bg); padding: 10px; border-radius: var(--border-radius); text-align: center;">
                            <div style="font-size: 12px; color: #666;">–¢–µ–ª–µ—Ñ–æ–Ω—ã</div>
                            <div style="font-size: 18px; font-weight: bold;">${data.extractedData?.phones?.length || 0}</div>
                        </div>
                    </div>
                    
                    ${data.extractedData?.emails?.length > 0 ? `
                        <div style="margin-top: 15px;">
                            <h5 style="margin-bottom: 10px; color: var(--dark-text);">–ò–∑–≤–ª–µ—á–µ–Ω–Ω—ã–µ emails:</h5>
                            <div style="display: flex; flex-wrap: wrap; gap: 5px;">
                                ${data.extractedData.emails.slice(0, 10).map(email => 
                                    `<span style="background: #e3f2fd; color: #1976d2; padding: 3px 8px; border-radius: 12px; font-size: 12px;">${email}</span>`
                                ).join('')}
                                ${data.extractedData.emails.length > 10 ? 
                                    `<span style="color: #666; font-size: 12px;">... –∏ –µ—â–µ ${data.extractedData.emails.length - 10}</span>` : ''
                                }
                            </div>
                        </div>
                    ` : ''}
                    
                    ${data.extractedData?.phones?.length > 0 ? `
                        <div style="margin-top: 15px;">
                            <h5 style="margin-bottom: 10px; color: var(--dark-text);">–ò–∑–≤–ª–µ—á–µ–Ω–Ω—ã–µ —Ç–µ–ª–µ—Ñ–æ–Ω—ã:</h5>
                            <div style="display: flex; flex-wrap: wrap; gap: 5px;">
                                ${data.extractedData.phones.slice(0, 10).map(phone => 
                                    `<span style="background: #e8f5e9; color: #2e7d32; padding: 3px 8px; border-radius: 12px; font-size: 12px;">${phone}</span>`
                                ).join('')}
                                ${data.extractedData.phones.length > 10 ? 
                                    `<span style="color: #666; font-size: 12px;">... –∏ –µ—â–µ ${data.extractedData.phones.length - 10}</span>` : ''
                                }
                            </div>
                        </div>
                    ` : ''}
                    
                    ${data.text && data.text.length > 0 ? `
                        <div style="margin-top: 15px;">
                            <h5 style="margin-bottom: 10px; color: var(--dark-text);">–¢–µ–∫—Å—Ç (–ø–µ—Ä–≤—ã–µ 500 —Å–∏–º–≤–æ–ª–æ–≤):</h5>
                            <div style="max-height: 150px; overflow-y: auto; padding: 10px; background: #f8f9fa; border-radius: var(--border-radius); font-size: 12px; line-height: 1.5;">
                                ${data.text.substring(0, 500)}${data.text.length > 500 ? '...' : ''}
                            </div>
                        </div>
                    ` : ''}
                </div>
            `;
        }
        
        return '<div style="color: #666; font-style: italic;">–î–∞–Ω–Ω—ã–µ –Ω–µ –¥–æ—Å—Ç—É–ø–Ω—ã</div>';
    }

    function getFileIconFromName(filename) {
        if (filename.match(/\.pdf$/i)) return 'fa-file-pdf';
        if (filename.match(/\.(xlsx|xls)$/i)) return 'fa-file-excel';
        if (filename.match(/\.csv$/i)) return 'fa-file-csv';
        return 'fa-file';
    }

    async function downloadParsedResult(filename) {
        try {
            const response = await fetch(`${API_BASE_URL}/download-parsed/${filename}`);
            if (response.ok) {
                const blob = await response.blob();
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                window.URL.revokeObjectURL(url);
                showNotification('–§–∞–π–ª —Å–∫–∞—á–∞–Ω', 'success');
            } else {
                throw new Error('–û—à–∏–±–∫–∞ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è');
            }
        } catch (error) {
            showNotification('–û—à–∏–±–∫–∞ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è —Ñ–∞–π–ª–∞', 'error');
        }
    }

    async function exportResultToExcel(resultIndex) {
        // –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —ç–∫—Å–ø–æ—Ä—Ç–∞ –≤ Excel
        showNotification('–≠–∫—Å–ø–æ—Ä—Ç –≤ Excel - —Ñ—É–Ω–∫—Ü–∏—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ', 'info');
    }

    async function loadParsedFiles() {
        try {
            const response = await fetch(`${API_BASE_URL}/parsed-files`);
            const data = await response.json();
            
            if (data.success) {
                displayParsedFilesHistory(data.files);
            }
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏—Å—Ç–æ—Ä–∏–∏:', error);
            showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏—Å—Ç–æ—Ä–∏–∏ —Ñ–∞–π–ª–æ–≤', 'error');
        }
    }

    function displayParsedFilesHistory(files) {
        const historyList = document.getElementById('historyList');
        const historyDiv = document.getElementById('parsedFilesHistory');
        const parseResults = document.getElementById('parseResults');
        
        if (!historyList || !historyDiv) return;
        
        if (files.length === 0) {
            historyList.innerHTML = `
                <div style="text-align: center; padding: 40px; color: #666;">
                    <i class="fas fa-history" style="font-size: 48px; margin-bottom: 15px; color: #e9ecef;"></i>
                    <div>–ù–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤</div>
                </div>
            `;
        } else {
            let html = '';
            
            files.forEach((file, index) => {
                const fileSize = (file.size / 1024).toFixed(2);
                const date = new Date(file.createdAt).toLocaleDateString('ru-RU');
                
                html += `
                    <div style="background: white; border: 1px solid #e9ecef; border-radius: var(--border-radius); padding: 15px; margin-bottom: 10px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <div>
                                <div style="font-weight: 600; color: var(--dark-text);">
                                    <i class="fas ${getFileIconFromName(file.filename)}"></i>
                                    ${file.filename}
                                </div>
                                <div style="font-size: 12px; color: #666;">
                                    ${date} ‚Ä¢ ${fileSize} KB
                                </div>
                            </div>
                            <button class="btn-small" style="background: var(--primary-color); color: white;" 
                                    onclick="downloadParsedResult('${file.filename}')">
                                <i class="fas fa-download"></i>
                            </button>
                        </div>
                    </div>
                `;
            });
            
            historyList.innerHTML = html;
        }
        
        historyDiv.style.display = 'block';
        if (parseResults) parseResults.style.display = 'none';
        document.getElementById('selectedFiles').style.display = 'none';
        document.getElementById('uploadProgress').style.display = 'none';
    }

    function hideParsedFiles() {
        document.getElementById('parsedFilesHistory').style.display = 'none';
    }

    function updateParsedFilesCount() {
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
        const badge = document.getElementById('uploadedFiles');
        if (badge) {
            // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ä–µ–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–∑ API
            badge.textContent = selectedFiles.length;
        }
    }

    // 4. EMAIL –û–¢–ü–†–ê–í–ö–ê
    async function sendEmailReport(reportData) {
        showNotification('–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ –æ—Ç—á–µ—Ç–∞...', 'info');
        
        try {
            const response = await fetch(`${API_BASE_URL}/send-report`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    to: currentManager.reportTo,
                    bcc: currentManager.reportBcc,
                    subject: `–û—Ç—á–µ—Ç –í–ï–†–¢–£–ú CRM - ${new Date().toLocaleDateString('ru-RU')}`,
                    reportText: generateReportText(reportData),
                    reportHtml: generateReportHTML(reportData)
                })
            });
            
            const result = await response.json();
            
            if (result.success) {
                showNotification('‚úÖ –û—Ç—á–µ—Ç —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω!', 'success');
                return true;
            } else {
                throw new Error(result.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞');
            }
        } catch (error) {
            console.error('Email send error:', error);
            showNotification('‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ—Ç—á–µ—Ç–∞', 'error');
            
            // Fallback: –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º —Å–∫–∞—á–∞—Ç—å –æ—Ç—á–µ—Ç
            setTimeout(() => {
                if (confirm('–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å email. –•–æ—Ç–∏—Ç–µ —Å–∫–∞—á–∞—Ç—å –æ—Ç—á–µ—Ç –∫–∞–∫ —Ñ–∞–π–ª?')) {
                    downloadReportAsFile(reportData);
                }
            }, 1000);
            
            return false;
        }
    }

    function generateReportText(reportData) {
        return `
–û–¢–ß–ï–¢ –í–ï–†–¢–£–ú CRM
================
–î–∞—Ç–∞: ${new Date().toLocaleDateString('ru-RU')}
–ú–µ–Ω–µ–¥–∂–µ—Ä: ${currentManager.name}
Email: ${currentManager.email}

–°–¢–ê–¢–ò–°–¢–ò–ö–ê:
-----------
‚Ä¢ –í—Å–µ–≥–æ –∫–ª–∏–µ–Ω—Ç–æ–≤: ${reportData.totalClients}
‚Ä¢ –í–∏–∑–∏—Ç–æ–≤ —Å–µ–≥–æ–¥–Ω—è: ${reportData.visitsToday}
‚Ä¢ –í—Å–µ–≥–æ –≤–∏–∑–∏—Ç–æ–≤: ${reportData.totalVisits}
‚Ä¢ –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–ª–∞–Ω–∞: 24%
‚Ä¢ –ê–∫—Ç–∏–≤–Ω—ã—Ö –≤–∏–∑–∏—Ç–æ–≤: ${activeVisit ? 1 : 0}

–ö–õ–ò–ï–ù–¢–´ –ü–û –†–ï–ì–ò–û–ù–ê–ú:
-------------------
${getClientsByRegionText()}

–ü–û–°–õ–ï–î–ù–ò–ï –î–ï–ô–°–¢–í–ò–Ø:
------------------
${getRecentActivitiesText()}

–û–ë–†–ê–ë–û–¢–ê–ù–ù–´–ï –§–ê–ô–õ–´:
------------------
${getParsedFilesSummary()}

–°–ò–°–¢–ï–ú–ù–ê–Ø –ò–ù–§–û–†–ú–ê–¶–ò–Ø:
--------------------
‚Ä¢ –í–µ—Ä—Å–∏—è CRM: 2.0
‚Ä¢ –û–±–Ω–æ–≤–ª–µ–Ω–æ: ${new Date().toLocaleTimeString('ru-RU')}
‚Ä¢ –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ: ${navigator.userAgent.substring(0, 50)}...
        `;
    }

    function generateReportHTML(reportData) {
        return `
            <!DOCTYPE html>
            <html>
            <head>
                <style>
                    body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; max-width: 800px; margin: 0 auto; }
                    .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; border-radius: 10px; text-align: center; }
                    .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin: 30px 0; }
                    .stat-card { background: white; border: 1px solid #e9ecef; border-radius: 8px; padding: 20px; text-align: center; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
                    .stat-value { font-size: 28px; font-weight: bold; color: #667eea; margin: 10px 0; }
                    .section { margin: 30px 0; padding: 20px; background: #f8f9fa; border-radius: 8px; }
                    .footer { margin-top: 40px; padding-top: 20px; border-top: 2px solid #667eea; color: #666; font-size: 12px; }
                </style>
            </head>
            <body>
                <div class="header">
                    <h1>üìä –û—Ç—á–µ—Ç –í–ï–†–¢–£–ú CRM</h1>
                    <p>${new Date().toLocaleDateString('ru-RU')} ‚Ä¢ ${currentManager.name}</p>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div style="font-size: 14px; color: #666;">–í—Å–µ–≥–æ –∫–ª–∏–µ–Ω—Ç–æ–≤</div>
                        <div class="stat-value">${reportData.totalClients}</div>
                    </div>
                    <div class="stat-card">
                        <div style="font-size: 14px; color: #666;">–í–∏–∑–∏—Ç–æ–≤ —Å–µ–≥–æ–¥–Ω—è</div>
                        <div class="stat-value">${reportData.visitsToday}</div>
                    </div>
                    <div class="stat-card">
                        <div style="font-size: 14px; color: #666;">–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–ª–∞–Ω–∞</div>
                        <div class="stat-value">24%</div>
                    </div>
                    <div class="stat-card">
                        <div style="font-size: 14px; color: #666;">–û–±—Ä–∞–±–æ—Ç–∞–Ω–æ —Ñ–∞–π–ª–æ–≤</div>
                        <div class="stat-value">${getParsedFilesCount()}</div>
                    </div>
                </div>
                
                <div class="section">
                    <h2 style="color: #667eea;">üìà –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</h2>
                    <p>–û—Ç—á–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∏—Å—Ç–µ–º–æ–π –í–ï–†–¢–£–ú CRM.</p>
                    <p>–í—Å–µ –¥–∞–Ω–Ω—ã–µ –∞–∫—Ç—É–∞–ª—å–Ω—ã –Ω–∞ –º–æ–º–µ–Ω—Ç —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –æ—Ç—á–µ—Ç–∞.</p>
                </div>
                
                <div class="footer">
                    <p>¬© ${new Date().getFullYear()} –í–ï–†–¢–£–ú CRM. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</p>
                    <p>–≠—Ç–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ. –ù–µ –æ—Ç–≤–µ—á–∞–π—Ç–µ –Ω–∞ —ç—Ç–æ –ø–∏—Å—å–º–æ.</p>
                </div>
            </body>
            </html>
        `;
    }

    function getClientsByRegionText() {
        const regions = {};
        allClientsData.forEach(client => {
            const region = client.region || '–ù–µ —É–∫–∞–∑–∞–Ω';
            regions[region] = (regions[region] || 0) + 1;
        });
        
        return Object.entries(regions)
            .map(([region, count]) => `  ‚Ä¢ ${region}: ${count} –∫–ª–∏–µ–Ω—Ç–æ–≤`)
            .join('\n');
    }

    function getRecentActivitiesText() {
        const visits = getAllVisits()
            .filter(v => v.status === 'completed')
            .sort((a, b) => new Date(b.completedAt) - new Date(a.completedAt))
            .slice(0, 3);
        
        if (visits.length === 0) return '  ‚Ä¢ –ù–µ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö –≤–∏–∑–∏—Ç–æ–≤';
        
        return visits.map(v => 
            `  ‚Ä¢ ${v.date} ${v.startTime}: ${v.clientName} (${v.duration || '?'} –º–∏–Ω)`
        ).join('\n');
    }

    function getParsedFilesSummary() {
        // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É –ø–æ–ª—É—á–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ–± –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–∞—Ö
        return '  ‚Ä¢ –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–∞–π–ª–æ–≤ –≤–∫–ª—é—á–µ–Ω–∞ –≤ —Å–∏—Å—Ç–µ–º—É';
    }

    function getParsedFilesCount() {
        // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É –ø–æ–¥—Å—á–µ—Ç–∞ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
        return selectedFiles.length;
    }

    function downloadReportAsFile(reportData) {
        const content = generateReportText(reportData);
        const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
        const link = document.createElement('a');
        link.href = URL.createObjectURL(blob);
        link.download = `vertum_report_${new Date().toISOString().slice(0,10)}.txt`;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        
        showNotification('üìÑ –û—Ç—á–µ—Ç —Å–∫–∞—á–∞–Ω –∫–∞–∫ —Ñ–∞–π–ª', 'info');
    }

    // 5. –°–ò–°–¢–ï–ú–ù–´–ï –§–£–ù–ö–¶–ò–ò
    async function checkServerHealth() {
        try {
            const response = await fetch(`${API_BASE_URL}/health`);
            const data = await response.json();
            
            if (data.status === 'OK') {
                console.log('‚úÖ –°–µ—Ä–≤–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç:', data);
                showNotification('–°–µ—Ä–≤–µ—Ä –ø–æ–¥–∫–ª—é—á–µ–Ω', 'success');
                return true;
            }
        } catch (error) {
            console.warn('–°–µ—Ä–≤–µ—Ä –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω:', error);
            showNotification('‚ö†Ô∏è  –°–µ—Ä–≤–µ—Ä –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω. –†–∞–±–æ—Ç–∞ –≤ –æ—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º–µ.', 'warning');
            return false;
        }
    }

    async function syncData() {
        showNotification('–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö...', 'info');
        isRefreshing = true;
        
        try {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–¥–æ—Ä–æ–≤—å–µ —Å–µ—Ä–≤–µ—Ä–∞
            const isHealthy = await checkServerHealth();
            
            if (isHealthy) {
                // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —Ä–µ–∞–ª—å–Ω—É—é —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é
                showNotification('‚úÖ –î–∞–Ω–Ω—ã–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã —Å —Å–µ—Ä–≤–µ—Ä–æ–º', 'success');
            }
            
        } catch (error) {
            console.warn('–û—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º:', error);
            showNotification('üì¥ –û—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º. –î–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω—ã –ª–æ–∫–∞–ª—å–Ω–æ', 'info');
        } finally {
            // –í—Å–µ–≥–¥–∞ –æ–±–Ω–æ–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ —Å—á–µ—Ç—á–∏–∫–∏
            updateCounters();
            updateSystemInfo();
            initializeMiniCalendar();
            
            isRefreshing = false;
            hidePullToRefresh();
        }
    }

    function updateDateTime() {
        const now = new Date();
        const dateOptions = { day: '2-digit', month: '2-digit', year: 'numeric' };
        const timeOptions = { hour: '2-digit', minute: '2-digit' };
        
        document.getElementById('currentDate').textContent = now.toLocaleDateString('ru-RU', dateOptions);
        document.getElementById('currentTime').textContent = now.toLocaleTimeString('ru-RU', timeOptions);
        
        setTimeout(updateDateTime, 60000);
    }

    // 6. –ú–û–ë–ò–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò
    function setupTouchEvents() {
        let touchStartY = 0;
        let isDragging = false;
        
        document.addEventListener('touchstart', (e) => {
            if (window.scrollY === 0) {
                touchStartY = e.touches[0].clientY;
                isDragging = true;
            }
        }, { passive: true });
        
        document.addEventListener('touchmove', (e) => {
            if (!isDragging) return;
            
            const touchY = e.touches[0].clientY;
            const diff = touchY - touchStartY;
            
            if (diff > 50 && window.scrollY === 0 && !isRefreshing) {
                showPullToRefresh();
            }
        }, { passive: true });
        
        document.addEventListener('touchend', () => {
            if (isDragging && isRefreshing) {
                syncData();
            }
            isDragging = false;
        }, { passive: true });
    }

    function showPullToRefresh() {
        const refreshElement = document.getElementById('pullToRefresh');
        if (refreshElement) {
            refreshElement.classList.add('active');
            isRefreshing = true;
        }
    }

    function hidePullToRefresh() {
        const refreshElement = document.getElementById('pullToRefresh');
        if (refreshElement) {
            refreshElement.classList.remove('active');
        }
    }

    function initializeMobileFab() {
        const fab = document.getElementById('mobileFab');
        if (window.innerWidth <= 768) {
            fab.style.display = 'flex';
        } else {
            fab.style.display = 'none';
        }
        
        window.addEventListener('resize', () => {
            if (window.innerWidth <= 768) {
                fab.style.display = 'flex';
            } else {
                fab.style.display = 'none';
            }
        });
    }

    function openMobileMenu() {
        const modal = document.getElementById('visitModal');
        const modalContainer = document.getElementById('modalContainer');
        
        modalContainer.innerHTML = `
            <div class="modal-header">
                <div class="modal-title">
                    <i class="fas fa-bars"></i> –ë–´–°–¢–†–´–ï –î–ï–ô–°–¢–í–ò–Ø
                </div>
                <button class="modal-close" onclick="closeModal()">√ó</button>
            </div>
            
            <div style="padding: 20px;">
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px;">
                    <button onclick="startVisit(); closeModal();" 
                            style="padding: 15px; background: linear-gradient(135deg, var(--warning-color) 0%, #F57C00 100%); color: white; border: none; border-radius: var(--border-radius); display: flex; flex-direction: column; align-items: center; gap: 8px;">
                        <i class="fas fa-car" style="font-size: 24px;"></i>
                        <span>–í–∏–∑–∏—Ç</span>
                    </button>
                    
                    <button onclick="showRegistrationForm(); closeModal();" 
                            style="padding: 15px; background: linear-gradient(135deg, var(--success-color) 0%, #2E7D32 100%); color: white; border: none; border-radius: var(--border-radius); display: flex; flex-direction: column; align-items: center; gap: 8px;">
                        <i class="fas fa-user-plus" style="font-size: 24px;"></i>
                        <span>–ö–ª–∏–µ–Ω—Ç</span>
                    </button>
                    
                    <button onclick="callMostRecentClient(); closeModal();" 
                            style="padding: 15px; background: linear-gradient(135deg, var(--info-color) 0%, #0D47A1 100%); color: white; border: none; border-radius: var(--border-radius); display: flex; flex-direction: column; align-items: center; gap: 8px;">
                        <i class="fas fa-phone" style="font-size: 24px;"></i>
                        <span>–ü–æ–∑–≤–æ–Ω–∏—Ç—å</span>
                    </button>
                    
                    <button onclick="syncData(); closeModal();" 
                            style="padding: 15px; background: linear-gradient(135deg, #666 0%, #333 100%); color: white; border: none; border-radius: var(--border-radius); display: flex; flex-direction: column; align-items: center; gap: 8px;">
                        <i class="fas fa-sync-alt" style="font-size: 24px;"></i>
                        <span>–°–∏–Ω—Ö—Ä.</span>
                    </button>
                    
                    <button onclick="document.getElementById('fileInput').click(); closeModal();" 
                            style="padding: 15px; background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%); color: white; border: none; border-radius: var(--border-radius); display: flex; flex-direction: column; align-items: center; gap: 8px; grid-column: span 2;">
                        <i class="fas fa-upload" style="font-size: 24px;"></i>
                        <span>–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª</span>
                    </button>
                </div>
                
                <div style="margin-top: 20px; padding-top: 15px; border-top: 1px solid #e9ecef;">
                    <h4 style="margin-bottom: 10px; color: var(--dark-text);">–°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã:</h4>
                    <div style="background: var(--light-bg); padding: 12px; border-radius: var(--border-radius); font-size: 13px;">
                        <div><i class="fas fa-users"></i> –ö–ª–∏–µ–Ω—Ç–æ–≤: ${allClientsData.length}</div>
                        <div><i class="fas fa-calendar-check"></i> –í–∏–∑–∏—Ç–æ–≤ —Å–µ–≥–æ–¥–Ω—è: ${getVisitsToday().length}</div>
                        <div><i class="fas fa-file"></i> –§–∞–π–ª–æ–≤ –≤ –æ–±—Ä–∞–±–æ—Ç–∫–µ: ${selectedFiles.length}</div>
                    </div>
                </div>
            </div>
        `;
        
        modal.style.display = 'flex';
    }

    // 7. SERVICE WORKER –î–õ–Ø PWA
    function setupServiceWorker() {
        if ('serviceWorker' in navigator) {
            // –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ–º service worker
            const swContent = `
                self.addEventListener('install', (event) => {
                    console.log('üì¶ Service Worker installing...');
                    event.waitUntil(
                        caches.open('vertum-crm-v2').then(cache => {
                            return cache.addAll([
                                '/',
                                '/index.html'
                            ]);
                        })
                    );
                });

                self.addEventListener('fetch', (event) => {
                    if (event.request.mode === 'navigate') {
                        event.respondWith(
                            fetch(event.request).catch(() => {
                                return caches.match('/index.html');
                            })
                        );
                    }
                });
            `;
            
            const swBlob = new Blob([swContent], { type: 'application/javascript' });
            const swURL = URL.createObjectURL(swBlob);
            
            navigator.serviceWorker.register(swURL).then(() => {
                console.log('‚úÖ Service Worker –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω');
            });
        }
        
        // –°–æ–∑–¥–∞–µ–º –º–∞–Ω–∏—Ñ–µ—Å—Ç –¥–ª—è PWA
        createManifest();
    }

    function createManifest() {
        const manifest = {
            "name": "–í–ï–†–¢–£–ú CRM",
            "short_name": "–í–ï–†–¢–£–ú",
            "description": "–¢–æ—Ä–≥–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞–º–∏",
            "start_url": "/",
            "display": "standalone",
            "background_color": "#667eea",
            "theme_color": "#667eea",
            "icons": [
                {
                    "src": "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23667eea'%3E%3Cpath d='M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5'/%3E%3C/svg%3E",
                    "sizes": "192x192",
                    "type": "image/svg+xml"
                }
            ]
        };
        
        const manifestElement = document.createElement('link');
        manifestElement.rel = 'manifest';
        manifestElement.href = 'data:application/json;charset=utf-8,' + encodeURIComponent(JSON.stringify(manifest));
        document.head.appendChild(manifestElement);
    }

    // 8. –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò
    function showNotification(message, type = 'info') {
        const container = document.getElementById('notificationContainer');
        if (!container) return;
        
        const icons = {
            info: '‚ÑπÔ∏è',
            success: '‚úÖ',
            warning: '‚ö†Ô∏è',
            error: '‚ùå'
        };
        
        const notification = document.createElement('div');
        notification.className = `notification ${type}`;
        notification.innerHTML = `
            <div class="notification-icon">${icons[type] || '‚ÑπÔ∏è'}</div>
            <div class="notification-content">
                <div class="notification-title">–í–ï–†–¢–£–ú CRM</div>
                <div class="notification-message">${message}</div>
            </div>
            <button onclick="this.parentElement.remove()" style="background: none; border: none; cursor: pointer; color: #666; font-size: 20px;">√ó</button>
        `;
        
        container.appendChild(notification);
        
        setTimeout(() => notification.classList.add('show'), 10);
        
        setTimeout(() => {
            if (notification.parentNode) {
                notification.remove();
            }
        }, 5000);
    }

    function closeModal() {
        document.getElementById('visitModal').style.display = 'none';
    }

    // ... (–û–°–¢–ê–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò –ò–ó –ü–†–ï–î–´–î–£–©–ï–ì–û –ö–û–î–ê: loadClientsData, showSection, applyFilters, 
    // startVisit, showCalendar, exportToExcel, –∏ —Ç.–¥. - –æ–Ω–∏ –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)

    // 9. –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ü–†–ò –ó–ê–ì–†–£–ó–ö–ï
    window.onload = function() {
        initializeSystem();
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
        checkForUpdates();
    };

    function checkForUpdates() {
        const lastUpdateCheck = localStorage.getItem('last_update_check');
        const today = new Date().toDateString();
        
        if (lastUpdateCheck !== today) {
            localStorage.setItem('last_update_check', today);
            console.log('–ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π...');
        }
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –æ–Ω–ª–∞–π–Ω/–æ—Ñ–ª–∞–π–Ω —Å—Ç–∞—Ç—É—Å–∞
    window.addEventListener('online', () => {
        showNotification('üåê –ò–Ω—Ç–µ—Ä–Ω–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ', 'success');
        setTimeout(syncData, 2000);
    });

    window.addEventListener('offline', () => {
        showNotification('üì¥ –†–∞–±–æ—Ç–∞–µ–º –≤ –æ—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º–µ', 'warning');
    });

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å —Å–µ—Ç–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    if (!navigator.onLine) {
        showNotification('üì¥ –û—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º. –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–∑ –∫—ç—à–∞.', 'info');
    }

    </script>

    <!-- –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ô JS –î–õ–Ø –°–ï–†–í–ò–° –í–û–†–ö–ï–†–ê -->
    <script>
    // –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º Service Worker
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', function() {
            navigator.serviceWorker.register('/sw.js').then(function(registration) {
                console.log('ServiceWorker –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω —É—Å–ø–µ—à–Ω–æ:', registration.scope);
            }, function(err) {
                console.log('–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ ServiceWorker:', err);
            });
        });
    }
    </script>
</body>
</html>