<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–í–ï–†–¢–£–ú CRM - –¢–æ—Ä–≥–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://unpkg.com/xlsx/dist/xlsx.full.min.js"></script>
    
    <style>
    /* –û–°–ù–û–í–ù–´–ï –°–¢–ò–õ–ò */
    :root {
        --primary-color: #667eea;
        --secondary-color: #764ba2;
        --success-color: #4CAF50;
        --warning-color: #FF9800;
        --danger-color: #f44336;
        --info-color: #2196F3;
        --light-bg: #f8f9fa;
        --dark-text: #2d3748;
        --border-radius: 8px;
        --box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        --transition: all 0.3s ease;
    }
    
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }
    
    body {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        color: var(--dark-text);
        line-height: 1.6;
    }
    
    /* –®–ê–ü–ö–ê */
    .crm-header {
        background: white;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        position: sticky;
        top: 0;
        z-index: 1000;
        padding: 12px 0;
    }
    
    .header-container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 0 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .logo {
        display: flex;
        align-items: center;
        gap: 12px;
        font-size: 20px;
        font-weight: bold;
        color: var(--secondary-color);
    }
    
    .logo i {
        font-size: 24px;
        color: var(--primary-color);
    }
    
    /* –ú–ï–ù–ï–î–ñ–ï–† */
    .manager-selector {
        position: relative;
        min-width: 300px;
    }
    
    .current-manager {
        display: flex;
        align-items: center;
        justify-content: space-between;
        background: linear-gradient(135deg, var(--light-bg) 0%, #e9ecef 100%);
        padding: 10px 16px;
        border-radius: var(--border-radius);
        border: 2px solid var(--primary-color);
        cursor: pointer;
        transition: var(--transition);
    }
    
    .current-manager:hover {
        border-color: var(--secondary-color);
        transform: translateY(-1px);
        box-shadow: var(--box-shadow);
    }
    
    .manager-info {
        flex-grow: 1;
    }
    
    .manager-name {
        font-weight: 600;
        font-size: 14px;
        color: var(--dark-text);
        margin-bottom: 3px;
    }
    
    .manager-contacts {
        font-size: 12px;
        color: #666;
    }
    
    .manager-arrow {
        color: var(--primary-color);
        margin-left: 10px;
        transition: var(--transition);
    }
    
    .current-manager.active .manager-arrow {
        transform: rotate(180deg);
    }
    
    .managers-dropdown {
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        background: white;
        border: 2px solid var(--primary-color);
        border-radius: var(--border-radius);
        margin-top: 8px;
        box-shadow: 0 6px 15px rgba(0,0,0,0.1);
        z-index: 1001;
        overflow: hidden;
        display: none;
        animation: slideDown 0.3s ease;
    }
    
    @keyframes slideDown {
        from { opacity: 0; transform: translateY(-10px); }
        to { opacity: 1; transform: translateY(0); }
    }
    
    .manager-option {
        display: flex;
        align-items: center;
        padding: 12px 16px;
        border-bottom: 1px solid #e9ecef;
        cursor: pointer;
        transition: var(--transition);
    }
    
    .manager-option:hover {
        background: var(--light-bg);
    }
    
    .manager-option.active {
        background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
        border-left: 4px solid var(--success-color);
    }
    
    .manager-option i {
        color: var(--primary-color);
        margin-right: 12px;
        font-size: 16px;
    }
    
    /* –ö–ù–û–ü–ö–ò –í –®–ê–ü–ö–ï */
    .header-actions {
        display: flex;
        align-items: center;
        gap: 12px;
    }
    
    .header-btn {
        background: linear-gradient(135deg, var(--light-bg) 0%, #e9ecef 100%);
        border: 2px solid var(--primary-color);
        padding: 8px 16px;
        border-radius: var(--border-radius);
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 13px;
        font-weight: 600;
        color: var(--dark-text);
        transition: var(--transition);
    }
    
    .header-btn:hover {
        background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
        color: white;
        border-color: transparent;
    }
    
    .btn-visit-header {
        background: linear-gradient(135deg, var(--warning-color) 0%, #F57C00 100%);
        color: white !important;
        border: none;
        padding: 10px 20px;
        border-radius: var(--border-radius);
        cursor: pointer;
        font-weight: bold;
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 14px;
        transition: var(--transition);
        min-width: 160px;
        justify-content: center;
        box-shadow: 0 2px 5px rgba(255, 152, 0, 0.3);
    }
    
    .btn-visit-header:hover {
        background: linear-gradient(135deg, #F57C00 0%, #E65100 100%);
        transform: translateY(-2px);
        box-shadow: 0 4px 10px rgba(245, 124, 0, 0.4);
    }
    
    /* –ì–õ–ê–í–ù–û–ï –ú–ï–ù–Æ */
    .crm-main {
        max-width: 1400px;
        margin: 20px auto;
        padding: 0 20px;
        min-height: calc(100vh - 200px);
    }
    
    .menu-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin: 25px 0;
    }
    
    .menu-card {
        background: white;
        border-radius: 12px;
        padding: 25px;
        cursor: pointer;
        border: 2px solid var(--primary-color);
        transition: var(--transition);
        box-shadow: var(--box-shadow);
        position: relative;
        overflow: hidden;
    }
    
    .menu-card:hover {
        transform: translateY(-5px);
        border-color: var(--secondary-color);
        box-shadow: 0 8px 20px rgba(0,0,0,0.15);
    }
    
    .menu-card.active {
        background: linear-gradient(135deg, #f8fff8 0%, #e8f5e9 100%);
        border-color: var(--success-color);
    }
    
    .menu-icon {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 20px;
    }
    
    .menu-icon i {
        font-size: 32px;
        color: var(--primary-color);
    }
    
    .menu-badge {
        background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
        color: white;
        padding: 5px 15px;
        border-radius: 20px;
        font-size: 14px;
        font-weight: bold;
        box-shadow: 0 2px 5px rgba(102, 126, 234, 0.3);
    }
    
    .menu-title {
        font-size: 20px;
        font-weight: bold;
        color: var(--dark-text);
        margin-bottom: 8px;
    }
    
    .menu-subtitle {
        font-size: 13px;
        color: #666;
        margin-bottom: 20px;
        line-height: 1.4;
    }
    
    .menu-action {
        color: var(--primary-color);
        font-weight: bold;
        font-size: 14px;
        display: flex;
        align-items: center;
        gap: 5px;
        margin-top: 10px;
    }
    
    .menu-action::after {
        content: "‚Üí";
        font-size: 16px;
    }
    
    /* –°–¢–ê–¢–ò–°–¢–ò–ö–ê */
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin: 30px 0;
    }
    
    .stat-card {
        background: white;
        border-radius: 10px;
        padding: 20px;
        text-align: center;
        box-shadow: var(--box-shadow);
        border: 2px solid var(--primary-color);
        transition: var(--transition);
        position: relative;
        overflow: hidden;
    }
    
    .stat-card:hover {
        transform: translateY(-3px);
        border-color: var(--secondary-color);
    }
    
    .stat-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
    }
    
    .stat-card i {
        font-size: 28px;
        color: var(--primary-color);
        margin-bottom: 15px;
        display: block;
    }
    
    .stat-value {
        font-size: 24px;
        font-weight: bold;
        color: var(--dark-text);
        margin-bottom: 5px;
    }
    
    .stat-label {
        font-size: 12px;
        color: #666;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    
    /* –†–ê–ó–î–ï–õ –ö–õ–ò–ï–ù–¢–û–í */
    .section-container {
        background: white;
        border-radius: 12px;
        padding: 25px;
        margin: 25px 0;
        box-shadow: var(--box-shadow);
        border: 2px solid var(--primary-color);
        display: none;
    }
    
    .section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 25px;
        padding-bottom: 15px;
        border-bottom: 2px solid var(--primary-color);
    }
    
    .section-title {
        font-size: 20px;
        font-weight: bold;
        color: var(--dark-text);
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .section-title i {
        color: var(--primary-color);
        font-size: 24px;
    }
    
    .manager-badge {
        background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
        color: white;
        padding: 5px 12px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: bold;
        margin-left: 10px;
    }
    
    .section-actions {
        display: flex;
        gap: 10px;
        align-items: center;
        flex-wrap: wrap;
    }
    
    .counter-badge {
        background: var(--light-bg);
        padding: 7px 14px;
        border-radius: 20px;
        font-size: 12px;
        color: var(--dark-text);
        border: 1px solid var(--primary-color);
    }
    
    .action-btn {
        padding: 9px 18px;
        border: none;
        border-radius: var(--border-radius);
        cursor: pointer;
        font-size: 13px;
        display: flex;
        align-items: center;
        gap: 8px;
        font-weight: 600;
        transition: var(--transition);
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    
    .action-btn:hover {
        transform: translateY(-1px);
        box-shadow: 0 3px 8px rgba(0,0,0,0.15);
    }
    
    .btn-success {
        background: linear-gradient(135deg, var(--success-color) 0%, #2E7D32 100%);
        color: white;
    }
    
    .btn-primary {
        background: linear-gradient(135deg, var(--info-color) 0%, #0D47A1 100%);
        color: white;
    }
    
    .btn-info {
        background: linear-gradient(135deg, var(--info-color) 0%, #0D47A1 100%);
        color: white;
    }
    
    .btn-green {
        background: linear-gradient(135deg, var(--success-color) 0%, #2E7D32 100%);
        color: white;
    }
    
    .btn-warning {
        background: linear-gradient(135deg, var(--warning-color) 0%, #F57C00 100%);
        color: white;
    }
    
    /* –ü–û–ò–°–ö –ò –§–ò–õ–¨–¢–†–´ */
    .search-box {
        margin: 20px 0;
        position: relative;
    }
    
    .search-input {
        width: 100%;
        padding: 13px 15px 13px 45px;
        border: 2px solid var(--primary-color);
        border-radius: var(--border-radius);
        font-size: 14px;
        background: white;
        color: var(--dark-text);
        box-shadow: 0 1px 3px rgba(102, 126, 234, 0.1);
        transition: var(--transition);
    }
    
    .search-input:focus {
        outline: none;
        border-color: var(--secondary-color);
        box-shadow: 0 3px 10px rgba(118, 75, 162, 0.2);
    }
    
    .search-box::before {
        content: 'üîç';
        position: absolute;
        left: 15px;
        top: 50%;
        transform: translateY(-50%);
        font-size: 16px;
        color: var(--primary-color);
    }
    
    .filters-grid {  
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 15px;
        margin: 25px 0;
        padding: 20px;
        background: linear-gradient(135deg, var(--light-bg) 0%, #e9ecef 100%);
        border-radius: var(--border-radius);
        border: 2px solid var(--primary-color);
    }
    
    .filter-item {
        display: flex;
        flex-direction: column;
    }
    
    .filter-item label {
        font-size: 12px;
        color: var(--primary-color);
        margin-bottom: 6px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    
    .filter-select {
        padding: 11px 13px;
        border: 2px solid var(--primary-color);
        border-radius: var(--border-radius);
        background: white;
        font-size: 13px;
        cursor: pointer;
        color: var(--dark-text);
        font-weight: 500;
        transition: var(--transition);
    }
    
    .filter-select:hover {
        border-color: var(--secondary-color);
    }
    
    .filter-select:focus {
        outline: none;
        border-color: var(--secondary-color);
        box-shadow: 0 2px 5px rgba(118, 75, 162, 0.2);
    }
    
    /* –¢–ê–ë–õ–ò–¶–´ */
    .table-container {
        overflow-x: auto;
        margin: 25px 0;
        border: 2px solid var(--primary-color);
        border-radius: var(--border-radius);
        box-shadow: var(--box-shadow);
        max-height: 500px;
        position: relative;
    }
    
    .data-table {
        width: 100%;
        border-collapse: collapse;
        min-width: 1200px;
    }
    
    .data-table th {
        background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
        color: white;
        padding: 14px 12px;
        text-align: left;
        font-size: 13px;
        font-weight: 600;
        position: sticky;
        top: 0;
        z-index: 10;
    }
    
    .data-table td {
        padding: 12px 12px;
        border-bottom: 1px solid #f1f3f4;
        font-size: 13px;
        color: var(--dark-text);
        vertical-align: middle;
    }
    
    .data-table tr:nth-child(even) {
        background-color: #f8f9fa;
    }
    
    .data-table tr:hover {
        background: linear-gradient(135deg, #f3f0ff 0%, #e9ecef 100%);
        box-shadow: 0 1px 3px rgba(102, 126, 234, 0.1);
    }
    
    .checkbox-cell {
        text-align: center;
        width: 30px;
    }
    
    .action-cell {
        display: flex;
        gap: 5px;
        flex-wrap: wrap;
    }
    
    .btn-small {
        padding: 5px 10px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 11px;
        display: inline-flex;
        align-items: center;
        gap: 4px;
        font-weight: 600;
        transition: var(--transition);
    }
    
    .btn-small:hover {
        transform: translateY(-1px);
    }
    
    /* –ü–ê–ì–ò–ù–ê–¶–ò–Ø */
    .pagination {
        display: flex;
        justify-content: center;
        gap: 8px;
        margin: 25px 0;
        padding: 20px;
        background: var(--light-bg);
        border-radius: var(--border-radius);
        border: 2px solid var(--primary-color);
        flex-wrap: wrap;
    }
    
    .page-btn {
        padding: 7px 14px;
        border: 1px solid var(--primary-color);
        background: white;
        border-radius: var(--border-radius);
        cursor: pointer;
        color: var(--primary-color);
        font-weight: 600;
        transition: var(--transition);
        font-size: 13px;
        min-width: 40px;
        text-align: center;
    }
    
    .page-btn:hover {
        background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
        color: white;
        border-color: transparent;
        transform: translateY(-1px);
    }
    
    .page-btn.active {
        background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
        color: white;
        border-color: transparent;
    }
    
    /* –ö–ù–û–ü–ö–ò –î–ï–ô–°–¢–í–ò–ô */
    .action-btns {
        display: flex;
        gap: 15px;
        justify-content: center;
        margin-top: 25px;
        padding-top: 25px;
        border-top: 2px solid var(--primary-color);
        flex-wrap: wrap;
    }
    
    /* –ö–ê–õ–ï–ù–î–ê–†–¨ */
    .calendar-section {
        background: white;
        border-radius: 12px;
        padding: 25px;
        margin: 25px 0;
        box-shadow: var(--box-shadow);
        border: 2px solid var(--primary-color);
    }
    
    .calendar-grid {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 8px;
        margin: 20px 0;
    }
    
    .calendar-weekday {
        text-align: center;
        padding: 12px 0;
        font-weight: 600;
        color: var(--primary-color);
        background: var(--light-bg);
        border-radius: var(--border-radius);
    }
    
    .calendar-day {
        text-align: center;
        padding: 15px 0;
        border-radius: var(--border-radius);
        cursor: pointer;
        transition: var(--transition);
        font-weight: 600;
        background: white;
        border: 1px solid #e9ecef;
    }
    
    .calendar-day:hover {
        background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
        color: white;
        transform: scale(1.05);
        border-color: transparent;
    }
    
    .calendar-day.today {
        background: linear-gradient(135deg, var(--success-color) 0%, #2E7D32 100%);
        color: white;
        border-color: transparent;
        box-shadow: 0 2px 5px rgba(76, 175, 80, 0.3);
    }
    
    .calendar-day.event {
        background: linear-gradient(135deg, var(--warning-color) 0%, #F57C00 100%);
        color: white;
        border-color: transparent;
        box-shadow: 0 2px 5px rgba(255, 152, 0, 0.3);
    }
    
    /* –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø */
    .notification-container {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 9999;
        display: flex;
        flex-direction: column;
        gap: 10px;
    }
    
    .notification {
        background: white;
        padding: 15px 20px;
        border-radius: var(--border-radius);
        box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        display: flex;
        align-items: center;
        gap: 12px;
        min-width: 300px;
        max-width: 400px;
        transform: translateX(150%);
        transition: transform 0.3s ease;
        border-left: 5px solid var(--success-color);
    }
    
    .notification.show {
        transform: translateX(0);
    }
    
    .notification.error {
        border-left-color: var(--danger-color);
    }
    
    .notification.warning {
        border-left-color: var(--warning-color);
    }
    
    .notification.info {
        border-left-color: var(--info-color);
    }
    
    .notification-icon {
        font-size: 20px;
    }
    
    .notification-content {
        flex-grow: 1;
    }
    
    .notification-title {
        font-weight: 600;
        margin-bottom: 3px;
    }
    
    .notification-message {
        font-size: 13px;
        color: #666;
    }
    
    /* –ú–û–î–ê–õ–¨–ù–´–ï –û–ö–ù–ê */
    .modal-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0,0,0,0.7);
        z-index: 9999;
        align-items: center;
        justify-content: center;
        padding: 20px;
        animation: fadeIn 0.3s ease;
    }
    
    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }
    
    .modal {
        background: white;
        border-radius: 12px;
        padding: 30px;
        min-width: 500px;
        max-width: 800px;
        max-height: 90vh;
        overflow-y: auto;
        box-shadow: 0 15px 35px rgba(0,0,0,0.3);
        border: 2px solid var(--primary-color);
        animation: slideUp 0.3s ease;
    }
    
    @keyframes slideUp {
        from { opacity: 0; transform: translateY(30px); }
        to { opacity: 1; transform: translateY(0); }
    }
    
    .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 25px;
        padding-bottom: 15px;
        border-bottom: 2px solid var(--primary-color);
    }
    
    .modal-title {
        font-size: 20px;
        font-weight: bold;
        color: var(--dark-text);
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .modal-close {
        background: none;
        border: none;
        font-size: 28px;
        cursor: pointer;
        color: #666;
        transition: var(--transition);
        width: 36px;
        height: 36px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .modal-close:hover {
        background: var(--light-bg);
        color: var(--primary-color);
    }
    
    /* –ê–ö–¢–ò–í–ù–´–ô –í–ò–ó–ò–¢ */
    .active-visit-bar {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        background: linear-gradient(135deg, var(--success-color) 0%, #2E7D32 100%);
        color: white;
        padding: 12px 25px;
        display: none;
        z-index: 9998;
        box-shadow: 0 -4px 15px rgba(76, 175, 80, 0.3);
        animation: slideUpBar 0.3s ease;
    }
    
    @keyframes slideUpBar {
        from { transform: translateY(100%); }
        to { transform: translateY(0); }
    }
    
    .active-visit-info {
        display: flex;
        justify-content: space-between;
        align-items: center;
        max-width: 1400px;
        margin: 0 auto;
        font-size: 14px;
    }
    
    .active-visit-info strong {
        margin-right: 8px;
    }
    
    /* –§–£–¢–ï–† */
    .crm-footer {
        background: linear-gradient(135deg, #2d3748 0%, #1a202c 100%);
        color: white;
        padding: 30px 20px 20px;
        margin-top: 40px;
        border-top: 3px solid var(--primary-color);
    }
    
    .footer-container {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 30px;
        max-width: 1400px;
        margin: 0 auto;
    }
    
    .footer-column h3 {
        margin-bottom: 18px;
        font-size: 15px;
        color: var(--primary-color);
        font-weight: bold;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    
    .footer-links {
        list-style: none;
        padding: 0;
    }
    
    .footer-links li {
        margin-bottom: 10px;
    }
    
    .footer-links a {
        color: white;
        text-decoration: none;
        font-size: 13px;
        display: flex;
        align-items: center;
        gap: 10px;
        transition: var(--transition);
        padding: 5px 0;
    }
    
    .footer-links a:hover {
        color: var(--primary-color);
        transform: translateX(5px);
    }
    
    .footer-btn {
        background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
        color: white;
        border: none;
        padding: 10px 18px;
        border-radius: var(--border-radius);
        cursor: pointer;
        font-size: 13px;
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 12px;
        width: 100%;
        justify-content: center;
        transition: var(--transition);
    }
    
    .footer-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 10px rgba(102, 126, 234, 0.3);
    }
    
    .copyright {
        text-align: center;
        margin-top: 30px;
        padding-top: 20px;
        border-top: 1px solid rgba(255,255,255,0.1);
        font-size: 13px;
        color: #aaa;
    }
    
    /* –ê–ö–¢–ò–í–ù–´–ï –§–ò–õ–¨–¢–†–´ */
    .filters-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
    }
    
    .filter-controls {
        display: flex;
        gap: 12px;
        align-items: center;
    }
    
    .filter-reset-btn {
        background: var(--danger-color);
        color: white;
        border: none;
        padding: 7px 14px;
        border-radius: var(--border-radius);
        cursor: pointer;
        font-size: 12px;
        display: flex;
        align-items: center;
        gap: 6px;
        font-weight: 600;
        transition: var(--transition);
    }
    
    .filter-reset-btn:hover {
        background: #d32f2f;
        transform: translateY(-1px);
    }
    
    .active-filters {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        margin: 15px 0;
        padding: 15px;
        background: #f0f7f0;
        border-radius: var(--border-radius);
        border-left: 5px solid var(--success-color);
        min-height: 55px;
        align-items: center;
    }
    
    .filter-tag {
        background: linear-gradient(135deg, var(--success-color) 0%, #2E7D32 100%);
        color: white;
        padding: 5px 12px;
        border-radius: 20px;
        font-size: 12px;
        display: flex;
        align-items: center;
        gap: 6px;
        font-weight: 600;
    }
    
    .filter-tag-remove {
        cursor: pointer;
        font-size: 11px;
        opacity: 0.8;
    }
    
    .filter-tag-remove:hover {
        opacity: 1;
    }
    
    /* –†–ï–ì–ò–°–¢–†–ê–¶–ò–û–ù–ù–ê–Ø –§–û–†–ú–ê */
    .form-group {
        margin-bottom: 20px;
    }
    
    .form-label {
        display: block;
        margin-bottom: 6px;
        font-weight: 600;
        color: var(--dark-text);
        font-size: 13px;
    }
    
    .form-input {
        width: 100%;
        padding: 12px 15px;
        border: 2px solid #e9ecef;
        border-radius: var(--border-radius);
        font-size: 14px;
        transition: var(--transition);
    }
    
    .form-input:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }
    
    .form-textarea {
        width: 100%;
        padding: 12px 15px;
        border: 2px solid #e9ecef;
        border-radius: var(--border-radius);
        font-size: 14px;
        min-height: 120px;
        resize: vertical;
        transition: var(--transition);
    }
    
    .form-textarea:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }
    
    /* –û–¢–í–ï–¢–°–¢–í–ï–ù–ù–´–ô –î–ò–ó–ê–ô–ù */
    @media (max-width: 1200px) {
        .header-container {
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .manager-selector {
            min-width: 250px;
        }
    }
    
    @media (max-width: 768px) {
        .crm-main {
            padding: 0 15px;
        }
        
        .menu-grid {
            grid-template-columns: 1fr;
        }
        
        .stats-grid {
            grid-template-columns: repeat(2, 1fr);
        }
        
        .section-header {
            flex-direction: column;
            gap: 15px;
            align-items: flex-start;
        }
        
        .section-actions {
            width: 100%;
            justify-content: flex-start;
        }
        
        .filters-grid {
            grid-template-columns: 1fr;
        }
        
        .action-btns {
            flex-direction: column;
        }
        
        .modal {
            min-width: auto;
            width: 95%;
            padding: 20px;
        }
        
        .footer-container {
            grid-template-columns: 1fr;
        }
    }
    
    @media (max-width: 480px) {
        .stats-grid {
            grid-template-columns: 1fr;
        }
        
        .header-actions {
            flex-wrap: wrap;
        }
        
        .btn-visit-header {
            min-width: 140px;
            font-size: 13px;
        }
        
        .menu-card {
            padding: 20px;
        }
    }
    </style>
</head>
<body>
    <!-- –®–ê–ü–ö–ê -->
    <header class="crm-header">
        <div class="header-container">
            <div class="logo">
                <i class="fas fa-chart-line"></i>
                <span>–í–ï–†–¢–£–ú CRM</span>
            </div>

            <div class="manager-selector">
                <div class="current-manager" id="currentManager" onclick="toggleManagerDropdown()">
                    <div class="manager-info">
                        <div class="manager-name" id="currentManagerName">–•–∏—Å–º–∞—Ç—É–ª–ª–∏–Ω –†—É—Å—Ç–∞–º –®–∞—Ñ–∫–∞—Ç–æ–≤–∏—á</div>
                        <div class="manager-contacts" id="currentManagerContacts">
                            hrs@vertum.su ‚Ä¢ +7 (985) 710-21-27
                        </div>
                    </div>
                    <i class="fas fa-chevron-down manager-arrow"></i>
                </div>
                
                <div class="managers-dropdown" id="managersDropdown">
                    <div class="manager-option active" onclick="selectManager('–•–∏—Å–º–∞—Ç—É–ª–ª–∏–Ω')">
                        <i class="fas fa-user-tie"></i>
                        <div>
                            <div class="manager-name">–•–∏—Å–º–∞—Ç—É–ª–ª–∏–Ω –†—É—Å—Ç–∞–º –®–∞—Ñ–∫–∞—Ç–æ–≤–∏—á</div>
                            <div class="manager-contacts">hrs@vertum.su ‚Ä¢ +7 (985) 710-21-27</div>
                        </div>
                    </div>
                    <div class="manager-option" onclick="selectManager('–•–∏—Ç—Ä–æ–≤')">
                        <i class="fas fa-user-tie"></i>
                        <div>
                            <div class="manager-name">–•–∏—Ç—Ä–æ–≤ –ö–∏—Ä–∏–ª–ª –Æ—Ä—å–µ–≤–∏—á</div>
                            <div class="manager-contacts">hky@vertum.su ‚Ä¢ +7 (909) 624-99-00</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="header-actions">
                <button class="header-btn" onclick="syncData()">
                    <i class="fas fa-sync-alt"></i> –°–∏–Ω—Ö—Ä.
                </button>
                <button class="header-btn" onclick="sendReport()">
                    <i class="fas fa-paper-plane"></i> –û—Ç—á–µ—Ç
                </button>
                <button class="btn-visit-header" onclick="startVisit()" id="startVisitBtn">
                    <i class="fas fa-play-circle"></i> –ù–ê–ß–ê–¢–¨ –í–ò–ó–ò–¢
                </button>
            </div>
        </div>
    </header>

    <!-- –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø -->
    <div class="notification-container" id="notificationContainer"></div>

    <!-- –ê–ö–¢–ò–í–ù–´–ô –í–ò–ó–ò–¢ -->
    <div class="active-visit-bar" id="activeVisitBar">
        <div class="active-visit-info">
            <div>
                <strong>üöó –ê–ö–¢–ò–í–ù–´–ô –í–ò–ó–ò–¢:</strong> 
                <span id="activeVisitClient"></span> ‚Ä¢ 
                <span id="activeVisitTime"></span>
                <span id="activeVisitDuration" style="margin-left: 15px;"></span>
            </div>
            <button class="btn-visit-header" onclick="openActiveVisit()">
                <i class="fas fa-external-link-alt"></i> –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å
            </button>
        </div>
    </div>

    <!-- –û–°–ù–û–í–ù–û–ô –ö–û–ù–¢–ï–ô–ù–ï–† -->
    <main class="crm-main">
        <!-- –ì–õ–ê–í–ù–û–ï –ú–ï–ù–Æ -->
        <div class="menu-grid" id="mainMenu">
            <div class="menu-card active" onclick="showSection('clients')" data-section="clients">
                <div class="menu-icon">
                    <i class="fas fa-users"></i>
                    <span class="menu-badge" id="clientsCount">0</span>
                </div>
                <div class="menu-title">–í–°–ï –ö–õ–ò–ï–ù–¢–´</div>
                <div class="menu-subtitle">–¢–∞–±–ª–∏—Ü–∞ —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏, –ø–æ–∏—Å–∫–æ–º –∏ —ç–∫—Å–ø–æ—Ä—Ç–æ–º</div>
                <div class="menu-action">–°–º–æ—Ç—Ä–µ—Ç—å ‚Üí</div>
            </div>

            <div class="menu-card" onclick="showSection('excelData')" data-section="excelData">
                <div class="menu-icon">
                    <i class="fas fa-file-excel"></i>
                    <span class="menu-badge" id="excelSheetsCount">4</span>
                </div>
                <div class="menu-title">–î–ê–ù–ù–´–ï EXCEL</div>
                <div class="menu-subtitle">–ò–º–ø–æ—Ä—Ç/—ç–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö Excel</div>
                <div class="menu-action">–û—Ç–∫—Ä—ã—Ç—å ‚Üí</div>
            </div>

            <div class="menu-card" onclick="showCalendar()">
                <div class="menu-icon">
                    <i class="fas fa-calendar-alt"></i>
                    <span class="menu-badge" id="calendarEvents">3</span>
                </div>
                <div class="menu-title">–ö–ê–õ–ï–ù–î–ê–†–¨</div>
                <div class="menu-subtitle">–í—Å—Ç—Ä–µ—á–∏, –≤–∏–∑–∏—Ç—ã, –¥–Ω–∏ —Ä–æ–∂–¥–µ–Ω–∏—è</div>
                <div class="menu-action">–ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å ‚Üí</div>
            </div>

            <div class="menu-card" onclick="showVisitsHistory()">
                <div class="menu-icon">
                    <i class="fas fa-history"></i>
                    <span class="menu-badge" id="visitsHistoryCount">0</span>
                </div>
                <div class="menu-title">–ò–°–¢–û–†–ò–Ø –í–ò–ó–ò–¢–û–í</div>
                <div class="menu-subtitle">–ê—Ä—Ö–∏–≤ –≤—Å–µ—Ö –≤—Å—Ç—Ä–µ—á –∏ –≤–∏–∑–∏—Ç–æ–≤</div>
                <div class="menu-action">–ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å ‚Üí</div>
            </div>

            <div class="menu-card" onclick="showRegistrationForm()">
                <div class="menu-icon">
                    <i class="fas fa-user-plus"></i>
                    <span class="menu-badge">+</span>
                </div>
                <div class="menu-title">–†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø</div>
                <div class="menu-subtitle">–ù–æ–≤—ã–π –∫–ª–∏–µ–Ω—Ç –≤ —Å–∏—Å—Ç–µ–º–µ</div>
                <div class="menu-action">–ó–∞–ø–æ–ª–Ω–∏—Ç—å ‚Üí</div>
            </div>

            <div class="menu-card" onclick="startVisit()">
                <div class="menu-icon">
                    <i class="fas fa-play-circle"></i>
                    <span class="menu-badge" id="visitsToday">0</span>
                </div>
                <div class="menu-title">–ù–ê–ß–ê–¢–¨ –í–ò–ó–ò–¢</div>
                <div class="menu-subtitle">–ê–∫—Ç–∏–≤–Ω—ã–µ –ø–æ—Å–µ—â–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–æ–≤</div>
                <div class="menu-action">–°–¢–ê–†–¢ ‚Üí</div>
            </div>
        </div>

        <!-- –ú–ò–ù–ò-–ö–ê–õ–ï–ù–î–ê–†–¨ -->
        <div class="calendar-section" id="miniCalendar">
            <div class="section-header">
                <div class="section-title">
                    <i class="fas fa-calendar-day"></i>
                    –ë–õ–ò–ñ–ê–ô–®–ò–ï –í–°–¢–†–ï–ß–ò
                </div>
                <button class="action-btn btn-info" onclick="showCalendar()">
                    <i class="fas fa-expand"></i> –í–µ—Å—å –∫–∞–ª–µ–Ω–¥–∞—Ä—å
                </button>
            </div>
            
            <div class="calendar-grid">
                <div class="calendar-weekday">–ü–Ω</div>
                <div class="calendar-weekday">–í—Ç</div>
                <div class="calendar-weekday">–°—Ä</div>
                <div class="calendar-weekday">–ß—Ç</div>
                <div class="calendar-weekday">–ü—Ç</div>
                <div class="calendar-weekday">–°–±</div>
                <div class="calendar-weekday">–í—Å</div>
                
                <!-- –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
            
            <div style="margin-top: 20px;" id="calendarEventsList">
                <div style="padding: 12px; background: #f8f9fa; border-radius: var(--border-radius); margin-bottom: 8px;">
                    <div style="font-weight: 600; color: var(--dark-text);">–ó–∞–≤—Ç—Ä–∞, 10:00</div>
                    <div style="font-size: 13px; color: #666;">–í—Å—Ç—Ä–µ—á–∞ —Å –ó–≤–æ–Ω–∞—Ä–µ–≤—ã–º –í.–ê.</div>
                    <div style="font-size: 12px; color: #888;">–°–µ—Ä–ø—É—Ö–æ–≤, –ö–∞–ª–∏–Ω–æ–≤—Å–∫–∏–π —Ä—ã–Ω–æ–∫</div>
                </div>
            </div>
        </div>

        <!-- –°–¢–ê–¢–ò–°–¢–ò–ö–ê -->
        <div class="stats-grid">
            <div class="stat-card">
                <i class="fas fa-users"></i>
                <div class="stat-value" id="statTotalClients">0</div>
                <div class="stat-label">–í—Å–µ–≥–æ –∫–ª–∏–µ–Ω—Ç–æ–≤</div>
            </div>

            <div class="stat-card">
                <i class="fas fa-ruble-sign"></i>
                <div class="stat-value">158.4M ‚ÇΩ</div>
                <div class="stat-label">–ü—Ä–æ–¥–∞–∂–∏ 2025</div>
            </div>

            <div class="stat-card">
                <i class="fas fa-bullseye"></i>
                <div class="stat-value">210M ‚ÇΩ</div>
                <div class="stat-label">–ü–ª–∞–Ω 2026</div>
            </div>

            <div class="stat-card">
                <i class="fas fa-calendar-check"></i>
                <div class="stat-value" id="statVisitsCount">0</div>
                <div class="stat-label">–í–∏–∑–∏—Ç–æ–≤ –≤ 2026</div>
            </div>

            <div class="stat-card">
                <i class="fas fa-percentage"></i>
                <div class="stat-value">24%</div>
                <div class="stat-label">–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–ª–∞–Ω–∞</div>
            </div>

            <div class="stat-card">
                <i class="fas fa-boxes"></i>
                <div class="stat-value">7</div>
                <div class="stat-label">–¢–æ–≤–∞—Ä–Ω—ã—Ö –≥—Ä—É–ø–ø</div>
            </div>
        </div>

        <!-- –†–ê–ó–î–ï–õ "–í–°–ï –ö–õ–ò–ï–ù–¢–´" -->
        <div id="clientsSection" class="section-container">
            <div class="section-header">
                <div class="section-title">
                    <i class="fas fa-users"></i>
                    –í–°–ï –ö–õ–ò–ï–ù–¢–´
                    <span class="manager-badge" id="currentManagerBadge">–•–∏—Å–º–∞—Ç—É–ª–ª–∏–Ω –†.–®.</span>
                </div>
                <div class="section-actions">
                    <span class="counter-badge" id="filteredCount">
                        –ü–æ–∫–∞–∑–∞–Ω–æ: <strong>0</strong> –∏–∑ <strong>0</strong>
                    </span>
                    <button class="action-btn btn-success" onclick="exportCSV()">
                        <i class="fas fa-file-csv"></i> CSV
                    </button>
                    <button class="action-btn btn-primary" onclick="exportToExcel()">
                        <i class="fas fa-file-excel"></i> Excel
                    </button>
                    <button class="action-btn btn-info" onclick="generateReport()">
                        <i class="fas fa-chart-bar"></i> –û—Ç—á–µ—Ç
                    </button>
                    <button class="action-btn btn-green" onclick="showRegistrationForm()">
                        <i class="fas fa-plus"></i> –ù–æ–≤—ã–π –∫–ª–∏–µ–Ω—Ç
                    </button>
                    <button class="btn-visit-header" style="padding: 8px 15px; font-size: 13px;" onclick="startVisitFromTable()">
                        <i class="fas fa-play-circle"></i> –ù–∞—á–∞—Ç—å –≤–∏–∑–∏—Ç
                    </button>
                </div>
            </div>

            <!-- –ü–ê–ù–ï–õ–¨ –£–ü–†–ê–í–õ–ï–ù–ò–Ø –§–ò–õ–¨–¢–†–ê–ú–ò -->
            <div class="filters-header">
                <h4><i class="fas fa-filter"></i> –§–ò–õ–¨–¢–†–´ –ö–õ–ò–ï–ù–¢–û–í</h4>
                <div class="filter-controls">
                    <button class="filter-reset-btn" onclick="resetAllFilters()">
                        <i class="fas fa-times"></i> –°–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ
                    </button>
                    <span class="counter-badge" id="activeFiltersCount">–ê–∫—Ç–∏–≤–Ω—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤: 0</span>
                </div>
            </div>

            <!-- –ê–ö–¢–ò–í–ù–´–ï –§–ò–õ–¨–¢–†–´ -->
            <div class="active-filters" id="activeFiltersContainer" style="display: none;">
                <!-- –ê–∫—Ç–∏–≤–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∑–¥–µ—Å—å -->
            </div>

            <!-- –ü–û–ò–°–ö -->
            <div class="search-box">
                <input type="text" class="search-input" id="searchInput" 
                       placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ –∫–æ–¥—É, –Ω–∞–∑–≤–∞–Ω–∏—é, –∞–¥—Ä–µ—Å—É, —Ç–µ–ª–µ—Ñ–æ–Ω—É..." 
                       oninput="filterTable()">
            </div>

            <!-- –§–ò–õ–¨–¢–†–´ (9 —à—Ç—É–∫) -->
            <div class="filters-grid" id="filtersGrid">
                <!-- –§–∏–ª—å—Ç—Ä—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>

            <!-- –¢–ê–ë–õ–ò–¶–ê –ö–õ–ò–ï–ù–¢–û–í -->
            <div class="table-container">
                <table class="data-table" id="clientsTable">
                    <thead id="clientsTableHead">
                        <!-- –ó–∞–≥–æ–ª–æ–≤–∫–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                    </thead>
                    <tbody id="clientsTableBody">
                        <!-- –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                    </tbody>
                </table>
            </div>

            <!-- –ü–ê–ì–ò–ù–ê–¶–ò–Ø -->
            <div class="pagination" id="pagination">
                <!-- –°—Ç—Ä–∞–Ω–∏—Ü—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>

            <!-- –î–ï–ô–°–¢–í–ò–Ø -->
            <div class="action-btns">
                <button class="action-btn" style="background: #666; color: white;" onclick="showSection('main')">
                    <i class="fas fa-arrow-left"></i> –ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é
                </button>
                <button class="action-btn btn-primary" onclick="showRegistrationForm()">
                    <i class="fas fa-user-plus"></i> –ù–æ–≤—ã–π –∫–ª–∏–µ–Ω—Ç
                </button>
                <button class="action-btn btn-info" onclick="generateReport()">
                    <i class="fas fa-chart-bar"></i> –°–æ–∑–¥–∞—Ç—å –æ—Ç—á–µ—Ç
                </button>
                <button class="btn-visit-header" style="padding: 8px 15px; font-size: 13px;" onclick="startVisitFromTable()">
                    <i class="fas fa-play-circle"></i> –ù–∞—á–∞—Ç—å –≤–∏–∑–∏—Ç
                </button>
            </div>
        </div>

        <!-- –†–ê–ó–î–ï–õ "–î–ê–ù–ù–´–ï EXCEL" -->
        <div id="excelDataSection" class="section-container">
            <div class="section-header">
                <div class="section-title">
                    <i class="fas fa-file-excel"></i>
                    –î–ê–ù–ù–´–ï –ò–ó EXCEL –§–ê–ô–õ–ê
                    <span class="manager-badge">–•–∏—Å–º–∞—Ç—É–ª–ª–∏–Ω –ö–ë —Å—Ä–º.xlsx</span>
                </div>
                <div class="section-actions">
                    <span class="counter-badge" id="excelCount">
                        –ó–∞–≥—Ä—É–∂–µ–Ω–æ: <strong>0</strong> –∑–∞–ø–∏—Å–µ–π
                    </span>
                    <button class="action-btn btn-success" onclick="exportExcelToCSV()">
                        <i class="fas fa-download"></i> –≠–∫—Å–ø–æ—Ä—Ç CSV
                    </button>
                    <button class="action-btn" style="background: #666; color: white;" onclick="refreshExcelData()">
                        <i class="fas fa-sync-alt"></i> –û–±–Ω–æ–≤–∏—Ç—å
                    </button>
                    <button class="action-btn btn-info" onclick="generateExcelReport()">
                        <i class="fas fa-chart-bar"></i> –û—Ç—á–µ—Ç –ø–æ Excel
                    </button>
                </div>
            </div>

            <div class="excel-controls" style="margin: 20px 0;">
                <select id="excelSheetSelect" class="filter-select" onchange="loadExcelSheet()" style="margin-right: 10px;">
                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ª–∏—Å—Ç Excel...</option>
                </select>
                
                <input type="text" class="search-input" id="excelSearchInput" 
                       placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ –≤—Å–µ–º –ª–∏—Å—Ç–∞–º..." 
                       style="flex-grow: 1;"
                       oninput="searchExcelData()">
                
                <button class="action-btn btn-warning" onclick="importExcelFile()" style="margin-left: 10px;">
                    <i class="fas fa-upload"></i> –ò–º–ø–æ—Ä—Ç Excel
                </button>
            </div>

            <div class="table-container">
                <table class="data-table" id="excelDataTable">
                    <thead id="excelTableHead">
                        <!-- –ó–∞–≥–æ–ª–æ–≤–∫–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                    </thead>
                    <tbody id="excelTableBody">
                        <!-- –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                    </tbody>
                </table>
            </div>

            <div class="excel-stats" id="excelStats" style="display: flex; gap: 15px; margin-top: 20px; flex-wrap: wrap;">
                <div style="background: white; padding: 15px; border-radius: 10px; border-left: 4px solid var(--primary-color); min-width: 150px; border: 1px solid #e9ecef;">
                    <div style="font-size: 12px; color: #666; margin-bottom: 5px; font-weight: 600;">–¢–µ–∫—É—â–∏–π –ª–∏—Å—Ç</div>
                    <div style="font-size: 18px; font-weight: bold; color: var(--dark-text);" id="currentSheetName">‚Äî</div>
                </div>
                <div style="background: white; padding: 15px; border-radius: 10px; border-left: 4px solid var(--success-color); min-width: 150px; border: 1px solid #e9ecef;">
                    <div style="font-size: 12px; color: #666; margin-bottom: 5px; font-weight: 600;">–ó–∞–ø–∏—Å–µ–π</div>
                    <div style="font-size: 18px; font-weight: bold; color: var(--dark-text);" id="excelRowCount">0</div>
                </div>
                <div style="background: white; padding: 15px; border-radius: 10px; border-left: 4px solid var(--info-color); min-width: 150px; border: 1px solid #e9ecef;">
                    <div style="font-size: 12px; color: #666; margin-bottom: 5px; font-weight: 600;">–°—Ç–æ–ª–±—Ü–æ–≤</div>
                    <div style="font-size: 18px; font-weight: bold; color: var(--dark-text);" id="excelColCount">0</div>
                </div>
                <div style="background: white; padding: 15px; border-radius: 10px; border-left: 4px solid var(--warning-color); min-width: 150px; border: 1px solid #e9ecef;">
                    <div style="font-size: 12px; color: #666; margin-bottom: 5px; font-weight: 600;">–û–±–Ω–æ–≤–ª–µ–Ω–æ</div>
                    <div style="font-size: 18px; font-weight: bold; color: var(--dark-text);" id="excelUpdateTime">‚Äî</div>
                </div>
            </div>

            <div class="action-btns">
                <button class="action-btn" style="background: #666; color: white;" onclick="showSection('main')">
                    <i class="fas fa-arrow-left"></i> –ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é
                </button>
                <button class="action-btn btn-success" onclick="exportExcelToCSV()">
                    <i class="fas fa-download"></i> –≠–∫—Å–ø–æ—Ä—Ç CSV
                </button>
                <button class="action-btn btn-primary" onclick="exportToExcel()">
                    <i class="fas fa-file-excel"></i> –≠–∫—Å–ø–æ—Ä—Ç Excel
                </button>
            </div>
        </div>
    </main>

    <!-- –ú–û–î–ê–õ–¨–ù–´–ï –û–ö–ù–ê -->
    <div class="modal-overlay" id="visitModal">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title" id="modalTitle">
                    <i class="fas fa-car"></i> –ù–ê–ß–ê–¢–¨ –í–ò–ó–ò–¢
                </div>
                <button class="modal-close" onclick="closeModal()">√ó</button>
            </div>
            
            <div id="modalContent">
                <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
        </div>
    </div>

    <!-- –§–£–¢–ï–† -->
    <footer class="crm-footer">
        <div class="footer-container">
            <div class="footer-column">
                <h3>–í–ï–†–¢–£–ú CRM</h3>
                <p style="font-size: 13px; color: #ccc; margin-bottom: 20px; line-height: 1.5;">
                    –¢–æ—Ä–≥–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞–º–∏. –ü–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ –≤–∏–∑–∏—Ç–∞–º–∏, –≤—Å—Ç—Ä–µ—á–∞–º–∏ –∏ –ø—Ä–æ–¥–∞–∂–∞–º–∏.
                </p>
                <div class="footer-contacts" style="font-size: 13px;">
                    <div style="margin-bottom: 8px;"><i class="fas fa-user"></i> <span id="footerManager">–•–∏—Å–º–∞—Ç—É–ª–ª–∏–Ω –†—É—Å—Ç–∞–º –®–∞—Ñ–∫–∞—Ç–æ–≤–∏—á</span></div>
                    <div style="margin-bottom: 8px;"><i class="fas fa-envelope"></i> <span id="footerEmail">hrs@vertum.su</span></div>
                    <div style="margin-bottom: 8px;"><i class="fas fa-phone"></i> <span id="footerPhone">+7 (985) 710-21-27</span></div>
                    <div><i class="fas fa-database"></i> <span id="footerDataInfo">–ö–ª–∏–µ–Ω—Ç–æ–≤: 0 | –í–∏–∑–∏—Ç–æ–≤: 0</span></div>
                </div>
            </div>
            
            <div class="footer-column">
                <h3>–ë—ã—Å—Ç—Ä—ã–µ —Å—Å—ã–ª–∫–∏</h3>
                <ul class="footer-links">
                    <li><a href="#" onclick="showSection('clients')"><i class="fas fa-users"></i> –í—Å–µ –∫–ª–∏–µ–Ω—Ç—ã</a></li>
                    <li><a href="#" onclick="showSection('excelData')"><i class="fas fa-file-excel"></i> –î–∞–Ω–Ω—ã–µ Excel</a></li>
                    <li><a href="#" onclick="showCalendar()"><i class="fas fa-calendar-alt"></i> –ö–∞–ª–µ–Ω–¥–∞—Ä—å</a></li>
                    <li><a href="#" onclick="showRegistrationForm()"><i class="fas fa-user-plus"></i> –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a></li>
                    <li><a href="#" onclick="startVisit()"><i class="fas fa-play-circle"></i> –ù–∞—á–∞—Ç—å –≤–∏–∑–∏—Ç</a></li>
                    <li><a href="#" onclick="showVisitsHistory()"><i class="fas fa-history"></i> –ò—Å—Ç–æ—Ä–∏—è –≤–∏–∑–∏—Ç–æ–≤</a></li>
                </ul>
            </div>
            
            <div class="footer-column">
                <h3>–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</h3>
                <div style="display: flex; flex-direction: column; gap: 10px;">
                    <button class="footer-btn" onclick="exportCSV()">
                        <i class="fas fa-file-csv"></i> CSV —Ñ–∞–π–ª
                    </button>
                    <button class="footer-btn" onclick="exportToExcel()">
                        <i class="fas fa-file-excel"></i> Excel —Ñ–∞–π–ª
                    </button>
                    <button class="footer-btn" onclick="generateReport()">
                        <i class="fas fa-chart-bar"></i> –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
                    </button>
                </div>
                
                <h3 style="margin-top: 25px;">–°–∏—Å—Ç–µ–º–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏</h3>
                <div style="display: flex; flex-direction: column; gap: 10px;">
                    <button class="footer-btn" onclick="syncData()" style="font-size: 13px;">
                        <i class="fas fa-sync-alt"></i> –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
                    </button>
                    <button class="footer-btn" onclick="sendReport()" style="font-size: 13px;">
                        <i class="fas fa-paper-plane"></i> –û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç—á–µ—Ç
                    </button>
                </div>
            </div>
        </div>
        
        <div class="copyright">
            ¬© 2024 –í–ï–†–¢–£–ú CRM ‚Ä¢ <span id="currentDate"></span> ‚Ä¢ –í–µ—Ä—Å–∏—è 2.0 ‚Ä¢ 
            <span id="currentTime"></span> ‚Ä¢ <span id="systemStatus">üü¢ –°–∏—Å—Ç–µ–º–∞ –∞–∫—Ç–∏–≤–Ω–∞</span>
        </div>
    </footer>

    <script>
    // ============================================
    // –ü–û–õ–ù–´–ô –§–£–ù–ö–¶–ò–û–ù–ê–õ CRM –í–ï–†–¢–£–ú
    // ============================================

    // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
    let allClientsData = [];
    let filteredClientsData = [];
    let currentPage = 1;
    const itemsPerPage = 20;
    let activeVisit = null;
    let selectedClientForVisit = null;
    let visitTimer = null;
    let visitStartTime = null;
    let currentManager = {
        name: '–•–∏—Å–º–∞—Ç—É–ª–ª–∏–Ω –†—É—Å—Ç–∞–º –®–∞—Ñ–∫–∞—Ç–æ–≤–∏—á',
        email: 'hrs@vertum.su',
        phone: '+7 (985) 710-21-27',
        short: '–•–∏—Å–º–∞—Ç—É–ª–ª–∏–Ω –†.–®.'
    };

    // 1. –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –°–ò–°–¢–ï–ú–´
    document.addEventListener('DOMContentLoaded', function() {
        console.log('üöÄ –ó–∞–ø—É—Å–∫ –í–ï–†–¢–£–ú CRM v2.0...');
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã
        initializeSystem();
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞—Ç—ã –∏ –≤—Ä–µ–º–µ–Ω–∏
        updateDateTime();
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –≤–∏–∑–∏—Ç–∞
        checkActiveVisit();
        
        console.log('‚úÖ –í–ï–†–¢–£–ú CRM –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ');
    });

    function initializeSystem() {
        // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç–æ–≤
        loadClientsData();
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –º–µ–Ω–µ–¥–∂–µ—Ä–∞
        updateManagerUI();
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Ñ–∏–ª—å—Ç—Ä—ã
        initializeFilters();
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∫–∞–ª–µ–Ω–¥–∞—Ä—å
        initializeCalendar();
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
        updateStatistics();
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å–∏—Å—Ç–µ–º–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
        updateSystemInfo();
    }

    function updateDateTime() {
        const now = new Date();
        const dateOptions = { day: '2-digit', month: '2-digit', year: 'numeric' };
        const timeOptions = { hour: '2-digit', minute: '2-digit' };
        
        document.getElementById('currentDate').textContent = now.toLocaleDateString('ru-RU', dateOptions);
        document.getElementById('currentTime').textContent = now.toLocaleTimeString('ru-RU', timeOptions);
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É
        setTimeout(updateDateTime, 60000);
    }

    function updateSystemInfo() {
        const systemStatus = document.getElementById('systemStatus');
        if (systemStatus) {
            systemStatus.textContent = `üü¢ –°–∏—Å—Ç–µ–º–∞ –∞–∫—Ç–∏–≤–Ω–∞ | üë• ${allClientsData.length} –∫–ª–∏–µ–Ω—Ç–æ–≤`;
        }
        
        const footerInfo = document.getElementById('footerDataInfo');
        if (footerInfo) {
            const visits = getVisitsToday();
            footerInfo.textContent = `–ö–ª–∏–µ–Ω—Ç–æ–≤: ${allClientsData.length} | –í–∏–∑–∏—Ç–æ–≤ —Å–µ–≥–æ–¥–Ω—è: ${visits.length}`;
        }
    }

    // 2. –£–ü–†–ê–í–õ–ï–ù–ò–ï –î–ê–ù–ù–´–ú–ò –ö–õ–ò–ï–ù–¢–û–í
    function loadClientsData() {
        console.log('üì• –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤...');
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ localStorage
        const savedClients = localStorage.getItem('vertum_clients');
        if (savedClients) {
            allClientsData = JSON.parse(savedClients);
        } else {
            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
            loadSampleClients();
        }
        
        filteredClientsData = [...allClientsData];
        
        console.log(`‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ ${allClientsData.length} –∫–ª–∏–µ–Ω—Ç–æ–≤`);
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫–∏
        updateCounters();
    }

    function loadSampleClients() {
        // –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç–æ–≤
        const sampleClients = [
            {
                id: 1,
                code: '0780',
                name: '–ó–≤–æ–Ω–∞—Ä–µ–≤ –í. –ê. (–°–∏–º—Ñ–µ—Ä–æ–ø–æ–ª—å—Å–∫–æ–µ —à)',
                segmentation: '2.4 –°—Ç–∞–Ω–¥–∞—Ä—Ç –∑–∞ –¶–ö–ê–î (–°–∞–Ω—Ç–µ—Ö –∏ –≤–µ–Ω—Ç)',
                region: '–°–µ—Ä–ø—É—Ö–æ–≤ –≥.–æ.',
                businessType: '–†–æ–∑–Ω–∏—á–Ω—ã–π –ú–∞–≥–∞–∑–∏–Ω (–î–û)',
                productGroup: '–í–µ–Ω—Ç–∏–ª—è—Ü–∏—è –î–û',
                deliveryZone: '–ó–ê–ü–ê–î - –°—Ä–µ–¥–∞, –°—É–±–±–æ—Ç–∞',
                direction: '–°–∏–º—Ñ–µ—Ä–æ–ø–æ–ª—å—Å–∫–æ–µ —à.',
                address: '–≥–æ –°–µ—Ä–ø—É—Ö–æ–≤, –¥. –ö–∞–ª–∏–Ω–æ–≤–æ, –ö–∞–ª–∏–Ω–æ–≤—Å–∫–∏–π —Å—Ç—Ä–æ–π —Ä—ã–Ω–æ–∫ —É—á–∞—Å—Ç–æ–∫ 202 –ê',
                phone: '+7 (999) 123-45-67',
                email: 'zvonarev@example.com',
                status: '–ê–∫—Ç–∏–≤–µ–Ω',
                lastVisit: '15.02.2024',
                manager: '–•–∏—Å–º–∞—Ç—É–ª–ª–∏–Ω –†.–®.',
                createdAt: new Date().toISOString()
            },
            {
                id: 2,
                code: '0172',
                name: '–ü–µ—Ç—Ä–æ—Å—è–Ω –ì. –°. (–°–∏–º—Ñ–µ—Ä–æ–ø–æ–ª—å—Å–∫–æ–µ —à.)',
                segmentation: '2.2 –°—Ç–∞–Ω–¥–∞—Ä—Ç –¥–æ –¶–ö–ê–î (—Å–∞–Ω—Ç–µ—Ö –∏ –≤–µ–Ω—Ç)',
                region: '–ù–æ–≤–æ–º–æ—Å–∫–æ–≤—Å–∫–∏–π –ê–û',
                businessType: '–†–æ–∑–Ω–∏—á–Ω—ã–π –ú–∞–≥–∞–∑–∏–Ω (–î–û)',
                productGroup: '–í–µ–Ω—Ç–∏–ª—è—Ü–∏—è –î–û',
                deliveryZone: '–ó–ê–ü–ê–î - –°—Ä–µ–¥–∞, –°—É–±–±–æ—Ç–∞',
                direction: '–°–∏–º—Ñ–µ—Ä–æ–ø–æ–ª—å—Å–∫–æ–µ —à.',
                address: '–©–µ—Ä–±–∏–Ω–∫–∞,–°–∏–º—Ñ–µ—Ä–æ–ø–æ–ª—å—Å–∫–æ–µ —à., –¥. 17, –¢–ö "–£–¥–æ–±–Ω—ã–π", –ø–∞–≤. –ì 13',
                phone: '+7 (999) 234-56-78',
                email: 'petrosyan@example.com',
                status: '–ê–∫—Ç–∏–≤–µ–Ω',
                lastVisit: '10.02.2024',
                manager: '–•–∏—Å–º–∞—Ç—É–ª–ª–∏–Ω –†.–®.',
                createdAt: new Date().toISOString()
            },
            {
                id: 3,
                code: '0350',
                name: '–í–∞—Å–∏–ª—å–µ–≤ –ë.–í. (–ù–æ–≤–æ—Ä–∏–∂—Å–∫–æ–µ —à)',
                segmentation: '2.5 –ü–æ–ø—É—Ç–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞ –°—Ç–∞–Ω–¥–∞—Ä—Ç –¥–æ –¶–ö–ê–î (–≤—Å–µ)',
                region: '–ö—Ä–∞—Å–Ω–æ–≥–æ—Ä—Å–∫ –≥.–æ.',
                businessType: '–†–æ–∑–Ω–∏—á–Ω—ã–π –ú–∞–≥–∞–∑–∏–Ω (–î–û)',
                productGroup: '–ö—Ä–æ–≤–ª—è –î–û',
                deliveryZone: '–°–ï–í–ï–† - –í—Ç–æ—Ä–Ω–∏–∫, –ü—è—Ç–Ω–∏—Ü–∞',
                direction: '–ù–æ–≤–æ—Ä–∏–∂—Å–∫–æ–µ —à.',
                address: '–ö—Ä–∞—Å–Ω–æ–≥–æ—Ä—Å–∫–∏–π —Ä-–Ω, –ù–æ–≤–æ—Ä–∏–∂—Å–∫–æ–µ —à, 26-–π –∫–º. –°–† –ü–µ—Ç—Ä–æ–≤—Å–∫–∏–π, –ø–∞–≤. –î - 51',
                phone: '+7 (999) 345-67-89',
                email: 'vasilev@example.com',
                status: '–ê–∫—Ç–∏–≤–µ–Ω',
                lastVisit: '05.02.2024',
                manager: '–•–∏—Å–º–∞—Ç—É–ª–ª–∏–Ω –†.–®.',
                createdAt: new Date().toISOString()
            },
            {
                id: 4,
                code: '0411',
                name: '–ë–∞–ª—è–Ω –ù.–•. (–õ–µ–Ω–∏–Ω–≥—Ä–∞–¥—Å–∫–æ–µ —à)',
                segmentation: '2.3 –°—Ç–∞–Ω–¥–∞—Ä—Ç –∑–∞ –¶–ö–ê–î (–≤—Å–µ)',
                region: '–ö–ª–∏–Ω –≥.–æ.',
                businessType: '–†–æ–∑–Ω–∏—á–Ω—ã–π –ú–∞–≥–∞–∑–∏–Ω (–î–û)',
                productGroup: '–ö—Ä–æ–≤–ª—è –î–û',
                deliveryZone: '–°–ï–í–ï–† - –í—Ç–æ—Ä–Ω–∏–∫, –ü—è—Ç–Ω–∏—Ü–∞',
                direction: '–õ–µ–Ω–∏–Ω–≥—Ä–∞–¥—Å–∫–æ–µ —à.',
                address: '–≥. –ö–ª–∏–Ω —É–ª–∏—Ü–∞ –ß–∞–π–∫–æ–≤—Å–∫–æ–≥–æ –¥. 91 —Å—Ç9',
                phone: '+7 (999) 456-78-90',
                email: 'balyan@example.com',
                status: '–ê–∫—Ç–∏–≤–µ–Ω',
                lastVisit: '01.02.2024',
                manager: '–•–∏—Å–º–∞—Ç—É–ª–ª–∏–Ω –†.–®.',
                createdAt: new Date().toISOString()
            },
            {
                id: 5,
                code: '0192',
                name: '–ë–µ–ª—è–µ–≤ –ê.–Æ. (–°–∏–º—Ñ–µ—Ä–æ–ø–æ–ª—å—Å–∫–æ–µ —à)',
                segmentation: '2.1 –°—Ç–∞–Ω–¥–∞—Ä—Ç –¥–æ –¶–ö–ê–î (–≤—Å–µ)',
                region: '–ü–æ–¥–æ–ª—å—Å–∫ –≥.–æ.',
                businessType: '–†–æ–∑–Ω–∏—á–Ω—ã–π –ú–∞–≥–∞–∑–∏–Ω (–î–û)',
                productGroup: '–ö—Ä–æ–≤–ª—è –î–û',
                deliveryZone: '–ó–ê–ü–ê–î - –°—Ä–µ–¥–∞, –°—É–±–±–æ—Ç–∞',
                direction: '–°–∏–º—Ñ–µ—Ä–æ–ø–æ–ª—å—Å–∫–æ–µ —à.',
                address: '–ü–æ–¥–æ–ª—å—Å–∫–∏–π —Ä-–Ω., –ú-2 –ö—Ä—ã–º, 36-–π –∫–∏–ª–æ–º–µ—Ç—Ä, –¢–ö –ü–æ–∫—Ä–æ–≤ –ø–∞–≤. –õ- 036',
                phone: '+7 (999) 567-89-01',
                email: 'belyaev@example.com',
                status: '–ê–∫—Ç–∏–≤–µ–Ω',
                lastVisit: '25.01.2024',
                manager: '–•–∏—Å–º–∞—Ç—É–ª–ª–∏–Ω –†.–®.',
                createdAt: new Date().toISOString()
            }
        ];
        
        allClientsData = sampleClients;
        saveClientsToStorage();
    }

    function saveClientsToStorage() {
        localStorage.setItem('vertum_clients', JSON.stringify(allClientsData));
    }

    function updateCounters() {
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫ –∫–ª–∏–µ–Ω—Ç–æ–≤
        document.getElementById('clientsCount').textContent = allClientsData.length;
        document.getElementById('statTotalClients').textContent = allClientsData.length;
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫ –≤–∏–∑–∏—Ç–æ–≤ —Å–µ–≥–æ–¥–Ω—è
        updateVisitsToday();
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫ –∏—Å—Ç–æ—Ä–∏–∏ –≤–∏–∑–∏—Ç–æ–≤
        updateVisitsHistoryCount();
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –≤–∏–∑–∏—Ç–æ–≤
        updateVisitsStats();
    }

    // 3. –£–ü–†–ê–í–õ–ï–ù–ò–ï –ú–ï–ù–ï–î–ñ–ï–†–û–ú
    function toggleManagerDropdown() {
        const dropdown = document.getElementById('managersDropdown');
        const managerSelector = document.getElementById('currentManager');
        
        if (dropdown.style.display === 'block') {
            dropdown.style.display = 'none';
            managerSelector.classList.remove('active');
        } else {
            dropdown.style.display = 'block';
            managerSelector.classList.add('active');
        }
    }

    function selectManager(managerKey) {
        const managers = {
            '–•–∏—Å–º–∞—Ç—É–ª–ª–∏–Ω': {
                name: '–•–∏—Å–º–∞—Ç—É–ª–ª–∏–Ω –†—É—Å—Ç–∞–º –®–∞—Ñ–∫–∞—Ç–æ–≤–∏—á',
                email: 'hrs@vertum.su',
                phone: '+7 (985) 710-21-27',
                short: '–•–∏—Å–º–∞—Ç—É–ª–ª–∏–Ω –†.–®.'
            },
            '–•–∏—Ç—Ä–æ–≤': {
                name: '–•–∏—Ç—Ä–æ–≤ –ö–∏—Ä–∏–ª–ª –Æ—Ä—å–µ–≤–∏—á',
                email: 'hky@vertum.su',
                phone: '+7 (909) 624-99-00',
                short: '–•–∏—Ç—Ä–æ–≤ –ö.–Æ.'
            }
        };
        
        currentManager = managers[managerKey] || currentManager;
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
        updateManagerUI();
        
        // –ó–∞–∫—Ä—ã–≤–∞–µ–º –≤—ã–ø–∞–¥–∞—é—â–∏–π —Å–ø–∏—Å–æ–∫
        toggleManagerDropdown();
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç
        document.querySelectorAll('.manager-option').forEach(option => {
            option.classList.remove('active');
            if (option.textContent.includes(managerKey)) {
                option.classList.add('active');
            }
        });
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—ã–±–æ—Ä
        localStorage.setItem('vertum_current_manager', managerKey);
        
        // –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
        showNotification(`–ú–µ–Ω–µ–¥–∂–µ—Ä –∏–∑–º–µ–Ω–µ–Ω –Ω–∞: ${currentManager.name}`, 'info');
    }

    function updateManagerUI() {
        document.getElementById('currentManagerName').textContent = currentManager.name;
        document.getElementById('currentManagerContacts').textContent = 
            `${currentManager.email} ‚Ä¢ ${currentManager.phone}`;
        
        document.getElementById('footerManager').textContent = currentManager.name;
        document.getElementById('footerEmail').textContent = currentManager.email;
        document.getElementById('footerPhone').textContent = currentManager.phone;
        
        const badge = document.getElementById('currentManagerBadge');
        if (badge) {
            badge.textContent = currentManager.short;
        }
    }

    // 4. –ù–ê–í–ò–ì–ê–¶–ò–Ø –ü–û –†–ê–ó–î–ï–õ–ê–ú
    function showSection(sectionId) {
        // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —Ä–∞–∑–¥–µ–ª—ã
        document.getElementById('clientsSection').style.display = 'none';
        document.getElementById('excelDataSection').style.display = 'none';
        document.getElementById('mainMenu').style.display = 'grid';
        document.getElementById('miniCalendar').style.display = 'block';
        
        // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –º–µ–Ω—é
        document.querySelectorAll('.menu-card').forEach(card => {
            card.classList.remove('active');
        });
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Ä–∞–∑–¥–µ–ª
        if (sectionId === 'clients') {
            document.getElementById('clientsSection').style.display = 'block';
            document.querySelector('[data-section="clients"]').classList.add('active');
            document.getElementById('mainMenu').style.display = 'none';
            document.getElementById('miniCalendar').style.display = 'none';
            loadClientsTable();
        } else if (sectionId === 'excelData') {
            document.getElementById('excelDataSection').style.display = 'block';
            document.querySelector('[data-section="excelData"]').classList.add('active');
            document.getElementById('mainMenu').style.display = 'none';
            document.getElementById('miniCalendar').style.display = 'none';
            initializeExcelSection();
        } else if (sectionId === 'main') {
            document.getElementById('mainMenu').style.display = 'grid';
            document.getElementById('miniCalendar').style.display = 'block';
        }
    }

    // 5. –§–ò–õ–¨–¢–†–´ –ò –ü–û–ò–°–ö
    function initializeFilters() {
        const filtersGrid = document.getElementById('filtersGrid');
        if (!filtersGrid) return;
        
        const filters = [
            { id: 'filterRegion', label: '–ë–∏–∑–Ω–µ—Å-—Ä–µ–≥–∏–æ–Ω', key: 'region' },
            { id: 'filterBusinessType', label: '–í–∏–¥ –±–∏–∑–Ω–µ—Å–∞', key: 'businessType' },
            { id: 'filterProductGroup', label: '–¢–æ–≤–∞—Ä–Ω–∞—è –≥—Ä—É–ø–ø–∞', key: 'productGroup' },
            { id: 'filterSegmentation', label: '–°–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—è –ö–ë', key: 'segmentation' },
            { id: 'filterDeliveryZone', label: '–ó–æ–Ω–∞ –¥–æ—Å—Ç–∞–≤–∫–∏', key: 'deliveryZone' },
            { id: 'filterDirection', label: '–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ', key: 'direction' },
            { id: 'filterStatus', label: '–°—Ç–∞—Ç—É—Å –∫–ª–∏–µ–Ω—Ç–∞', key: 'status' },
            { id: 'filterLastVisit', label: '–ü–æ—Å–ª–µ–¥–Ω–∏–π –≤–∏–∑–∏—Ç', key: 'lastVisit' },
            { id: 'filterManager', label: '–ú–µ–Ω–µ–¥–∂–µ—Ä', key: 'manager' }
        ];
        
        let filtersHTML = '';
        filters.forEach(filter => {
            filtersHTML += `
                <div class="filter-item">
                    <label for="${filter.id}">${filter.label}</label>
                    <select class="filter-select" id="${filter.id}" onchange="applyFilters()">
                        <option value="">–í—Å–µ</option>
                    </select>
                </div>
            `;
        });
        
        filtersGrid.innerHTML = filtersHTML;
        
        // –ó–∞–ø–æ–ª–Ω—è–µ–º –æ–ø—Ü–∏–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤ —É–Ω–∏–∫–∞–ª—å–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏
        setTimeout(() => {
            filters.forEach(filter => {
                const uniqueValues = [...new Set(allClientsData.map(client => client[filter.key]).filter(Boolean))];
                const select = document.getElementById(filter.id);
                if (select) {
                    uniqueValues.forEach(value => {
                        const option = document.createElement('option');
                        option.value = value;
                        option.textContent = value;
                        select.appendChild(option);
                    });
                }
            });
        }, 100);
    }

    function applyFilters() {
        let filtered = [...allClientsData];
        
        // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫
        const searchTerm = document.getElementById('searchInput')?.value.toLowerCase() || '';
        if (searchTerm) {
            filtered = filtered.filter(client => 
                Object.values(client).some(value => 
                    value && value.toString().toLowerCase().includes(searchTerm)
                )
            );
        }
        
        // –ü—Ä–∏–º–µ–Ω—è–µ–º –≤—ã–ø–∞–¥–∞—é—â–∏–µ —Ñ–∏–ª—å—Ç—Ä—ã
        const filterIds = ['filterRegion', 'filterBusinessType', 'filterProductGroup', 
                          'filterSegmentation', 'filterDeliveryZone', 'filterDirection',
                          'filterStatus', 'filterLastVisit', 'filterManager'];
        
        let activeFiltersCount = 0;
        let activeFiltersHTML = '';
        
        filterIds.forEach(filterId => {
            const filter = document.getElementById(filterId);
            if (filter && filter.value) {
                const filterKey = getFilterKey(filterId);
                if (filterKey) {
                    filtered = filtered.filter(client => 
                        client[filterKey] && client[filterKey] === filter.value
                    );
                    
                    activeFiltersCount++;
                    activeFiltersHTML += `
                        <div class="filter-tag">
                            ${filter.options[filter.selectedIndex].text}
                            <span class="filter-tag-remove" onclick="removeFilter('${filterId}')">√ó</span>
                        </div>
                    `;
                }
            }
        });
        
        filteredClientsData = filtered;
        currentPage = 1;
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã
        const container = document.getElementById('activeFiltersContainer');
        const counter = document.getElementById('activeFiltersCount');
        
        if (activeFiltersCount > 0) {
            container.innerHTML = activeFiltersHTML;
            container.style.display = 'flex';
            counter.textContent = `–ê–∫—Ç–∏–≤–Ω—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤: ${activeFiltersCount}`;
        } else {
            container.style.display = 'none';
            counter.textContent = `–ê–∫—Ç–∏–≤–Ω—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤: 0`;
        }
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–∞–±–ª–∏—Ü—É
        loadClientsTable();
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫
        updateFilterCounter();
    }

    function getFilterKey(filterId) {
        const mapping = {
            'filterRegion': 'region',
            'filterBusinessType': 'businessType',
            'filterProductGroup': 'productGroup',
            'filterSegmentation': 'segmentation',
            'filterDeliveryZone': 'deliveryZone',
            'filterDirection': 'direction',
            'filterStatus': 'status',
            'filterLastVisit': 'lastVisit',
            'filterManager': 'manager'
        };
        return mapping[filterId];
    }

    function removeFilter(filterId) {
        const filter = document.getElementById(filterId);
        if (filter) {
            filter.value = '';
            applyFilters();
        }
    }

    function resetAllFilters() {
        // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—Å–µ —Ñ–∏–ª—å—Ç—Ä—ã
        const filterIds = ['filterRegion', 'filterBusinessType', 'filterProductGroup', 
                          'filterSegmentation', 'filterDeliveryZone', 'filterDirection',
                          'filterStatus', 'filterLastVisit', 'filterManager'];
        
        filterIds.forEach(filterId => {
            const filter = document.getElementById(filterId);
            if (filter) filter.value = '';
        });
        
        // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø–æ–∏—Å–∫
        const searchInput = document.getElementById('searchInput');
        if (searchInput) searchInput.value = '';
        
        // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ñ–∏–ª—å—Ç—Ä—ã
        applyFilters();
        
        showNotification('–í—Å–µ —Ñ–∏–ª—å—Ç—Ä—ã —Å–±—Ä–æ—à–µ–Ω—ã', 'info');
    }

    function filterTable() {
        applyFilters();
    }

    function updateFilterCounter() {
        const counter = document.getElementById('filteredCount');
        if (counter) {
            counter.innerHTML = `–ü–æ–∫–∞–∑–∞–Ω–æ: <strong>${filteredClientsData.length}</strong> –∏–∑ <strong>${allClientsData.length}</strong>`;
        }
    }

    // 6. –¢–ê–ë–õ–ò–¶–ê –ö–õ–ò–ï–ù–¢–û–í
    function loadClientsTable() {
        const tableHead = document.getElementById('clientsTableHead');
        const tableBody = document.getElementById('clientsTableBody');
        
        if (!tableHead || !tableBody) return;
        
        // –ó–∞–≥–æ–ª–æ–≤–∫–∏ —Ç–∞–±–ª–∏—Ü—ã
        const headers = [
            { key: 'code', label: '–ö–æ–¥', width: '80px' },
            { key: 'name', label: '–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ', width: '250px' },
            { key: 'region', label: '–†–µ–≥–∏–æ–Ω', width: '120px' },
            { key: 'businessType', label: '–í–∏–¥ –±–∏–∑–Ω–µ—Å–∞', width: '150px' },
            { key: 'productGroup', label: '–¢–æ–≤–∞—Ä–Ω–∞—è –≥—Ä—É–ø–ø–∞', width: '120px' },
            { key: 'deliveryZone', label: '–ó–æ–Ω–∞ –¥–æ—Å—Ç–∞–≤–∫–∏', width: '150px' },
            { key: 'address', label: '–ê–¥—Ä–µ—Å', width: '200px' },
            { key: 'phone', label: '–¢–µ–ª–µ—Ñ–æ–Ω', width: '120px' },
            { key: 'status', label: '–°—Ç–∞—Ç—É—Å', width: '100px' },
            { key: 'lastVisit', label: '–ü–æ—Å–ª–µ–¥–Ω–∏–π –≤–∏–∑–∏—Ç', width: '120px' },
            { key: 'actions', label: '–î–µ–π—Å—Ç–≤–∏—è', width: '150px' }
        ];
        
        let headHTML = '<tr>';
        headers.forEach(header => {
            headHTML += `<th style="min-width: ${header.width};">${header.label}</th>`;
        });
        headHTML += '</tr>';
        tableHead.innerHTML = headHTML;
        
        // –î–∞–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã
        let bodyHTML = '';
        const startIndex = (currentPage - 1) * itemsPerPage;
        const endIndex = Math.min(startIndex + itemsPerPage, filteredClientsData.length);
        
        if (filteredClientsData.length === 0) {
            bodyHTML = `<tr><td colspan="${headers.length}" style="text-align: center; padding: 40px; color: #666;">
                <i class="fas fa-users" style="font-size: 48px; margin-bottom: 15px; color: #e9ecef; display: block;"></i>
                –ö–ª–∏–µ–Ω—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã
            </td></tr>`;
        } else {
            for (let i = startIndex; i < endIndex; i++) {
                const client = filteredClientsData[i];
                const globalIndex = i + 1;
                
                bodyHTML += '<tr>';
                
                headers.forEach(header => {
                    if (header.key === 'actions') {
                        bodyHTML += `
                            <td>
                                <div class="action-cell">
                                    <button class="btn-small" style="background: var(--info-color); color: white;" 
                                            onclick="callClient(${client.id})" title="–ü–æ–∑–≤–æ–Ω–∏—Ç—å">
                                        <i class="fas fa-phone"></i>
                                    </button>
                                    <button class="btn-small" style="background: var(--warning-color); color: white;" 
                                            onclick="startVisitToClient(${client.id})" title="–ù–∞—á–∞—Ç—å –≤–∏–∑–∏—Ç">
                                        <i class="fas fa-car"></i>
                                    </button>
                                    <button class="btn-small" style="background: var(--success-color); color: white;" 
                                            onclick="editClient(${client.id})" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                </div>
                            </td>
                        `;
                    } else {
                        const value = client[header.key] || '';
                        const displayValue = value.length > 50 ? value.substring(0, 50) + '...' : value;
                        bodyHTML += `<td title="${value}">${displayValue}</td>`;
                    }
                });
                
                bodyHTML += '</tr>';
            }
        }
        
        tableBody.innerHTML = bodyHTML;
        
        // –°–æ–∑–¥–∞–µ–º –ø–∞–≥–∏–Ω–∞—Ü–∏—é
        createPagination();
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫
        updateFilterCounter();
    }

    function createPagination() {
        const pagination = document.getElementById('pagination');
        if (!pagination) return;
        
        const totalPages = Math.ceil(filteredClientsData.length / itemsPerPage);
        
        if (totalPages <= 1) {
            pagination.innerHTML = '';
            return;
        }
        
        let paginationHTML = '';
        
        if (currentPage > 1) {
            paginationHTML += `<button class="page-btn" onclick="changePage(${currentPage - 1})">
                <i class="fas fa-chevron-left"></i>
            </button>`;
        }
        
        for (let i = 1; i <= totalPages; i++) {
            if (i === 1 || i === totalPages || (i >= currentPage - 2 && i <= currentPage + 2)) {
                paginationHTML += `<button class="page-btn ${i === currentPage ? 'active' : ''}" 
                    onclick="changePage(${i})">${i}</button>`;
            } else if (i === currentPage - 3 || i === currentPage + 3) {
                paginationHTML += '<span style="padding: 7px 10px; color: #666;">...</span>';
            }
        }
        
        if (currentPage < totalPages) {
            paginationHTML += `<button class="page-btn" onclick="changePage(${currentPage + 1})">
                <i class="fas fa-chevron-right"></i>
            </button>`;
        }
        
        pagination.innerHTML = paginationHTML;
    }

    function changePage(page) {
        currentPage = page;
        loadClientsTable();
        
        // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ –Ω–∞—á–∞–ª—É —Ç–∞–±–ª–∏—Ü—ã
        document.getElementById('clientsTable').scrollIntoView({ behavior: 'smooth' });
    }

    // 7. –í–ò–ó–ò–¢–´
    function startVisit() {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –≤–∏–∑–∏—Ç
        if (activeVisit) {
            openActiveVisit();
            return;
        }
        
        // –û—Ç–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—ã–±–æ—Ä–∞ –∫–ª–∏–µ–Ω—Ç–∞
        openVisitModal('select');
    }

    function openVisitModal(step) {
        const modal = document.getElementById('visitModal');
        const content = document.getElementById('modalContent');
        const title = document.getElementById('modalTitle');
        
        if (step === 'select') {
            title.innerHTML = '<i class="fas fa-car"></i> –í–´–ë–û–† –ö–õ–ò–ï–ù–¢–ê –î–õ–Ø –í–ò–ó–ò–¢–ê';
            
            content.innerHTML = `
                <div style="margin-bottom: 25px;">
                    <input type="text" 
                           style="width: 100%; padding: 12px 15px; border: 2px solid var(--primary-color); border-radius: var(--border-radius); font-size: 14px; margin-bottom: 15px;" 
                           placeholder="üîç –ü–æ–∏—Å–∫ –∫–ª–∏–µ–Ω—Ç–∞..." 
                           id="visitClientSearch" 
                           oninput="searchClientsForVisit()">
                    
                    <div style="max-height: 400px; overflow-y: auto; border: 1px solid #e9ecef; border-radius: var(--border-radius);" 
                         id="visitClientsList">
                        ${generateClientsListForVisit()}
                    </div>
                </div>
                
                <div style="display: flex; justify-content: flex-end; gap: 12px;">
                    <button onclick="closeModal()" 
                            style="padding: 10px 20px; background: var(--light-bg); border: 2px solid var(--primary-color); border-radius: var(--border-radius); color: var(--primary-color); cursor: pointer; font-weight: 600; font-size: 14px;">
                        –û—Ç–º–µ–Ω–∞
                    </button>
                    <button onclick="proceedToVisitGoal()" 
                            style="padding: 10px 20px; background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%); color: white; border: none; border-radius: var(--border-radius); cursor: pointer; font-weight: 600; font-size: 14px;">
                        –î–∞–ª–µ–µ <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
            `;
        } else if (step === 'goal') {
            title.innerHTML = '<i class="fas fa-bullseye"></i> –¶–ï–õ–¨ –í–ò–ó–ò–¢–ê';
            
            content.innerHTML = `
                <div style="margin-bottom: 25px;">
                    <div style="background: var(--light-bg); padding: 15px; border-radius: var(--border-radius); margin-bottom: 20px; border: 2px solid var(--primary-color);">
                        <strong>–ö–ª–∏–µ–Ω—Ç:</strong> ${selectedClientForVisit.name || '–ö–ª–∏–µ–Ω—Ç'}<br>
                        <strong>–ö–æ–¥:</strong> ${selectedClientForVisit.code || '---'}<br>
                        <strong>–ê–¥—Ä–µ—Å:</strong> ${selectedClientForVisit.address || '–ù–µ —É–∫–∞–∑–∞–Ω'}
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">–¶–µ–ª—å –≤–∏–∑–∏—Ç–∞ *</label>
                        <select class="form-input" id="visitGoalSelect">
                            <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ —Ü–µ–ª—å –≤–∏–∑–∏—Ç–∞ --</option>
                            <option value="presentation">–ü—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—è –Ω–æ–≤–∏–Ω–æ–∫</option>
                            <option value="discussion">–û–±—Å—É–∂–¥–µ–Ω–∏–µ —É—Å–ª–æ–≤–∏–π</option>
                            <option value="contract">–ü–æ–¥–ø–∏—Å–∞–Ω–∏–µ –¥–æ–≥–æ–≤–æ—Ä–∞</option>
                            <option value="meeting">–í—Å—Ç—Ä–µ—á–∞</option>
                            <option value="planned">–ü–ª–∞–Ω–æ–≤—ã–π –≤–∏–∑–∏—Ç</option>
                            <option value="training">–û–±—É—á–µ–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–ª–∞</option>
                            <option value="other">–î—Ä—É–≥–æ–µ</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">–ü–ª–∞–Ω–∏—Ä—É–µ–º–∞—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (–º–∏–Ω—É—Ç) *</label>
                        <input type="number" class="form-input" id="plannedDuration" min="5" max="480" value="60">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">–ü—Ä–∏–º–µ—á–∞–Ω–∏—è</label>
                        <textarea class="form-textarea" id="visitNotes" placeholder="–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è..."></textarea>
                    </div>
                </div>
                
                <div style="display: flex; justify-content: space-between; gap: 12px;">
                    <button onclick="openVisitModal('select')" 
                            style="padding: 10px 20px; background: var(--light-bg); border: 2px solid var(--primary-color); border-radius: var(--border-radius); color: var(--primary-color); cursor: pointer; font-weight: 600; font-size: 14px;">
                        <i class="fas fa-arrow-left"></i> –ù–∞–∑–∞–¥
                    </button>
                    <button onclick="startVisitProcess()" 
                            style="padding: 10px 20px; background: linear-gradient(135deg, var(--success-color) 0%, #2E7D32 100%); color: white; border: none; border-radius: var(--border-radius); cursor: pointer; font-weight: 600; font-size: 14px;">
                        –ù–∞—á–∞—Ç—å –≤–∏–∑–∏—Ç
                    </button>
                </div>
            `;
        } else if (step === 'process') {
            title.innerHTML = '<i class="fas fa-play-circle"></i> –ü–†–û–¶–ï–°–° –í–ò–ó–ò–¢–ê';
            
            const goalText = getGoalText(selectedClientForVisit.visitGoal || '');
            const plannedDuration = selectedClientForVisit.plannedDuration || 60;
            
            content.innerHTML = `
                <div style="margin-bottom: 25px;">
                    <div style="background: linear-gradient(135deg, #f3f0ff 0%, #e9ecef 100%); padding: 20px; border-radius: var(--border-radius); margin-bottom: 20px; border: 2px solid var(--primary-color);">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <div>
                                <div style="font-size: 18px; font-weight: bold; color: var(--dark-text);">${selectedClientForVisit.name || '–ö–ª–∏–µ–Ω—Ç'}</div>
                                <div style="font-size: 13px; color: #666;">${selectedClientForVisit.address || ''}</div>
                            </div>
                            <div style="font-size: 24px; font-weight: bold; color: var(--primary-color);" id="visitTimerDisplay">00:00:00</div>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; font-size: 13px;">
                            <div><strong>–¶–µ–ª—å:</strong> ${goalText}</div>
                            <div><strong>–ü–ª–∞–Ω–∏—Ä—É–µ–º–æ–µ –≤—Ä–µ–º—è:</strong> ${plannedDuration} –º–∏–Ω</div>
                            <div><strong>–ù–∞—á–∞—Ç–æ:</strong> ${selectedClientForVisit.visitStartTime || new Date().toLocaleTimeString('ru-RU')}</div>
                            <div><strong>–†–µ–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è:</strong> <span id="actualTimeDisplay">00:00</span></div>
                        </div>
                    </div>
                    
                    <h4 style="color: var(--dark-text); margin-bottom: 15px; font-size: 16px;">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤–∏–∑–∏—Ç–∞:</h4>
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; margin-bottom: 20px;">
                        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; font-size: 13px;">
                            <input type="checkbox" id="resultOrder" style="width: 16px; height: 16px;">
                            <span>–ó–∞–∫–∞–∑ –æ—Ñ–æ—Ä–º–ª–µ–Ω</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; font-size: 13px;">
                            <input type="checkbox" id="resultPreorder" style="width: 16px; height: 16px;">
                            <span>–ü—Ä–µ–¥–∑–∞–∫–∞–∑ –≤–Ω–µ—Å–µ–Ω</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; font-size: 13px;">
                            <input type="checkbox" id="resultPrices" style="width: 16px; height: 16px;">
                            <span>–¶–µ–Ω—ã —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω—ã</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; font-size: 13px;">
                            <input type="checkbox" id="resultProblems" style="width: 16px; height: 16px;">
                            <span>–ü—Ä–æ–±–ª–µ–º—ã —Ä–µ—à–µ–Ω—ã</span>
                        </label>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">–ò—Ç–æ–≥–æ–≤–æ–µ –≤—Ä–µ–º—è –≤–∏–∑–∏—Ç–∞ (–º–∏–Ω—É—Ç) *</label>
                        <input type="number" class="form-input" id="finalDuration" min="1" max="480" value="${plannedDuration}">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">–ó–∞–º–µ—Ç–∫–∏ –ø–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º</label>
                        <textarea class="form-textarea" id="visitResultNotes" placeholder="–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤–∏–∑–∏—Ç–∞..."></textarea>
                    </div>
                </div>
                
                <div style="display: flex; justify-content: space-between; gap: 12px;">
                    <button onclick="saveVisitDraft()" 
                            style="padding: 10px 20px; background: var(--light-bg); border: 2px solid var(--primary-color); border-radius: var(--border-radius); color: var(--primary-color); cursor: pointer; font-weight: 600; font-size: 14px;">
                        <i class="fas fa-save"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —á–µ—Ä–Ω–æ–≤–∏–∫
                    </button>
                    <button onclick="completeVisit()" 
                            style="padding: 10px 20px; background: linear-gradient(135deg, var(--success-color) 0%, #2E7D32 100%); color: white; border: none; border-radius: var(--border-radius); cursor: pointer; font-weight: 600; font-size: 14px;">
                        <i class="fas fa-check-circle"></i> –ó–∞–≤–µ—Ä—à–∏—Ç—å –≤–∏–∑–∏—Ç
                    </button>
                </div>
            `;
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–∞–π–º–µ—Ä
            startVisitTimer();
        }
        
        modal.style.display = 'flex';
    }

    function generateClientsListForVisit() {
        if (allClientsData.length === 0) {
            return '<div style="text-align: center; padding: 40px; color: #666;">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤</div>';
        }
        
        let html = '';
        allClientsData.slice(0, 20).forEach(client => {
            html += `
                <div class="client-item" 
                     onclick="selectClientForVisit(${client.id})"
                     id="client-${client.id}"
                     style="padding: 12px 15px; border: 1px solid #e9ecef; border-radius: var(--border-radius); margin-bottom: 8px; cursor: pointer; transition: var(--transition);">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <div style="font-weight: 600; color: var(--dark-text); font-size: 14px;">${client.name}</div>
                            <div style="font-size: 12px; color: #666; margin-top: 3px;">
                                –ö–æ–¥: ${client.code} ‚Ä¢ ${client.region}
                            </div>
                        </div>
                        <div style="background: var(--primary-color); color: white; padding: 4px 10px; border-radius: 4px; font-size: 12px;">
                            –í—ã–±—Ä–∞—Ç—å
                        </div>
                    </div>
                </div>
            `;
        });
        return html;
    }

    function selectClientForVisit(clientId) {
        // –°–Ω–∏–º–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Å–æ –≤—Å–µ—Ö
        document.querySelectorAll('.client-item').forEach(item => {
            item.style.background = 'white';
            item.style.borderColor = '#e9ecef';
        });
        
        // –í—ã–¥–µ–ª—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ
        const element = document.getElementById(`client-${clientId}`);
        if (element) {
            element.style.background = 'linear-gradient(135deg, var(--light-bg) 0%, #e9ecef 100%)';
            element.style.borderColor = 'var(--primary-color)';
        }
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞
        selectedClientForVisit = allClientsData.find(c => c.id === clientId);
    }

    function searchClientsForVisit() {
        const searchTerm = document.getElementById('visitClientSearch').value.toLowerCase();
        const clientsList = document.getElementById('visitClientsList');
        
        if (!searchTerm) {
            clientsList.innerHTML = generateClientsListForVisit();
            return;
        }
        
        const filteredClients = allClientsData.filter(client => 
            (client.name && client.name.toLowerCase().includes(searchTerm)) ||
            (client.code && client.code.toString().toLowerCase().includes(searchTerm)) ||
            (client.address && client.address.toLowerCase().includes(searchTerm))
        );
        
        if (filteredClients.length === 0) {
            clientsList.innerHTML = '<div style="text-align: center; padding: 40px; color: #666;">–ö–ª–∏–µ–Ω—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div>';
            return;
        }
        
        let html = '';
        filteredClients.slice(0, 20).forEach(client => {
            html += `
                <div class="client-item" 
                     onclick="selectClientForVisit(${client.id})"
                     id="client-${client.id}"
                     style="padding: 12px 15px; border: 1px solid #e9ecef; border-radius: var(--border-radius); margin-bottom: 8px; cursor: pointer; transition: var(--transition);">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <div style="font-weight: 600; color: var(--dark-text); font-size: 14px;">${client.name}</div>
                            <div style="font-size: 12px; color: #666; margin-top: 3px;">
                                –ö–æ–¥: ${client.code} ‚Ä¢ ${client.region}
                            </div>
                        </div>
                        <div style="background: var(--primary-color); color: white; padding: 4px 10px; border-radius: 4px; font-size: 12px;">
                            –í—ã–±—Ä–∞—Ç—å
                        </div>
                    </div>
                </div>
            `;
        });
        
        clientsList.innerHTML = html;
    }

    function proceedToVisitGoal() {
        if (!selectedClientForVisit) {
            showNotification('–í—ã–±–µ—Ä–∏—Ç–µ –∫–ª–∏–µ–Ω—Ç–∞ –∏–∑ —Å–ø–∏—Å–∫–∞', 'warning');
            return;
        }
        
        openVisitModal('goal');
    }

    function getGoalText(goalValue) {
        const goals = {
            'presentation': '–ü—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—è –Ω–æ–≤–∏–Ω–æ–∫',
            'discussion': '–û–±—Å—É–∂–¥–µ–Ω–∏–µ —É—Å–ª–æ–≤–∏–π',
            'contract': '–ü–æ–¥–ø–∏—Å–∞–Ω–∏–µ –¥–æ–≥–æ–≤–æ—Ä–∞',
            'meeting': '–í—Å—Ç—Ä–µ—á–∞',
            'planned': '–ü–ª–∞–Ω–æ–≤—ã–π –≤–∏–∑–∏—Ç',
            'training': '–û–±—É—á–µ–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–ª–∞',
            'other': '–î—Ä—É–≥–æ–µ'
        };
        return goals[goalValue] || goalValue;
    }

    function startVisitProcess() {
        const goalSelect = document.getElementById('visitGoalSelect');
        const goal = goalSelect.value;
        const plannedDuration = parseInt(document.getElementById('plannedDuration').value) || 60;
        const notes = document.getElementById('visitNotes')?.value || '';
        
        if (!goal) {
            showNotification('–í—ã–±–µ—Ä–∏—Ç–µ —Ü–µ–ª—å –≤–∏–∑–∏—Ç–∞', 'warning');
            return;
        }
        
        selectedClientForVisit.visitGoal = goal;
        selectedClientForVisit.plannedDuration = plannedDuration;
        selectedClientForVisit.visitNotes = notes;
        selectedClientForVisit.visitStartTime = new Date().toLocaleTimeString('ru-RU');
        selectedClientForVisit.visitStartTimestamp = Date.now();
        
        // –°–æ–∑–¥–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –≤–∏–∑–∏—Ç
        activeVisit = {
            clientId: selectedClientForVisit.id,
            clientName: selectedClientForVisit.name,
            clientCode: selectedClientForVisit.code,
            startTime: selectedClientForVisit.visitStartTime,
            startTimestamp: selectedClientForVisit.visitStartTimestamp,
            date: new Date().toLocaleDateString('ru-RU'),
            goal: goal,
            plannedDuration: plannedDuration,
            notes: notes,
            status: 'active'
        };
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –≤–∏–∑–∏—Ç
        saveActiveVisit();
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–∞–Ω–µ–ª—å –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –≤–∏–∑–∏—Ç–∞
        showActiveVisitBar();
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –≤ —à–∞–ø–∫–µ
        updateVisitButton();
        
        // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ –ø—Ä–æ—Ü–µ—Å—Å—É –≤–∏–∑–∏—Ç–∞
        openVisitModal('process');
        
        showNotification(`–í–∏–∑–∏—Ç –Ω–∞—á–∞—Ç: ${selectedClientForVisit.name}`, 'info');
    }

    function startVisitTimer() {
        if (!selectedClientForVisit || !selectedClientForVisit.visitStartTimestamp) return;
        
        visitStartTime = selectedClientForVisit.visitStartTimestamp;
        
        function updateTimer() {
            if (!visitStartTime) return;
            
            const now = Date.now();
            const elapsed = now - visitStartTime;
            const seconds = Math.floor(elapsed / 1000);
            const minutes = Math.floor(seconds / 60);
            const hours = Math.floor(minutes / 60);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–∞–π–º–µ—Ä–∞
            const timerDisplay = document.getElementById('visitTimerDisplay');
            if (timerDisplay) {
                timerDisplay.textContent = 
                    `${hours.toString().padStart(2, '0')}:${(minutes % 60).toString().padStart(2, '0')}:${(seconds % 60).toString().padStart(2, '0')}`;
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
            const actualTimeDisplay = document.getElementById('actualTimeDisplay');
            if (actualTimeDisplay) {
                actualTimeDisplay.textContent = `${minutes} –º–∏–Ω—É—Ç`;
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ –ø–∞–Ω–µ–ª–∏ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –≤–∏–∑–∏—Ç–∞
            const durationDisplay = document.getElementById('activeVisitDuration');
            if (durationDisplay && activeVisit) {
                if (hours > 0) {
                    durationDisplay.textContent = `${hours}—á ${minutes % 60}–º`;
                } else {
                    durationDisplay.textContent = `${minutes} –º–∏–Ω—É—Ç`;
                }
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–ª–µ –∏—Ç–æ–≥–æ–≤–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
            const finalDurationInput = document.getElementById('finalDuration');
            if (finalDurationInput) {
                finalDurationInput.value = minutes;
            }
        }
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ä–∞–∑—É
        updateTimer();
        
        // –ó–∞–ø—É—Å–∫–∞–µ–º –∏–Ω—Ç–µ—Ä–≤–∞–ª
        visitTimer = setInterval(updateTimer, 1000);
    }

    function stopVisitTimer() {
        if (visitTimer) {
            clearInterval(visitTimer);
            visitTimer = null;
        }
        visitStartTime = null;
    }

    function showActiveVisitBar() {
        const bar = document.getElementById('activeVisitBar');
        const clientSpan = document.getElementById('activeVisitClient');
        const timeSpan = document.getElementById('activeVisitTime');
        
        if (activeVisit) {
            clientSpan.textContent = activeVisit.clientName || '–ö–ª–∏–µ–Ω—Ç';
            timeSpan.textContent = activeVisit.startTime;
            bar.style.display = 'block';
        }
    }

    function saveActiveVisit() {
        localStorage.setItem('vertum_active_visit', JSON.stringify(activeVisit));
    }

    function checkActiveVisit() {
        const savedVisit = localStorage.getItem('vertum_active_visit');
        if (savedVisit) {
            activeVisit = JSON.parse(savedVisit);
            
            // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç–∞
            if (activeVisit.clientId) {
                selectedClientForVisit = allClientsData.find(c => c.id === activeVisit.clientId);
            }
            
            if (activeVisit.status === 'active') {
                showActiveVisitBar();
                updateVisitButton();
            }
        }
    }

    function openActiveVisit() {
        if (activeVisit && activeVisit.status === 'active') {
            openVisitModal('process');
        }
    }

    function updateVisitButton() {
        const btn = document.getElementById('startVisitBtn');
        if (activeVisit && activeVisit.status === 'active') {
            btn.innerHTML = '<i class="fas fa-car"></i> –í–ò–ó–ò–¢ –ò–î–Å–¢';
            btn.style.background = 'linear-gradient(135deg, var(--success-color) 0%, #2E7D32 100%)';
        } else {
            btn.innerHTML = '<i class="fas fa-play-circle"></i> –ù–ê–ß–ê–¢–¨ –í–ò–ó–ò–¢';
            btn.style.background = 'linear-gradient(135deg, var(--warning-color) 0%, #F57C00 100%)';
        }
    }

    function saveVisitDraft() {
        if (!activeVisit) return;
        
        const results = [];
        ['resultOrder', 'resultPreorder', 'resultPrices', 'resultProblems'].forEach(id => {
            if (document.getElementById(id)?.checked) {
                results.push(id.replace('result', '').toLowerCase());
            }
        });
        
        const finalDuration = parseInt(document.getElementById('finalDuration')?.value) || 
                              activeVisit.plannedDuration || 60;
        const resultNotes = document.getElementById('visitResultNotes')?.value || '';
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º —á–µ—Ä–Ω–æ–≤–∏–∫
        localStorage.setItem('visit_draft', JSON.stringify({
            visitId: activeVisit.clientId,
            results: results,
            notes: resultNotes,
            duration: finalDuration,
            timestamp: new Date().toISOString()
        }));
        
        showNotification('–ß–µ—Ä–Ω–æ–≤–∏–∫ –≤–∏–∑–∏—Ç–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω', 'info');
    }

    function completeVisit() {
        if (!activeVisit) return;
        
        const results = [];
        ['resultOrder', 'resultPreorder', 'resultPrices', 'resultProblems'].forEach(id => {
            if (document.getElementById(id)?.checked) {
                results.push(id.replace('result', '').toLowerCase());
            }
        });
        
        const finalDuration = parseInt(document.getElementById('finalDuration')?.value) || 
                              activeVisit.plannedDuration || 60;
        const resultNotes = document.getElementById('visitResultNotes')?.value || '';
        const today = new Date().toLocaleDateString('ru-RU');
        const endTime = new Date().toLocaleTimeString('ru-RU');
        
        // –°–æ–∑–¥–∞–µ–º –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–π –≤–∏–∑–∏—Ç
        const completedVisit = {
            ...activeVisit,
            endTime: endTime,
            duration: finalDuration,
            status: 'completed',
            results: results,
            resultNotes: resultNotes,
            completedAt: new Date().toISOString()
        };
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤–∏–∑–∏—Ç
        saveVisit(completedVisit);
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞—Ç—É –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –≤–∏–∑–∏—Ç–∞ —É –∫–ª–∏–µ–Ω—Ç–∞
        if (selectedClientForVisit) {
            selectedClientForVisit.lastVisit = today;
            saveClientsToStorage();
        }
        
        // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
        closeModal();
        
        // –°–∫—Ä—ã–≤–∞–µ–º –ø–∞–Ω–µ–ª—å –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –≤–∏–∑–∏—Ç–∞
        document.getElementById('activeVisitBar').style.display = 'none';
        
        // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –≤–∏–∑–∏—Ç
        activeVisit = null;
        selectedClientForVisit = null;
        localStorage.removeItem('vertum_active_visit');
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫–∏
        updateVisitsToday();
        updateVisitsHistoryCount();
        updateVisitsStats();
        updateVisitButton();
        
        // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–∞–π–º–µ—Ä
        stopVisitTimer();
        
        showNotification(`‚úÖ –í–∏–∑–∏—Ç –∑–∞–≤–µ—Ä—à–µ–Ω. –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: ${finalDuration} –º–∏–Ω.`, 'info');
    }

    function saveVisit(visit) {
        const visits = getVisitsByDate(visit.date);
        visits.push(visit);
        localStorage.setItem(`vertum_visits_${visit.date}`, JSON.stringify(visits));
    }

    function getVisitsByDate(date) {
        return JSON.parse(localStorage.getItem(`vertum_visits_${date}`) || '[]');
    }

    function getVisitsToday() {
        const today = new Date().toLocaleDateString('ru-RU');
        return getVisitsByDate(today);
    }

    function getAllVisits() {
        let allVisits = [];
        for (let i = 0; i < localStorage.length; i++) {
            const key = localStorage.key(i);
            if (key.startsWith('vertum_visits_')) {
                const visits = JSON.parse(localStorage.getItem(key) || '[]');
                allVisits = [...allVisits, ...visits];
            }
        }
        return allVisits;
    }

    function updateVisitsToday() {
        const visits = getVisitsToday();
        document.getElementById('visitsToday').textContent = visits.filter(v => v.status === 'completed').length;
    }

    function updateVisitsHistoryCount() {
        const allVisits = getAllVisits();
        document.getElementById('visitsHistoryCount').textContent = allVisits.filter(v => v.status === 'completed').length;
    }

    function updateVisitsStats() {
        const allVisits = getAllVisits();
        const completedVisits = allVisits.filter(v => v.status === 'completed');
        document.getElementById('statVisitsCount').textContent = completedVisits.length;
    }

    function startVisitToClient(clientId) {
        const client = allClientsData.find(c => c.id === clientId);
        if (client) {
            selectedClientForVisit = client;
            openVisitModal('goal');
        }
    }

    function startVisitFromTable() {
        showNotification('–î–ª—è –Ω–∞—á–∞–ª–∞ –≤–∏–∑–∏—Ç–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–º –∫–ª–∏–µ–Ω—Ç–∞–º –≤—ã–¥–µ–ª–∏—Ç–µ –∏—Ö –≤ —Ç–∞–±–ª–∏—Ü–µ', 'info');
    }

    // 8. –†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø –ö–õ–ò–ï–ù–¢–ê
    function showRegistrationForm() {
        const modal = document.getElementById('visitModal');
        const content = document.getElementById('modalContent');
        const title = document.getElementById('modalTitle');
        
        title.innerHTML = '<i class="fas fa-user-plus"></i> –†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø –ù–û–í–û–ì–û –ö–õ–ò–ï–ù–¢–ê';
        
        content.innerHTML = `
            <div style="margin-bottom: 25px;">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                    <div class="form-group">
                        <label class="form-label">–ö–æ–¥ –∫–ª–∏–µ–Ω—Ç–∞ *</label>
                        <input type="text" class="form-input" id="regCode" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 0999">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ *</label>
                        <input type="text" class="form-input" id="regName" placeholder="–ü–æ–ª–Ω–æ–µ –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">–ë–∏–∑–Ω–µ—Å-—Ä–µ–≥–∏–æ–Ω *</label>
                        <select class="form-input" id="regRegion">
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–≥–∏–æ–Ω</option>
                            <option value="–°–µ—Ä–ø—É—Ö–æ–≤ –≥.–æ.">–°–µ—Ä–ø—É—Ö–æ–≤ –≥.–æ.</option>
                            <option value="–ù–æ–≤–æ–º–æ—Å–∫–æ–≤—Å–∫–∏–π –ê–û">–ù–æ–≤–æ–º–æ—Å–∫–æ–≤—Å–∫–∏–π –ê–û</option>
                            <option value="–ö—Ä–∞—Å–Ω–æ–≥–æ—Ä—Å–∫ –≥.–æ.">–ö—Ä–∞—Å–Ω–æ–≥–æ—Ä—Å–∫ –≥.–æ.</option>
                            <option value="–ö–ª–∏–Ω –≥.–æ.">–ö–ª–∏–Ω –≥.–æ.</option>
                            <option value="–ü–æ–¥–æ–ª—å—Å–∫ –≥.–æ.">–ü–æ–¥–æ–ª—å—Å–∫ –≥.–æ.</option>
                            <option value="–û–¥–∏–Ω—Ü–æ–≤—Å–∫–∏–π –≥.–æ.">–û–¥–∏–Ω—Ü–æ–≤—Å–∫–∏–π –≥.–æ.</option>
                            <option value="–•–∏–º–∫–∏ –≥.–æ.">–•–∏–º–∫–∏ –≥.–æ.</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">–í–∏–¥ –±–∏–∑–Ω–µ—Å–∞ *</label>
                        <select class="form-input" id="regBusinessType">
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –≤–∏–¥ –±–∏–∑–Ω–µ—Å–∞</option>
                            <option value="–†–æ–∑–Ω–∏—á–Ω—ã–π –ú–∞–≥–∞–∑–∏–Ω (–î–û)">–†–æ–∑–Ω–∏—á–Ω—ã–π –ú–∞–≥–∞–∑–∏–Ω (–î–û)</option>
                            <option value="–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å (–î–û)">–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å (–î–û)</option>
                            <option value="–ò–Ω—Ç–µ—Ä–Ω–µ—Ç –ú–∞–≥–∞–∑–∏–Ω (–î–û)">–ò–Ω—Ç–µ—Ä–Ω–µ—Ç –ú–∞–≥–∞–∑–∏–Ω (–î–û)</option>
                            <option value="–û–ø—Ç–æ–≤—ã–π —Å–∫–ª–∞–¥">–û–ø—Ç–æ–≤—ã–π —Å–∫–ª–∞–¥</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">–¢–æ–≤–∞—Ä–Ω–∞—è –≥—Ä—É–ø–ø–∞ *</label>
                        <select class="form-input" id="regProductGroup">
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –≥—Ä—É–ø–ø—É</option>
                            <option value="–í–µ–Ω—Ç–∏–ª—è—Ü–∏—è –î–û">–í–µ–Ω—Ç–∏–ª—è—Ü–∏—è –î–û</option>
                            <option value="–ö—Ä–æ–≤–ª—è –î–û">–ö—Ä–æ–≤–ª—è –î–û</option>
                            <option value="–°–∞–Ω—Ç–µ—Ö–Ω–∏–∫–∞ –î–û">–°–∞–Ω—Ç–µ—Ö–Ω–∏–∫–∞ –î–û</option>
                            <option value="–§–∞—Å–∞–¥–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã">–§–∞—Å–∞–¥–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">–¢–µ–ª–µ—Ñ–æ–Ω</label>
                        <input type="tel" class="form-input" id="regPhone" placeholder="+7 (999) 999-99-99">
                    </div>
                    
                    <div class="form-group" style="grid-column: span 2;">
                        <label class="form-label">–ê–¥—Ä–µ—Å</label>
                        <input type="text" class="form-input" id="regAddress" placeholder="–ü–æ–ª–Ω—ã–π –∞–¥—Ä–µ—Å">
                    </div>
                    
                    <div class="form-group" style="grid-column: span 2;">
                        <label class="form-label">Email</label>
                        <input type="email" class="form-input" id="regEmail" placeholder="email@example.com">
                    </div>
                    
                    <div class="form-group" style="grid-column: span 2;">
                        <label class="form-label">–ü—Ä–∏–º–µ—á–∞–Ω–∏—è</label>
                        <textarea class="form-textarea" id="regNotes" placeholder="–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è..."></textarea>
                    </div>
                </div>
                
                <div style="background: var(--light-bg); padding: 15px; border-radius: var(--border-radius); margin-bottom: 15px;">
                    <div style="font-weight: 600; color: var(--dark-text); margin-bottom: 5px;">–ú–µ–Ω–µ–¥–∂–µ—Ä:</div>
                    <div>${currentManager.name}</div>
                </div>
            </div>
            
            <div style="display: flex; justify-content: flex-end; gap: 12px;">
                <button onclick="closeModal()" 
                        style="padding: 10px 20px; background: var(--light-bg); border: 2px solid var(--primary-color); border-radius: var(--border-radius); color: var(--primary-color); cursor: pointer; font-weight: 600; font-size: 14px;">
                    –û—Ç–º–µ–Ω–∞
                </button>
                <button onclick="registerNewClient()" 
                        style="padding: 10px 20px; background: linear-gradient(135deg, var(--success-color) 0%, #2E7D32 100%); color: white; border: none; border-radius: var(--border-radius); cursor: pointer; font-weight: 600; font-size: 14px;">
                    <i class="fas fa-save"></i> –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å
                </button>
            </div>
        `;
        
        modal.style.display = 'flex';
    }

    function registerNewClient() {
        const code = document.getElementById('regCode')?.value.trim();
        const name = document.getElementById('regName')?.value.trim();
        const region = document.getElementById('regRegion')?.value;
        const businessType = document.getElementById('regBusinessType')?.value;
        const productGroup = document.getElementById('regProductGroup')?.value;
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π
        if (!code || !name || !region || !businessType || !productGroup) {
            showNotification('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è (–ø–æ–º–µ—á–µ–Ω—ã *)', 'warning');
            return;
        }
        
        // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º ID
        const newId = allClientsData.length > 0 ? Math.max(...allClientsData.map(c => c.id)) + 1 : 1;
        
        // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞
        const newClient = {
            id: newId,
            code: code,
            name: name,
            segmentation: '2.0 –ù–æ–≤—ã–π –∫–ª–∏–µ–Ω—Ç',
            region: region,
            businessType: businessType,
            productGroup: productGroup,
            deliveryZone: '–ù–ï –û–ü–†–ï–î–ï–õ–ï–ù–û',
            direction: '–ù–ï –û–ü–†–ï–î–ï–õ–ï–ù–û',
            address: document.getElementById('regAddress')?.value.trim() || '',
            phone: document.getElementById('regPhone')?.value.trim() || '',
            email: document.getElementById('regEmail')?.value.trim() || '',
            notes: document.getElementById('regNotes')?.value.trim() || '',
            status: '–ù–æ–≤—ã–π',
            lastVisit: '',
            manager: currentManager.name,
            createdAt: new Date().toISOString()
        };
        
        // –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∏–µ–Ω—Ç–∞
        allClientsData.push(newClient);
        saveClientsToStorage();
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
        filteredClientsData = [...allClientsData];
        updateCounters();
        updateSystemInfo();
        
        // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
        closeModal();
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
        showNotification(`–ö–ª–∏–µ–Ω—Ç "${name}" –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω! –ö–æ–¥: ${code}`, 'info');
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–∞–∑–¥–µ–ª —Å –∫–ª–∏–µ–Ω—Ç–∞–º–∏
        showSection('clients');
    }

    // 9. –ö–ê–õ–ï–ù–î–ê–†–¨
    function showCalendar() {
        const modal = document.getElementById('visitModal');
        const content = document.getElementById('modalContent');
        const title = document.getElementById('modalTitle');
        
        title.innerHTML = '<i class="fas fa-calendar-alt"></i> –ö–ê–õ–ï–ù–î–ê–†–¨ –í–°–¢–†–ï–ß –ò –í–ò–ó–ò–¢–û–í';
        
        const today = new Date();
        const currentMonth = today.getMonth();
        const currentYear = today.getFullYear();
        
        content.innerHTML = `
            <div style="margin-bottom: 25px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <div style="font-weight: 600; font-size: 18px; color: var(--dark-text);" id="calendarTitle">
                        ${getMonthName(currentMonth)} ${currentYear}
                    </div>
                    <div style="display: flex; gap: 10px;">
                        <button onclick="changeCalendarMonth(-1)" 
                                style="padding: 8px 15px; background: var(--light-bg); border: 2px solid var(--primary-color); border-radius: var(--border-radius); color: var(--primary-color); cursor: pointer;">
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        <button onclick="changeCalendarMonth(1)" 
                                style="padding: 8px 15px; background: var(--light-bg); border: 2px solid var(--primary-color); border-radius: var(--border-radius); color: var(--primary-color); cursor: pointer;">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                </div>
                
                <div id="calendarContainer">
                    ${generateCalendar(currentMonth, currentYear)}
                </div>
                
                <div style="margin-top: 25px;">
                    <h4 style="color: var(--dark-text); margin-bottom: 15px; font-size: 16px;">
                        <i class="fas fa-calendar-check"></i> –ë–ª–∏–∂–∞–π—à–∏–µ —Å–æ–±—ã—Ç–∏—è
                    </h4>
                    <div id="eventsList">
                        ${generateEventsList()}
                    </div>
                </div>
            </div>
            
            <div style="display: flex; justify-content: flex-end; gap: 12px;">
                <button onclick="addCalendarEvent()" 
                        style="padding: 10px 20px; background: linear-gradient(135deg, var(--success-color) 0%, #2E7D32 100%); color: white; border: none; border-radius: var(--border-radius); cursor: pointer; font-weight: 600; font-size: 14px;">
                    <i class="fas fa-plus"></i> –î–æ–±–∞–≤–∏—Ç—å —Å–æ–±—ã—Ç–∏–µ
                </button>
                <button onclick="closeModal()" 
                        style="padding: 10px 20px; background: var(--light-bg); border: 2px solid var(--primary-color); border-radius: var(--border-radius); color: var(--primary-color); cursor: pointer; font-weight: 600; font-size: 14px;">
                    –ó–∞–∫—Ä—ã—Ç—å
                </button>
            </div>
        `;
        
        modal.style.display = 'flex';
    }

    function getMonthName(month) {
        const months = [
            '–Ø–ù–í–ê–†–¨', '–§–ï–í–†–ê–õ–¨', '–ú–ê–†–¢', '–ê–ü–†–ï–õ–¨', '–ú–ê–ô', '–ò–Æ–ù–¨',
            '–ò–Æ–õ–¨', '–ê–í–ì–£–°–¢', '–°–ï–ù–¢–Ø–ë–†–¨', '–û–ö–¢–Ø–ë–†–¨', '–ù–û–Ø–ë–†–¨', '–î–ï–ö–ê–ë–†–¨'
        ];
        return months[month];
    }

    function generateCalendar(month, year) {
        const firstDay = new Date(year, month, 1);
        const lastDay = new Date(year, month + 1, 0);
        const daysInMonth = lastDay.getDate();
        const startingDay = firstDay.getDay();
        
        let calendarHTML = `
            <div style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 8px; margin-bottom: 20px;">
                <div style="text-align: center; font-weight: 600; color: var(--primary-color); padding: 12px; background: var(--light-bg); border-radius: var(--border-radius);">–ü–Ω</div>
                <div style="text-align: center; font-weight: 600; color: var(--primary-color); padding: 12px; background: var(--light-bg); border-radius: var(--border-radius);">–í—Ç</div>
                <div style="text-align: center; font-weight: 600; color: var(--primary-color); padding: 12px; background: var(--light-bg); border-radius: var(--border-radius);">–°—Ä</div>
                <div style="text-align: center; font-weight: 600; color: var(--primary-color); padding: 12px; background: var(--light-bg); border-radius: var(--border-radius);">–ß—Ç</div>
                <div style="text-align: center; font-weight: 600; color: var(--primary-color); padding: 12px; background: var(--light-bg); border-radius: var(--border-radius);">–ü—Ç</div>
                <div style="text-align: center; font-weight: 600; color: var(--primary-color); padding: 12px; background: var(--light-bg); border-radius: var(--border-radius);">–°–±</div>
                <div style="text-align: center; font-weight: 600; color: var(--primary-color); padding: 12px; background: var(--light-bg); border-radius: var(--border-radius);">–í—Å</div>
        `;
        
        // –ü—É—Å—Ç—ã–µ —è—á–µ–π–∫–∏ –¥–æ –ø–µ—Ä–≤–æ–≥–æ –¥–Ω—è –º–µ—Å—è—Ü–∞
        for (let i = 0; i < (startingDay === 0 ? 6 : startingDay - 1); i++) {
            calendarHTML += '<div style="padding: 15px; background: #f8f9fa; border-radius: var(--border-radius);"></div>';
        }
        
        // –î–Ω–∏ –º–µ—Å—è—Ü–∞
        const today = new Date();
        for (let day = 1; day <= daysInMonth; day++) {
            const isToday = day === today.getDate() && month === today.getMonth() && year === today.getFullYear();
            const isWeekend = (startingDay + day - 1) % 7 >= 5;
            
            let dayClass = 'calendar-day';
            let dayStyle = `padding: 15px; text-align: center; cursor: pointer; border-radius: var(--border-radius); font-weight: 600;`;
            
            if (isToday) {
                dayStyle += `background: linear-gradient(135deg, var(--success-color) 0%, #2E7D32 100%); color: white;`;
            } else if (isWeekend) {
                dayStyle += `background: #f3f0ff; color: var(--secondary-color);`;
            } else {
                dayStyle += `background: white; color: var(--dark-text);`;
            }
            
            calendarHTML += `
                <div style="${dayStyle}" onclick="selectCalendarDate(${day}, ${month}, ${year})">
                    ${day}
                    ${day === 20 ? '<div style="font-size: 10px; margin-top: 3px; color: var(--warning-color);">üéÇ</div>' : ''}
                    ${day === 21 ? '<div style="font-size: 10px; margin-top: 3px; color: var(--info-color);">üë•</div>' : ''}
                    ${day === 25 ? '<div style="font-size: 10px; margin-top: 3px; color: var(--success-color);">üìä</div>' : ''}
                </div>
            `;
        }
        
        calendarHTML += '</div>';
        return calendarHTML;
    }

    function generateEventsList() {
        const events = [
            { date: '20 —Ñ–µ–≤—Ä–∞–ª—è', title: '–î–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞', client: '–ü–µ—Ç—Ä–æ—Å—è–Ω –ì.–°.', type: 'birthday' },
            { date: '21 —Ñ–µ–≤—Ä–∞–ª—è, 14:30', title: '–í—Å—Ç—Ä–µ—á–∞ —Å –∫–ª–∏–µ–Ω—Ç–æ–º', client: '–ó–≤–æ–Ω–∞—Ä–µ–≤ –í.–ê.', type: 'meeting' },
            { date: '25 —Ñ–µ–≤—Ä–∞–ª—è, 11:00', title: '–ü—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—è –Ω–æ–≤–∏–Ω–æ–∫', client: '–í—Å–µ –∫–ª–∏–µ–Ω—Ç—ã', type: 'presentation' }
        ];
        
        let html = '';
        events.forEach(event => {
            html += `
                <div style="border-left: 4px solid var(--primary-color); padding: 12px 15px; margin-bottom: 10px; background: white; border-radius: var(--border-radius);">
                    <div style="font-weight: 600; color: var(--dark-text);">${event.title}</div>
                    <div style="font-size: 13px; color: #666; margin-top: 3px;">
                        <i class="fas fa-calendar"></i> ${event.date} ‚Ä¢ 
                        <i class="fas fa-user"></i> ${event.client}
                    </div>
                </div>
            `;
        });
        
        return html;
    }

    function changeCalendarMonth(delta) {
        showNotification('–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ—Å—è—Ü–µ–≤ –∫–∞–ª–µ–Ω–¥–∞—Ä—è', 'info');
    }

    function selectCalendarDate(day, month, year) {
        showNotification(`–í—ã–±—Ä–∞–Ω–∞ –¥–∞—Ç–∞: ${day}.${month + 1}.${year}`, 'info');
    }

    function addCalendarEvent() {
        showNotification('–î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è –≤ –∫–∞–ª–µ–Ω–¥–∞—Ä—å', 'info');
    }

    function initializeCalendar() {
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–∏–Ω–∏-–∫–∞–ª–µ–Ω–¥–∞—Ä—è
        const miniCalendar = document.getElementById('miniCalendar');
        if (miniCalendar) {
            // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–∞–ª–µ–Ω–¥–∞—Ä—è
        }
    }

    // 10. –ò–°–¢–û–†–ò–Ø –í–ò–ó–ò–¢–û–í
    function showVisitsHistory() {
        const modal = document.getElementById('visitModal');
        const content = document.getElementById('modalContent');
        const title = document.getElementById('modalTitle');
        
        title.innerHTML = '<i class="fas fa-history"></i> –ò–°–¢–û–†–ò–Ø –í–ò–ó–ò–¢–û–í';
        
        const allVisits = getAllVisits().filter(v => v.status === 'completed');
        
        content.innerHTML = `
            <div style="margin-bottom: 25px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <div style="font-weight: 600; color: var(--dark-text);">
                        –í—Å–µ–≥–æ –≤–∏–∑–∏—Ç–æ–≤: <span style="color: var(--primary-color);">${allVisits.length}</span>
                    </div>
                    <input type="text" 
                           style="padding: 10px 15px; border: 2px solid var(--primary-color); border-radius: var(--border-radius); font-size: 14px; width: 300px;" 
                           placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ –∫–ª–∏–µ–Ω—Ç–∞–º, –¥–∞—Ç–∞–º..." 
                           id="historySearch" 
                           oninput="filterVisitsHistory()">
                </div>
                
                <div style="max-height: 400px; overflow-y: auto;" id="visitsHistoryList">
                    ${generateVisitsHistoryList(allVisits)}
                </div>
                
                ${allVisits.length === 0 ? `
                    <div style="text-align: center; padding: 40px 20px; color: #666;">
                        <i class="fas fa-history" style="font-size: 48px; margin-bottom: 15px; color: #e9ecef;"></i>
                        <div style="font-size: 16px; margin-bottom: 5px;">–ò—Å—Ç–æ—Ä–∏—è –≤–∏–∑–∏—Ç–æ–≤ –ø—É—Å—Ç–∞</div>
                        <div style="font-size: 13px;">–ù–∞—á–Ω–∏—Ç–µ –ø–µ—Ä–≤—ã–π –≤–∏–∑–∏—Ç —á–µ—Ä–µ–∑ –º–µ–Ω—é "–ù–∞—á–∞—Ç—å –≤–∏–∑–∏—Ç"</div>
                    </div>
                ` : ''}
            </div>
            
            <div style="display: flex; justify-content: flex-end; gap: 12px;">
                <button onclick="exportVisitsHistory()" 
                        style="padding: 10px 20px; background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%); color: white; border: none; border-radius: var(--border-radius); cursor: pointer; font-weight: 600; font-size: 14px;">
                    <i class="fas fa-download"></i> –≠–∫—Å–ø–æ—Ä—Ç –∏—Å—Ç–æ—Ä–∏–∏
                </button>
                <button onclick="closeModal()" 
                        style="padding: 10px 20px; background: var(--light-bg); border: 2px solid var(--primary-color); border-radius: var(--border-radius); color: var(--primary-color); cursor: pointer; font-weight: 600; font-size: 14px;">
                    –ó–∞–∫—Ä—ã—Ç—å
                </button>
            </div>
        `;
        
        modal.style.display = 'flex';
    }

    function generateVisitsHistoryList(visits) {
        if (visits.length === 0) return '';
        
        // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –¥–∞—Ç–µ (–Ω–æ–≤—ã–µ —Å–Ω–∞—á–∞–ª–∞)
        visits.sort((a, b) => new Date(b.completedAt) - new Date(a.completedAt));
        
        let html = '';
        visits.forEach(visit => {
            const duration = visit.duration || '?';
            const goal = getGoalText(visit.goal || '');
            
            html += `
                <div style="border: 1px solid #e9ecef; border-radius: var(--border-radius); padding: 15px; margin-bottom: 12px; background: white;">
                    <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 10px;">
                        <div>
                            <div style="font-weight: 600; color: var(--dark-text); font-size: 15px;">${visit.clientName}</div>
                            <div style="font-size: 13px; color: #666;">–ö–æ–¥: ${visit.clientCode} ‚Ä¢ ${visit.date}</div>
                        </div>
                        <div style="background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%); color: white; padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: 600;">
                            ${duration} –º–∏–Ω
                        </div>
                    </div>
                    
                    <div style="font-size: 13px; color: #666; margin-bottom: 8px;">
                        <i class="fas fa-bullseye"></i> ${goal} ‚Ä¢ 
                        <i class="fas fa-clock"></i> ${visit.startTime} - ${visit.endTime}
                    </div>
                    
                    ${visit.resultNotes ? `
                        <div style="font-size: 13px; color: #444; background: var(--light-bg); padding: 10px; border-radius: var(--border-radius); margin-top: 8px; border-left: 3px solid var(--primary-color);">
                            ${visit.resultNotes}
                        </div>
                    ` : ''}
                </div>
            `;
        });
        
        return html;
    }

    function filterVisitsHistory() {
        const searchTerm = document.getElementById('historySearch')?.value.toLowerCase() || '';
        const historyList = document.getElementById('visitsHistoryList');
        
        const allVisits = getAllVisits().filter(v => v.status === 'completed');
        
        if (!searchTerm) {
            historyList.innerHTML = generateVisitsHistoryList(allVisits);
            return;
        }
        
        const filteredVisits = allVisits.filter(visit => 
            (visit.clientName?.toLowerCase().includes(searchTerm)) ||
            (visit.clientCode?.toString().toLowerCase().includes(searchTerm)) ||
            (visit.date?.toLowerCase().includes(searchTerm)) ||
            (visit.goal?.toLowerCase().includes(searchTerm)) ||
            (visit.resultNotes?.toLowerCase().includes(searchTerm))
        );
        
        historyList.innerHTML = generateVisitsHistoryList(filteredVisits);
    }

    // 11. EXCEL –§–£–ù–ö–¶–ò–û–ù–ê–õ
    function initializeExcelSection() {
        const sheetSelect = document.getElementById('excelSheetSelect');
        if (!sheetSelect) return;
        
        // –û—á–∏—â–∞–µ–º –∏ –∑–∞–ø–æ–ª–Ω—è–µ–º —Å–ø–∏—Å–æ–∫ –ª–∏—Å—Ç–æ–≤
        sheetSelect.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ª–∏—Å—Ç Excel...</option>';
        
        const sheets = [
            { name: '–ö–ª–∏–µ–Ω—Ç—ã', rows: allClientsData.length },
            { name: '–í–∏–∑–∏—Ç—ã', rows: getAllVisits().length },
            { name: '–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞', rows: 10 },
            { name: '–û—Ç—á–µ—Ç—ã', rows: 5 }
        ];
        
        sheets.forEach(sheet => {
            const option = document.createElement('option');
            option.value = sheet.name;
            option.textContent = `${sheet.name} (${sheet.rows} –∑–∞–ø–∏—Å–µ–π)`;
            sheetSelect.appendChild(option);
        });
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º –ª–∏—Å—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        if (sheets.length > 0) {
            loadExcelSheet(sheets[0].name);
        }
    }

    function loadExcelSheet(sheetName) {
        const select = document.getElementById('excelSheetSelect');
        if (select) {
            select.value = sheetName;
        }
        
        let data = [];
        let headers = [];
        
        if (sheetName === '–ö–ª–∏–µ–Ω—Ç—ã') {
            if (allClientsData.length > 0) {
                headers = Object.keys(allClientsData[0]);
                data = allClientsData;
            }
        } else if (sheetName === '–í–∏–∑–∏—Ç—ã') {
            const visits = getAllVisits();
            if (visits.length > 0) {
                headers = Object.keys(visits[0]);
                data = visits;
            }
        } else {
            data = [{ message: '–î–∞–Ω–Ω—ã–µ –¥–ª—è —ç—Ç–æ–≥–æ –ª–∏—Å—Ç–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç' }];
            headers = ['message'];
        }
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
        document.getElementById('currentSheetName').textContent = sheetName;
        document.getElementById('excelRowCount').textContent = data.length;
        document.getElementById('excelColCount').textContent = headers.length;
        document.getElementById('excelUpdateTime').textContent = new Date().toLocaleTimeString('ru-RU');
        document.getElementById('excelCount').innerHTML = `–ó–∞–≥—Ä—É–∂–µ–Ω–æ: <strong>${data.length}</strong> –∑–∞–ø–∏—Å–µ–π`;
        
        // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –≤ —Ç–∞–±–ª–∏—Ü–µ
        displayExcelData(data, headers);
    }

    function displayExcelData(data, headers) {
        const tableHead = document.getElementById('excelTableHead');
        const tableBody = document.getElementById('excelTableBody');
        
        if (!tableHead || !tableBody) return;
        
        // –ó–∞–≥–æ–ª–æ–≤–∫–∏
        let headHTML = '<tr>';
        headers.forEach(header => {
            headHTML += `<th>${header}</th>`;
        });
        headHTML += '</tr>';
        tableHead.innerHTML = headHTML;
        
        // –î–∞–Ω–Ω—ã–µ
        let bodyHTML = '';
        const displayData = data.slice(0, 50); // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º 50 –∑–∞–ø–∏—Å—è–º–∏ –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
        
        if (displayData.length === 0) {
            bodyHTML = `<tr><td colspan="${headers.length}" style="text-align: center; padding: 40px; color: #666;">
                –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
            </td></tr>`;
        } else {
            displayData.forEach(row => {
                bodyHTML += '<tr>';
                headers.forEach(header => {
                    const value = row[header] !== undefined ? row[header] : '';
                    const displayValue = typeof value === 'string' && value.length > 50 ? 
                        value.substring(0, 50) + '...' : 
                        String(value);
                    bodyHTML += `<td title="${value}">${displayValue}</td>`;
                });
                bodyHTML += '</tr>';
            });
        }
        
        tableBody.innerHTML = bodyHTML;
        
        if (data.length > 50) {
            const infoRow = document.createElement('tr');
            infoRow.innerHTML = `<td colspan="${headers.length}" style="text-align: center; color: #666; padding: 15px;">
                –ü–æ–∫–∞–∑–∞–Ω–æ 50 –∏–∑ ${data.length} –∑–∞–ø–∏—Å–µ–π
            </td>`;
            tableBody.appendChild(infoRow);
        }
    }

    function searchExcelData() {
        const searchTerm = document.getElementById('excelSearchInput')?.value.toLowerCase() || '';
        const sheetName = document.getElementById('excelSheetSelect')?.value;
        
        if (!searchTerm || !sheetName) {
            loadExcelSheet(sheetName);
            return;
        }
        
        let data = [];
        let headers = [];
        
        if (sheetName === '–ö–ª–∏–µ–Ω—Ç—ã') {
            data = allClientsData.filter(client => 
                Object.values(client).some(value => 
                    value && value.toString().toLowerCase().includes(searchTerm)
                )
            );
            if (data.length > 0) {
                headers = Object.keys(data[0]);
            }
        } else if (sheetName === '–í–∏–∑–∏—Ç—ã') {
            const visits = getAllVisits();
            data = visits.filter(visit => 
                Object.values(visit).some(value => 
                    value && value.toString().toLowerCase().includes(searchTerm)
                )
            );
            if (data.length > 0) {
                headers = Object.keys(data[0]);
            }
        }
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
        document.getElementById('excelRowCount').textContent = data.length;
        document.getElementById('excelCount').innerHTML = `–ù–∞–π–¥–µ–Ω–æ: <strong>${data.length}</strong> –∑–∞–ø–∏—Å–µ–π`;
        
        // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
        displayExcelData(data, headers);
    }

    function refreshExcelData() {
        const sheetName = document.getElementById('excelSheetSelect')?.value;
        if (sheetName) {
            loadExcelSheet(sheetName);
            showNotification('–î–∞–Ω–Ω—ã–µ Excel –æ–±–Ω–æ–≤–ª–µ–Ω—ã', 'info');
        }
    }

    function importExcelFile() {
        const input = document.createElement('input');
        input.type = 'file';
        input.accept = '.xlsx,.xls,.csv';
        
        input.onchange = function(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    
                    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö Excel
                    processExcelData(workbook);
                    
                    showNotification(`–§–∞–π–ª "${file.name}" —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω`, 'info');
                } catch (error) {
                    showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ —Ñ–∞–π–ª–∞ Excel', 'error');
                    console.error('Excel import error:', error);
                }
            };
            
            reader.readAsArrayBuffer(file);
        };
        
        input.click();
    }

    function processExcelData(workbook) {
        // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö Excel
        console.log('Excel workbook loaded:', workbook);
        
        // –ü—Ä–∏–º–µ—Ä: –ø–æ–ª—É—á–∞–µ–º –ø–µ—Ä–≤—ã–π –ª–∏—Å—Ç
        const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
        const jsonData = XLSX.utils.sheet_to_json(firstSheet);
        
        console.log('Data from Excel:', jsonData);
        
        // –ú–æ–∂–Ω–æ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∏ –¥–æ–±–∞–≤–∏—Ç—å –≤ —Å–∏—Å—Ç–µ–º—É
        // –ù–∞–ø—Ä–∏–º–µ—Ä, –∏–º–ø–æ—Ä—Ç –Ω–æ–≤—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤
    }

    function exportExcelToCSV() {
        const sheetName = document.getElementById('excelSheetSelect')?.value;
        if (!sheetName) {
            showNotification('–í—ã–±–µ—Ä–∏—Ç–µ –ª–∏—Å—Ç –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞', 'warning');
            return;
        }
        
        let data = [];
        let filename = '';
        
        if (sheetName === '–ö–ª–∏–µ–Ω—Ç—ã') {
            data = allClientsData;
            filename = `clients_${new Date().toISOString().split('T')[0]}.csv`;
        } else if (sheetName === '–í–∏–∑–∏—Ç—ã') {
            data = getAllVisits();
            filename = `visits_${new Date().toISOString().split('T')[0]}.csv`;
        } else {
            showNotification('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞', 'warning');
            return;
        }
        
        if (data.length === 0) {
            showNotification('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞', 'warning');
            return;
        }
        
        // –°–æ–∑–¥–∞–µ–º CSV
        const headers = Object.keys(data[0]);
        const csvRows = [];
        
        csvRows.push(headers.join(';'));
        
        data.forEach(row => {
            const values = headers.map(header => {
                const value = row[header] !== undefined ? row[header] : '';
                return `"${String(value).replace(/"/g, '""')}"`;
            });
            csvRows.push(values.join(';'));
        });
        
        const csvContent = csvRows.join('\n');
        const blob = new Blob(['\ufeff' + csvContent], { type: 'text/csv;charset=utf-8;' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = filename;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        
        showNotification(`–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ ${data.length} –∑–∞–ø–∏—Å–µ–π –≤ CSV`, 'info');
    }

    // 12. –≠–ö–°–ü–û–†–¢ –î–ê–ù–ù–´–•
    function exportCSV() {
        if (filteredClientsData.length === 0) {
            showNotification('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞', 'warning');
            return;
        }
        
        try {
            const headers = Object.keys(filteredClientsData[0]);
            const csvRows = [];
            
            csvRows.push(headers.join(';'));
            
            filteredClientsData.forEach(row => {
                const values = headers.map(header => {
                    const value = row[header] !== undefined ? row[header] : '';
                    return `"${String(value).replace(/"/g, '""')}"`;
                });
                csvRows.push(values.join(';'));
            });
            
            const csvContent = csvRows.join('\n');
            const blob = new Blob(['\ufeff' + csvContent], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `clients_${new Date().toISOString().split('T')[0]}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification(`–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ ${filteredClientsData.length} –∫–ª–∏–µ–Ω—Ç–æ–≤ –≤ CSV`, 'info');
        } catch (error) {
            showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ —ç–∫—Å–ø–æ—Ä—Ç–µ –¥–∞–Ω–Ω—ã—Ö', 'error');
            console.error('Export error:', error);
        }
    }

    function exportToExcel() {
        if (filteredClientsData.length === 0) {
            showNotification('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞', 'warning');
            return;
        }
        
        try {
            // –°–æ–∑–¥–∞–µ–º –∫–Ω–∏–≥—É Excel
            const workbook = {
                SheetNames: ['–ö–ª–∏–µ–Ω—Ç—ã', '–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞'],
                Sheets: {
                    '–ö–ª–∏–µ–Ω—Ç—ã': createExcelSheet(filteredClientsData),
                    '–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞': createStatsSheet()
                }
            };
            
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Ñ–∞–π–ª
            const wbout = XLSX.write(workbook, { bookType: 'xlsx', type: 'binary' });
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ñ–∞–π–ª
            const blob = new Blob([s2ab(wbout)], { type: 'application/octet-stream' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `–í–ï–†–¢–£–ú_–ö–ª–∏–µ–Ω—Ç—ã_${new Date().toISOString().split('T')[0]}.xlsx`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification(`–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ ${filteredClientsData.length} –∫–ª–∏–µ–Ω—Ç–æ–≤ –≤ Excel`, 'info');
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞ Excel:', error);
            showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ —ç–∫—Å–ø–æ—Ä—Ç–µ –≤ Excel. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —ç–∫—Å–ø–æ—Ä—Ç –≤ CSV.', 'error');
        }
    }

    function s2ab(s) {
        const buf = new ArrayBuffer(s.length);
        const view = new Uint8Array(buf);
        for (let i = 0; i < s.length; i++) view[i] = s.charCodeAt(i) & 0xFF;
        return buf;
    }

    function createExcelSheet(data) {
        if (data.length === 0) {
            return XLSX.utils.aoa_to_sheet([['–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö']]);
        }
        
        const headers = Object.keys(data[0]);
        const wsData = [
            headers,
            ...data.map(row => headers.map(header => row[header] || ''))
        ];
        
        return XLSX.utils.aoa_to_sheet(wsData);
    }

    function createStatsSheet() {
        const statsData = [
            ['–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –í–ï–†–¢–£–ú CRM', '', '', ''],
            ['–î–∞—Ç–∞ –æ—Ç—á–µ—Ç–∞', new Date().toLocaleDateString('ru-RU'), '', ''],
            ['–ú–µ–Ω–µ–¥–∂–µ—Ä', currentManager.name, '', ''],
            ['', '', '', ''],
            ['–ü–æ–∫–∞–∑–∞—Ç–µ–ª—å', '–ó–Ω–∞—á–µ–Ω–∏–µ', '–¶–µ–ª—å', '–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ'],
            ['–í—Å–µ–≥–æ –∫–ª–∏–µ–Ω—Ç–æ–≤', allClientsData.length, '150', `${Math.round(allClientsData.length / 150 * 100)}%`],
            ['–í–∏–∑–∏—Ç–æ–≤ —Å–µ–≥–æ–¥–Ω—è', getVisitsToday().filter(v => v.status === 'completed').length, '5', '‚Äî'],
            ['–í—Å–µ–≥–æ –≤–∏–∑–∏—Ç–æ–≤', getAllVisits().filter(v => v.status === 'completed').length, '50', '‚Äî'],
            ['–ê–∫—Ç–∏–≤–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤', allClientsData.filter(c => c.status === '–ê–∫—Ç–∏–≤–µ–Ω').length, '120', '‚Äî'],
            ['–ù–æ–≤—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤', allClientsData.filter(c => c.status === '–ù–æ–≤—ã–π').length, '30', '‚Äî']
        ];
        
        return XLSX.utils.aoa_to_sheet(statsData);
    }

    function exportVisitsHistory() {
        const allVisits = getAllVisits().filter(v => v.status === 'completed');
        
        if (allVisits.length === 0) {
            showNotification('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞', 'warning');
            return;
        }
        
        try {
            // –°–æ–∑–¥–∞–µ–º CSV
            const headers = ['–î–∞—Ç–∞', '–ö–ª–∏–µ–Ω—Ç', '–ö–æ–¥ –∫–ª–∏–µ–Ω—Ç–∞', '–¶–µ–ª—å', '–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (–º–∏–Ω)', '–ù–∞—á–∞–ª–æ', '–û–∫–æ–Ω—á–∞–Ω–∏–µ', '–†–µ–∑—É–ª—å—Ç–∞—Ç—ã', '–ó–∞–º–µ—Ç–∫–∏', '–ú–µ–Ω–µ–¥–∂–µ—Ä'];
            const csvRows = [];
            
            csvRows.push(headers.join(';'));
            
            allVisits.forEach(visit => {
                const row = [
                    visit.date || '',
                    visit.clientName || '',
                    visit.clientCode || '',
                    getGoalText(visit.goal || ''),
                    visit.duration || '',
                    visit.startTime || '',
                    visit.endTime || '',
                    visit.results?.join(', ') || '',
                    visit.resultNotes || '',
                    currentManager.name
                ];
                
                const values = row.map(value => 
                    `"${String(value).replace(/"/g, '""')}"`
                );
                csvRows.push(values.join(';'));
            });
            
            const csvContent = csvRows.join('\n');
            const blob = new Blob(['\ufeff' + csvContent], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `visits_history_${new Date().toISOString().split('T')[0]}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification(`–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ ${allVisits.length} –≤–∏–∑–∏—Ç–æ–≤`, 'info');
        } catch (error) {
            showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ —ç–∫—Å–ø–æ—Ä—Ç–µ –∏—Å—Ç–æ—Ä–∏–∏', 'error');
            console.error('Export history error:', error);
        }
    }

    // 13. –û–¢–ß–ï–¢–´
    function generateReport() {
        const modal = document.getElementById('visitModal');
        const content = document.getElementById('modalContent');
        const title = document.getElementById('modalTitle');
        
        title.innerHTML = '<i class="fas fa-chart-bar"></i> –û–¢–ß–ï–¢ –ü–û –î–ï–Ø–¢–ï–õ–¨–ù–û–°–¢–ò';
        
        const today = new Date().toLocaleDateString('ru-RU');
        const visitsToday = getVisitsToday().filter(v => v.status === 'completed').length;
        const allVisits = getAllVisits().filter(v => v.status === 'completed').length;
        const activeClients = allClientsData.filter(c => c.status === '–ê–∫—Ç–∏–≤–µ–Ω').length;
        const newClients = allClientsData.filter(c => c.status === '–ù–æ–≤—ã–π').length;
        
        content.innerHTML = `
            <div style="margin-bottom: 25px;">
                <div style="background: linear-gradient(135deg, var(--light-bg) 0%, #e9ecef 100%); padding: 20px; border-radius: var(--border-radius); margin-bottom: 25px; border: 2px solid var(--primary-color);">
                    <div style="font-weight: 600; color: var(--dark-text); margin-bottom: 15px; font-size: 18px;">–°–í–û–î–ù–ê–Ø –°–¢–ê–¢–ò–°–¢–ò–ö–ê</div>
                    
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px;">
                        <div style="background: white; padding: 15px; border-radius: var(--border-radius); border-left: 4px solid var(--primary-color);">
                            <div style="font-size: 24px; font-weight: bold; color: var(--dark-text);">${allClientsData.length}</div>
                            <div style="font-size: 13px; color: #666;">–í—Å–µ–≥–æ –∫–ª–∏–µ–Ω—Ç–æ–≤</div>
                        </div>
                        
                        <div style="background: white; padding: 15px; border-radius: var(--border-radius); border-left: 4px solid var(--success-color);">
                            <div style="font-size: 24px; font-weight: bold; color: var(--dark-text);">${activeClients}</div>
                            <div style="font-size: 13px; color: #666;">–ê–∫—Ç–∏–≤–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤</div>
                        </div>
                        
                        <div style="background: white; padding: 15px; border-radius: var(--border-radius); border-left: 4px solid var(--warning-color);">
                            <div style="font-size: 24px; font-weight: bold; color: var(--dark-text);">${visitsToday}</div>
                            <div style="font-size: 13px; color: #666;">–í–∏–∑–∏—Ç–æ–≤ —Å–µ–≥–æ–¥–Ω—è</div>
                        </div>
                        
                        <div style="background: white; padding: 15px; border-radius: var(--border-radius); border-left: 4px solid var(--info-color);">
                            <div style="font-size: 24px; font-weight: bold; color: var(--dark-text);">${allVisits}</div>
                            <div style="font-size: 13px; color: #666;">–í—Å–µ–≥–æ –≤–∏–∑–∏—Ç–æ–≤</div>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Email –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ—Ç—á–µ—Ç–∞ *</label>
                    <input type="email" class="form-input" id="reportEmail" value="${currentManager.email}">
                </div>
                
                <div class="form-group">
                    <label class="form-label">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –æ—Ç—á–µ—Ç—É</label>
                    <textarea class="form-textarea" id="reportComment" placeholder="–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è..."></textarea>
                </div>
            </div>
            
            <div style="display: flex; justify-content: space-between; gap: 12px;">
                <button onclick="previewReport()" 
                        style="padding: 10px 20px; background: var(--light-bg); border: 2px solid var(--primary-color); border-radius: var(--border-radius); color: var(--primary-color); cursor: pointer; font-weight: 600; font-size: 14px;">
                    <i class="fas fa-eye"></i> –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä
                </button>
                <button onclick="sendEmailReport()" 
                        style="padding: 10px 20px; background: linear-gradient(135deg, var(--success-color) 0%, #2E7D32 100%); color: white; border: none; border-radius: var(--border-radius); cursor: pointer; font-weight: 600; font-size: 14px;">
                    <i class="fas fa-paper-plane"></i> –û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç—á–µ—Ç
                </button>
            </div>
        `;
        
        modal.style.display = 'flex';
    }

    function previewReport() {
        const today = new Date().toLocaleDateString('ru-RU');
        const email = document.getElementById('reportEmail')?.value || currentManager.email;
        const comment = document.getElementById('reportComment')?.value || '';
        
        const previewWindow = window.open('', '_blank');
        previewWindow.document.write(`
            <html>
            <head>
                <title>–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –æ—Ç—á–µ—Ç–∞ –í–ï–†–¢–£–ú CRM</title>
                <style>
                    body { font-family: Arial, sans-serif; padding: 30px; max-width: 800px; margin: 0 auto; }
                    h1 { color: #2d3748; border-bottom: 2px solid #667eea; padding-bottom: 10px; }
                    .section { margin: 25px 0; padding: 20px; border: 1px solid #e9ecef; border-radius: 8px; }
                    .stat-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin: 15px 0; }
                    .stat-item { padding: 15px; background: #f8f9fa; border-radius: 6px; }
                    .stat-value { font-size: 24px; font-weight: bold; color: #2d3748; }
                    .stat-label { font-size: 13px; color: #666; margin-top: 5px; }
                    .footer { margin-top: 30px; padding-top: 20px; border-top: 1px solid #e9ecef; color: #666; font-size: 13px; }
                </style>
            </head>
            <body>
                <h1>–û–¢–ß–ï–¢ –í–ï–†–¢–£–ú CRM</h1>
                
                <div class="section">
                    <h3>üìä –û–ë–©–ê–Ø –°–¢–ê–¢–ò–°–¢–ò–ö–ê</h3>
                    <div class="stat-grid">
                        <div class="stat-item">
                            <div class="stat-value">${allClientsData.length}</div>
                            <div class="stat-label">–í—Å–µ–≥–æ –∫–ª–∏–µ–Ω—Ç–æ–≤</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">${allClientsData.filter(c => c.status === '–ê–∫—Ç–∏–≤–µ–Ω').length}</div>
                            <div class="stat-label">–ê–∫—Ç–∏–≤–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">${getVisitsToday().filter(v => v.status === 'completed').length}</div>
                            <div class="stat-label">–í–∏–∑–∏—Ç–æ–≤ —Å–µ–≥–æ–¥–Ω—è</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">${getAllVisits().filter(v => v.status === 'completed').length}</div>
                            <div class="stat-label">–í—Å–µ–≥–æ –≤–∏–∑–∏—Ç–æ–≤</div>
                        </div>
                    </div>
                </div>
                
                ${comment ? `
                <div class="section">
                    <h3>üí¨ –ö–û–ú–ú–ï–ù–¢–ê–†–ò–ô</h3>
                    <p>${comment}</p>
                </div>
                ` : ''}
                
                <div class="footer">
                    <p><strong>–î–∞—Ç–∞ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è:</strong> ${today}</p>
                    <p><strong>–ú–µ–Ω–µ–¥–∂–µ—Ä:</strong> ${currentManager.name}</p>
                    <p><strong>Email –¥–ª—è –æ—Ç—á–µ—Ç–æ–≤:</strong> ${email}</p>
                    <p><strong>–°–∏—Å—Ç–µ–º–∞:</strong> –í–ï–†–¢–£–ú CRM v2.0</p>
                </div>
            </body>
            </html>
        `);
        previewWindow.document.close();
    }

    function sendEmailReport() {
        const email = document.getElementById('reportEmail')?.value || currentManager.email;
        const comment = document.getElementById('reportComment')?.value || '';
        
        if (!email) {
            showNotification('–£–∫–∞–∂–∏—Ç–µ email –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ—Ç—á–µ—Ç–∞', 'warning');
            return;
        }
        
        const today = new Date().toLocaleDateString('ru-RU');
        const subject = `–û—Ç—á–µ—Ç –í–ï–†–¢–£–ú CRM –æ—Ç ${today}`;
        
        let body = `–û–¢–ß–ï–¢ –í–ï–†–¢–£–ú CRM\n\n`;
        body += `–î–∞—Ç–∞: ${today}\n`;
        body += `–ú–µ–Ω–µ–¥–∂–µ—Ä: ${currentManager.name}\n\n`;
        body += `–°–¢–ê–¢–ò–°–¢–ò–ö–ê:\n`;
        body += `‚Ä¢ –í—Å–µ–≥–æ –∫–ª–∏–µ–Ω—Ç–æ–≤: ${allClientsData.length}\n`;
        body += `‚Ä¢ –ê–∫—Ç–∏–≤–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤: ${allClientsData.filter(c => c.status === '–ê–∫—Ç–∏–≤–µ–Ω').length}\n`;
        body += `‚Ä¢ –í–∏–∑–∏—Ç–æ–≤ —Å–µ–≥–æ–¥–Ω—è: ${getVisitsToday().filter(v => v.status === 'completed').length}\n`;
        body += `‚Ä¢ –í—Å–µ–≥–æ –≤–∏–∑–∏—Ç–æ–≤: ${getAllVisits().filter(v => v.status === 'completed').length}\n\n`;
        
        if (comment) {
            body += `–ö–û–ú–ú–ï–ù–¢–ê–†–ò–ô:\n${comment}\n\n`;
        }
        
        body += `---\n–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ –≤ –í–ï–†–¢–£–ú CRM v2.0`;
        
        const mailtoLink = `mailto:${email}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
        window.open(mailtoLink, '_blank');
        
        closeModal();
        showNotification(`–û—Ç—á–µ—Ç –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–∞ ${email}`, 'info');
    }

    function generateExcelReport() {
        showNotification('–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–∞ –ø–æ Excel –¥–∞–Ω–Ω—ã–º...', 'info');
        // –ú–æ–∂–Ω–æ —Ä–∞—Å—à–∏—Ä–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω—ã—Ö –æ—Ç—á–µ—Ç–æ–≤ –ø–æ Excel
    }

    // 14. –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò
    function callClient(clientId) {
        const client = allClientsData.find(c => c.id === clientId);
        if (!client) {
            showNotification('–ö–ª–∏–µ–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω', 'warning');
            return;
        }
        
        const modal = document.getElementById('visitModal');
        const content = document.getElementById('modalContent');
        const title = document.getElementById('modalTitle');
        
        title.innerHTML = '<i class="fas fa-phone"></i> –ó–í–û–ù–û–ö –ö–õ–ò–ï–ù–¢–£';
        
        content.innerHTML = `
            <div style="margin-bottom: 25px;">
                <div style="background: linear-gradient(135deg, #f3f0ff 0%, #e9ecef 100%); padding: 20px; border-radius: var(--border-radius); margin-bottom: 20px; border: 2px solid var(--primary-color);">
                    <div style="font-size: 18px; font-weight: bold; color: var(--dark-text); margin-bottom: 5px;">
                        ${client.name}
                    </div>
                    <div style="color: #666; margin-bottom: 15px;">
                        –ö–æ–¥: ${client.code} ‚Ä¢ ${client.region}
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; font-size: 13px;">
                        <div><strong>–¢–∏–ø –±–∏–∑–Ω–µ—Å–∞:</strong> ${client.businessType}</div>
                        <div><strong>–¢–æ–≤–∞—Ä–Ω–∞—è –≥—Ä—É–ø–ø–∞:</strong> ${client.productGroup}</div>
                        <div><strong>–ê–¥—Ä–µ—Å:</strong> ${client.address || '–ù–µ —É–∫–∞–∑–∞–Ω'}</div>
                        <div><strong>–°—Ç–∞—Ç—É—Å:</strong> ${client.status}</div>
                    </div>
                </div>
                
                ${client.phone ? `
                    <div style="background: #e8f5e9; padding: 20px; border-radius: var(--border-radius); border: 1px solid var(--success-color); margin-bottom: 20px;">
                        <div style="font-weight: 600; color: #2E7D32; margin-bottom: 10px;">
                            <i class="fas fa-phone-alt"></i> –ö–û–ù–¢–ê–ö–¢–ù–´–ô –¢–ï–õ–ï–§–û–ù
                        </div>
                        <div style="font-size: 24px; color: #2E7D32; font-weight: bold; text-align: center; padding: 10px;">
                            ${client.phone}
                        </div>
                        <div style="text-align: center; margin-top: 15px;">
                            <a href="tel:${client.phone.replace(/[^0-9+]/g, '')}" 
                               style="padding: 12px 25px; background: linear-gradient(135deg, var(--success-color) 0%, #2E7D32 100%); color: white; text-decoration: none; border-radius: var(--border-radius); display: inline-block; font-weight: 600; font-size: 16px;">
                                <i class="fas fa-phone"></i> –ü–æ–∑–≤–æ–Ω–∏—Ç—å —Å–µ–π—á–∞—Å
                            </a>
                        </div>
                    </div>
                ` : `
                    <div style="background: #fff8e1; padding: 15px; border-radius: var(--border-radius); border: 1px solid var(--warning-color); margin-bottom: 20px;">
                        <div style="color: #F57C00; text-align: center;">
                            <i class="fas fa-exclamation-triangle"></i> –ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –Ω–µ —É–∫–∞–∑–∞–Ω
                        </div>
                    </div>
                `}
                
                <div class="form-group">
                    <label class="form-label">–¶–µ–ª—å –∑–≤–æ–Ω–∫–∞</label>
                    <select class="form-input" id="callPurpose">
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ü–µ–ª—å</option>
                        <option value="confirm">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –≤—Å—Ç—Ä–µ—á–∏</option>
                        <option value="order">–£—Ç–æ—á–Ω–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞</option>
                        <option value="price">–û–±—Å—É–∂–¥–µ–Ω–∏–µ —Ü–µ–Ω</option>
                        <option value="problem">–†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">–ó–∞–º–µ—Ç–∫–∏ –∫ –∑–≤–æ–Ω–∫—É</label>
                    <textarea class="form-textarea" id="callNotes" placeholder="–ß—Ç–æ –Ω—É–∂–Ω–æ –æ–±—Å—É–¥–∏—Ç—å..."></textarea>
                </div>
            </div>
            
            <div style="display: flex; justify-content: flex-end; gap: 12px;">
                <button onclick="saveCallInfo(${clientId})" 
                        style="padding: 10px 20px; background: var(--light-bg); border: 2px solid var(--primary-color); border-radius: var(--border-radius); color: var(--primary-color); cursor: pointer; font-weight: 600; font-size: 14px;">
                    <i class="fas fa-save"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
                </button>
                <button onclick="closeModal()" 
                        style="padding: 10px 20px; background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%); color: white; border: none; border-radius: var(--border-radius); cursor: pointer; font-weight: 600; font-size: 14px;">
                    –ó–∞–∫—Ä—ã—Ç—å
                </button>
            </div>
        `;
        
        modal.style.display = 'flex';
    }

    function saveCallInfo(clientId) {
        const purpose = document.getElementById('callPurpose')?.value;
        const notes = document.getElementById('callNotes')?.value || '';
        
        if (!purpose) {
            showNotification('–£–∫–∞–∂–∏—Ç–µ —Ü–µ–ª—å –∑–≤–æ–Ω–∫–∞', 'warning');
            return;
        }
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∑–≤–æ–Ω–∫–µ
        const callInfo = {
            clientId: clientId,
            purpose: purpose,
            notes: notes,
            timestamp: new Date().toISOString(),
            manager: currentManager.name
        };
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage
        const calls = JSON.parse(localStorage.getItem('vertum_calls') || '[]');
        calls.push(callInfo);
        localStorage.setItem('vertum_calls', JSON.stringify(calls));
        
        closeModal();
        showNotification('–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–≤–æ–Ω–∫–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞', 'info');
    }

    function editClient(clientId) {
        showNotification('–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞', 'info');
        // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
    }

    function syncData() {
        showNotification('–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö...', 'info');
        
        // –ò–º–∏—Ç–∞—Ü–∏—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
        setTimeout(() => {
            loadClientsData();
            updateSystemInfo();
            showNotification('–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞!', 'info');
        }, 1500);
    }

    function sendReport() {
        generateReport();
    }

    // 15. –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø
    function showNotification(message, type = 'info') {
        const container = document.getElementById('notificationContainer');
        if (!container) return;
        
        const notification = document.createElement('div');
        notification.className = `notification ${type}`;
        
        const icons = {
            info: 'fa-info-circle',
            success: 'fa-check-circle',
            warning: 'fa-exclamation-triangle',
            error: 'fa-exclamation-circle'
        };
        
        notification.innerHTML = `
            <div class="notification-icon">
                <i class="fas ${icons[type] || 'fa-info-circle'}"></i>
            </div>
            <div class="notification-content">
                <div class="notification-message">${message}</div>
            </div>
        `;
        
        container.appendChild(notification);
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
        setTimeout(() => {
            notification.classList.add('show');
        }, 10);
        
        // –°–∫—Ä—ã–≤–∞–µ–º —á–µ—Ä–µ–∑ 4 —Å–µ–∫—É–Ω–¥—ã
        setTimeout(() => {
            notification.classList.remove('show');
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 300);
        }, 4000);
    }

    // 16. –ú–û–î–ê–õ–¨–ù–´–ï –û–ö–ù–ê
    function closeModal() {
        const modal = document.getElementById('visitModal');
        modal.style.display = 'none';
        
        // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–∞–π–º–µ—Ä –≤–∏–∑–∏—Ç–∞
        stopVisitTimer();
    }

    // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ–≥–æ
    document.addEventListener('click', function(event) {
        const modal = document.getElementById('visitModal');
        if (event.target === modal) {
            closeModal();
        }
        
        // –ó–∞–∫—Ä—ã—Ç–∏–µ –≤—ã–ø–∞–¥–∞—é—â–µ–≥–æ —Å–ø–∏—Å–∫–∞ –º–µ–Ω–µ–¥–∂–µ—Ä–∞
        const dropdown = document.getElementById('managersDropdown');
        const managerSelector = document.getElementById('currentManager');
        
        if (!managerSelector.contains(event.target) && dropdown && !dropdown.contains(event.target)) {
            dropdown.style.display = 'none';
            managerSelector.classList.remove('active');
        }
    });

    // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ ESC
    document.addEventListener('keydown', function(event) {
        if (event.key === 'Escape') {
            closeModal();
            
            const dropdown = document.getElementById('managersDropdown');
            if (dropdown.style.display === 'block') {
                toggleManagerDropdown();
            }
        }
    });

    // 17. –°–¢–ê–¢–ò–°–¢–ò–ö–ê
    function updateStatistics() {
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏–π –∫–∞–ª–µ–Ω–¥–∞—Ä—è
        const calendarEvents = document.getElementById('calendarEvents');
        if (calendarEvents) {
            calendarEvents.textContent = '3'; // –ú–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–º
        }
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫ –ª–∏—Å—Ç–æ–≤ Excel
        const excelSheetsCount = document.getElementById('excelSheetsCount');
        if (excelSheetsCount) {
            excelSheetsCount.textContent = '4';
        }
    }

    // 18. –°–û–•–†–ê–ù–ï–ù–ò–ï –°–û–°–¢–û–Ø–ù–ò–Ø
    function saveState() {
        const state = {
            filters: {},
            currentPage: currentPage,
            currentManager: currentManager.name.includes('–•–∏—Å–º–∞—Ç—É–ª–ª–∏–Ω') ? '–•–∏—Å–º–∞—Ç—É–ª–ª–∏–Ω' : '–•–∏—Ç—Ä–æ–≤'
        };
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∑–Ω–∞—á–µ–Ω–∏—è —Ñ–∏–ª—å—Ç—Ä–æ–≤
        const filterIds = ['filterRegion', 'filterBusinessType', 'filterProductGroup', 
                          'filterSegmentation', 'filterDeliveryZone', 'filterDirection',
                          'filterStatus', 'filterLastVisit', 'filterManager'];
        
        filterIds.forEach(filterId => {
            const filter = document.getElementById(filterId);
            if (filter) {
                state.filters[filterId] = filter.value;
            }
        });
        
        localStorage.setItem('vertum_state', JSON.stringify(state));
    }

    function loadState() {
        const savedState = localStorage.getItem('vertum_state');
        if (savedState) {
            const state = JSON.parse(savedState);
            
            // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–∏–ª—å—Ç—Ä—ã
            Object.keys(state.filters).forEach(filterId => {
                const filter = document.getElementById(filterId);
                if (filter && state.filters[filterId]) {
                    filter.value = state.filters[filterId];
                }
            });
            
            // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –º–µ–Ω–µ–¥–∂–µ—Ä–∞
            if (state.currentManager) {
                selectManager(state.currentManager);
            }
            
            // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ñ–∏–ª—å—Ç—Ä—ã –µ—Å–ª–∏ –æ–Ω–∏ –±—ã–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
            if (Object.values(state.filters).some(value => value)) {
                setTimeout(() => applyFilters(), 100);
            }
        }
    }

    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
    setTimeout(loadState, 500);

    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏ —Ä–∞–∑–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    window.addEventListener('beforeunload', saveState);

    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
    setInterval(saveState, 30000);

    // 19. –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ü–û–°–õ–ï –ó–ê–ì–†–£–ó–ö–ò
    window.onload = function() {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –±—ã–ª –ª–∏ –≤—ã–±—Ä–∞–Ω –º–µ–Ω–µ–¥–∂–µ—Ä —Ä–∞–Ω–µ–µ
        const savedManager = localStorage.getItem('vertum_current_manager');
        if (savedManager) {
            selectManager(savedManager);
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º Excel —Å–µ–∫—Ü–∏—é –µ—Å–ª–∏ –æ–Ω–∞ –æ—Ç–∫—Ä—ã—Ç–∞
        if (window.location.hash === '#excel') {
            showSection('excelData');
        } else if (window.location.hash === '#clients') {
            showSection('clients');
        }
    };

    </script>
</body>
</html>